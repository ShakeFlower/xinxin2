var data_a1e2fb4a_e986_4524_b0da_9b7ba7c0874d={main:{floorIds:["FT1","FT2","FT3","FT4","FT5","FT6","B01","B02","B03","B04","B05","B06","B07","B08","B09","B10","FT13","FT14","FT15","FT16","FT17","FT18","FT19","FT20","B11","B12","S1","S2","FT7","FT8","FT9","FT10","FT11","FT12","S3","S4","S5","S6","S7","S8","S9","S10","B13","B14","B15","B16","B17","B18","B19","B20","B21","B22","B23","B24","B25","MT1","MT2","MT3","MT4","MT5","MT6","MT6b","MT7","MT7b","MT8","MT8b","MT9","MT9b","MT10","MT11","MT12","MT13","MT14","MT15","MT16","MT17","MT18","MT19","MT20","MT21","MT21b","MT22","MT22b","MT23","MT23b","MT24","MT25","HG1","HG2","HG3","HG4","HG5","HG6","HG7","HG8","HG9","HG10","HG11","HG12","HG13","HG14","HG15","HG16","HG17","HG18","TU1","TU2","TU3","TU4","TU4b","TU5","TU5b"],floorPartitions:[],images:["NPC01-GongZhu.png","baiyin.png","bg.jpg","circle.png","ground.png","ground2.png","hero.png","win.jpg","winskin.png"],tilesets:["magictower.png","NPC01-GongZhu.png"],animates:["hand","jianji","sword","swords","thunder","yongchang","zone"],bgms:["bgm.mp3","bgm0.mp3","bgm1.mp3","bgm2.mp3","bgm3.mp3","bgm4.mp3"],sounds:["achievement.mp3","attack.mp3","bomb.mp3","cancel.mp3","centerFly.mp3","confirm.mp3","cursor.mp3","door.mp3","drop.mp3","equip.mp3","error.mp3","floor.mp3","item.mp3","jump.mp3","load.mp3","open_ui.mp3","pickaxe.mp3","recovery.mp3","save.mp3","skill1.mp3","sound1588.mp3","switch.mp3","zone.mp3"],fonts:["myFont1"],nameMap:{"确定":"confirm.mp3","取消":"cancel.mp3","操作失败":"error.mp3","光标移动":"cursor.mp3","打开界面":"open_ui.mp3","读档":"load.mp3","存档":"save.mp3","获得道具":"item.mp3","回血":"recovery.mp3","炸弹":"bomb.mp3","飞行器":"centerFly.mp3","开关门":"door.mp3","上下楼":"floor.mp3","跳跃":"jump.mp3","破墙镐":"pickaxe.mp3","阻激夹域":"zone.mp3","穿脱装备":"equip.mp3","背景音乐":"bgm.mp3","攻击":"attack.mp3","背景图":"bg.jpg","领域":"zone","背景图.jpg":"bg.jpg","背景音乐.mp3":"bgm.mp3"},levelChoose:[{title:"原版游戏",name:"Standard",hard:1,color:[255,215,0,1],action:[{type:"function","function":"function(){\ncore.firstData.floorId='MT1';\n}"},{type:"function","function":'function(){\ncore.removeMaps("TU1", "TU5b")\n}'}]},{title:"修复版",name:"Remake",hard:2,color:[0,248,255,1],action:[{type:"setValue",name:"flag:bugFix",value:"true"},{type:"setValue",name:"flag:autoGetHp",value:"false"},{type:"function","function":"function(){\ncore.firstData.floorId='MT1';\n}"},{type:"function","function":'function(){\ncore.removeMaps("TU1", "TU5b")\n}'},{type:"setValue",name:"item:I453",value:"1"}]},{title:"游戏教程",name:"Tutorial",hard:3,color:[134,255,0,1],action:[{type:"function","function":"function(){\ncore.firstData.floorId='TU1';\n}"},{type:"function","function":'function(){\ncore.removeMaps("FT1", "HG18")\n}'}]}],equipName:["剑技","防御术"],startBgm:null,styles:{startBackground:"project/images/bg.jpg",startVerticalBackground:"project/images/bg.jpg",startLogoStyle:"color: black",startButtonsStyle:"background-color: #32369F; opacity: 0.85; color: #FFFFFF; border: #FFFFFF 2px solid; caret-color: #FFD700;",statusLeftBackground:"url(project/materials/ground.png) repeat",statusTopBackground:"url(project/materials/ground.png) repeat",toolsBackground:"url(project/materials/ground.png) repeat",floorChangingStyle:"background-color: black; color: white",statusBarColor:[255,255,255,1],borderColor:[204,204,204,1],selectColor:[255,215,0,1],font:"Verdana"},splitImages:[]},firstData:{title:"新新魔塔续",name:"xinxin2",version:"1.0",floorId:"MT1",hero:{image:"hero.png",animate:false,name:"勇者",lv:1,hpmax:500,hp:900,manamax:240,mana:0.1,atk:10,def:10,mdef:0,money:0,exp:0,equipment:[],items:{constants:{fly:1,book:1,I305:1,A1:1,A2:1,A3:1,A4:1,A5:1,A6:1,A7:1,A8:1,A9:1},tools:{yellowKey:5,blueKey:1,redKey:0},equips:{}},loc:{direction:"down",x:6,y:11},flags:{deepBreath:5,tiredMax:20,atkm:10,defm:40,sxzl:0,autoGetItem:1,autoGetHp:1,criMax:99,recomTurnMax:10,skill_1:"-C",skill_2:"XC",skill_3:"CXC",skill_4:"AZ",skill_5:"XZ",skillHouse:["-C","C","AC","@3C","CC","X1C","X3C","CX1","CX3","CX1C","CX3C","X2","AZ2","X1Z2","X3Z2","X2AC","X2AZ2","Z2X1","Z2X3","CX1Z2","CX3Z2","CX2AZ2","X3X3Z2","X2AZ2X3-C","Z3","Z3*2","Z3*3","Z3*4","Z3*5","(Z4*2-V)*3Z4","Z5","Z5X1","X2Z5","Z5X5","Z1*3CX3","(Z1X3)*2X3","(A*4Z2)*3","(A*6Z2)*2","(X3*4Z2)*2","(X3*5Z2)*2","(X3*3Z2)*3"],hpManaRatio:"(2*hero.lv/Math.sqrt(hero.def)+0.5*hero.atk/hero.def)*(1-hero.mana/hero.manamax*0.3)",shop1Cap:130,achieveScore:0,achieves:[["幻之虹币","取得幻之史莱姆虹币","传说白银一族至高之宝，获得者将会得到白银怪物的无限祝福...",100,0],["大难不死","主角血<200或公主血<50","哇...不怕不怕...",10,0],["起死回生","血<300时通过吃血瓶回血","我感觉死去活来！！",10,0],["肉盾","主角血超过5000","一打十根本不成问题的呢",10,0],["投入战斗","攻防均超过100","热身差不多完毕了！！",10,0],["见习剑士","拿到第一本剑技书","真想快点试试学到的剑术！",10,0],["防守入门","拿到第一本魔法书","防守？是这样的吗？",10,0],["凝神储息","气息全满","......暂时先不要影响我......",10,0],["捐血站","主角血超过12000","卖血！卖血！有人买吗？",20,0],["国家大事","公主加入队伍","什么事都不比国家大事重要吧！",10,0],["心灵相通","识别能量转换器","我知道你在想什么！",10,0],["职业冒险家","得到冒险袋","去冒险就是要做足准备！",10,0],["守财奴","金币超过1000","钱要用才是钱！钱！",20,0],["学有所成","经验超过280","只学不实践的话还是不太足够吧？",20,0],["三相之力","集齐三相之力","白银怪物？杀个稀巴烂！",20,0],["开采矿工","拿到锄头","嘎嘎…采矿其实颇辛苦的",20,0],["智能施法","在4种特定情况下使用技能","用技也要用得有技巧有智慧！你说对不？",30,0],["命运窥视者","得到水晶球","我从水晶球中看到我的命运了…什么？！这水晶球不是这样使用的吗？",40,0],["冰冷的手","拿到魔法冰块","呼...手很冰...",20,0],["冰冷的人","拿到永恒冰结晶","不要离我这么远嘛...虽然我的身体很冰…",30,0],["白银狙击手","拥有史莱姆钱币之和≥90","白银怪物？在我面前不值一提！",30,0],["熔炉","拿到强剑之首饰","有了这东西打白银怪物就很有效率了",40,0],["剑大师","集齐五个剑技","我的剑技很华丽吧",40,0],["盾大师","集齐五个防御术","你有什么办法攻击我都有方法防守！",40,0],["持匙人","持有10把红钥匙","这些钥匙是开哪些门的？",30,0],["宝石矿工","拿到宝石锄头","干了这么久矿工，终于发现好东西了~~",30,0],["小叮当","拥有随意门数量大于15","你其实是小叮当吧？！",20,0],["神之防护","公主魔防大于260","我的防御像神一般！直到我中了一箭...",40,0],["圣水加护","吃第一瓶圣水","感谢圣水的帮助！",20,0],["圣神的加护","吃第二瓶圣水","我简直像受到圣神般的帮助",30,0],["弑神者","击败魔神·些多","遇神杀神！！谁也阻止不了我！",20,0],["勇者斗恶龙","杀掉黄金龙或毒龙","这是传说中的恶龙吗？太强大了",40,0],["大屠杀","杀死超过1200只怪物","杀啊杀啊，所有怪物都逃不出我的手掌心！哈哈",50,0],["攻击姿态","攻击超过1700","再硬的东西我都打得破！来试试看吧！",50,0],["防守姿态","防御超过1700","有人能打破我的防守吗？",50,0],["一代宗师","等级达到或超过140","我要开班授徒的话有人会来加入吗？",50,0]]},followers:[],steps:0},startCanvas:[{type:"comment",text:"在这里可以用事件来自定义绘制标题界面的背景图等"},{type:"comment",text:"也可以直接切换到其他楼层（比如某个开始剧情楼层）进行操作。"},{type:"previewUI",action:[{type:"fillRect",x:0,y:0,width:"core.__PIXELS__",height:"core.__PIXELS__",style:[82,82,82,1]},{type:"setAttribute",align:"center"},{type:"fillBoldText",x:"core.__PIXELS__ / 2",y:80,style:[255,255,255,1],strokeStyle:[0,0,0,1],font:"bold 40px Verdana",text:"${core.firstData.title}"}]},{type:"setValue",name:"flag:selection",value:"0"},{type:"comment",text:"在右下方自绘一个对话框进行显示选择项"},{type:"previewUI",action:[{type:"fillRect",x:230,y:250,width:150,height:142,radius:10,style:[50,54,159,0.85]},{type:"strokeRect",x:230,y:250,width:150,height:142,radius:10,style:[255,255,255,1],lineWidth:2},{type:"fillBoldText",x:305,y:290,style:[255,255,255,1],font:"bold 25px Verdana",text:"开始游戏"},{type:"fillBoldText",x:305,y:330,font:"bold 25px Verdana",text:"读取存档"},{type:"fillBoldText",x:305,y:370,font:"bold 25px Verdana",text:"回放录像"}]},{type:"while",condition:"1",data:[{type:"drawSelector",image:"winskin.png",code:1,x:245,y:"261 + 40*flag:selection",width:120,height:40},{type:"wait",data:[{"case":"keyboard",keycode:"13,32","break":true,action:[{type:"switch",condition:"flag:selection",caseList:[{"case":"0",action:[{type:"comment",text:"在“开始游戏”确定"},{type:"break",n:1}]},{"case":"1",action:[{type:"comment",text:"在“读取存档”确定"},{type:"callLoad"}]},{"case":"2",action:[{type:"comment",text:"在“回放录像”确定"},{type:"if",condition:"(!core.isReplaying())","true":[{type:"function","function":"function(){\ncore.chooseReplayFile()\n}"}]}]}]}]},{"case":"keyboard",keycode:"38","break":true,action:[{type:"comment",text:"光标上键"},{type:"setValue",name:"flag:selection",value:"(flag:selection + 2) % 3"}]},{"case":"keyboard",keycode:"40","break":true,action:[{type:"comment",text:"光标下键"},{type:"setValue",name:"flag:selection",value:"(flag:selection + 1) % 3"}]},{"case":"mouse",px:[245,365],py:[261,300],"break":true,action:[{type:"comment",text:"点击“开始游戏”"},{type:"break",n:1}]},{"case":"mouse",px:[245,365],py:[301,340],"break":true,action:[{type:"comment",text:"点击“读取存档”"},{type:"callLoad"}]},{"case":"mouse",px:[245,365],py:[341,380],"break":true,action:[{type:"comment",text:"点击“播放录像”"},{type:"if",condition:"(!core.isReplaying())","true":[{type:"function","function":"function(){\ncore.chooseReplayFile()\n}"}]}]}]}]},{type:"setValue",name:"flag:selection",value:"null"},{type:"drawSelector",code:1},{type:"clearMap"},{type:"function","function":"function(){\ncore.control.checkBgm()\n}"},{type:"if",condition:"(main.levelChoose.length == 0)","true":[{type:"comment",text:"没有难度选择：直接开始游戏"}],"false":[{type:"comment",text:"难度选择：作为样例，这里只提供了一个显示选择项。"},{type:"function","function":'function(){\nvar choices = [];\nmain.levelChoose.forEach(function (one) {\n\tchoices.push({\n\t\t"text": one.title || \'\',\n\t\t"action": [\n\t\t\t{ "type": "function", "function": "function() { core.status.hard = \'" + (one.name || \'\') + "\'; }" }\n\t\t]\n\t});\n})\ncore.insertAction({ "type": "choices", "choices": choices });\n}'},{type:"comment",text:"你也可以仿照上面的样例进行自己创建等待用户操作来处理不同的难度分歧。\n如需自己处理，请设置 core.status.hard \n（例如，自定义js脚本：core.status.hard = 'Easy' ）"}]},{type:"clearMap"},{type:"comment",text:"接下来会执行startText中的事件"},{type:"comment",text:"状态栏默认处于隐藏状态；可以使用“显示状态栏”事件进行显示。"}],startText:[{type:"if",condition:"(core.status.hard!=='Tutorial')","true":["距离上次事件大概只有三个月…在这个已恢复平静的国家里…原本被毁灭了的魔塔无故地又耸立起来。国王对此事大为紧张，随即派了数队人马去调查。及后得知这塔是旧魔塔的地下迷宫，但不知受了什么力量影响而出现在地面上。本来调查队里有一部分人负责潜入了这座塔的深层作进一步了解，可是过了一段长时间后，他们都没有回来集合…难道已遭不测吗？束手无策的国王最后去询问了迷信的祭师，他认为这次魔塔复活是因为上次的行动触怒了魔鬼。要解决的话，就必须要将公主送去当祭品。\n国王也不问公主的意愿，便派了两名王城中最强的侍卫捉了公主去魔塔当祭品，并执行仪式。\n另一方面，你从传闻中得知魔塔复活的消息，便再次赶到了这里查个究竟…"]},{type:"choices",text:"选择优先使用的快捷键（按L查看），后续可按U（或进入设置->系统设置->高级设置）修改",choices:[{text:"H5快捷键",action:[]},{text:"新新快捷键",action:[{type:"setValue",name:"flag:xinHotkey",value:"true"}]}]}],shops:[{id:"moneyShop1",textInList:"主塔金币商店",mustEnable:true,commonEvent:"主塔金币商店",args:[true]},{id:"expShop1",textInList:"主塔经验商店",mustEnable:true,commonEvent:"主塔经验商店",args:[true]},{id:"moneyShop2",textInList:"魔塔金币商店",mustEnable:true,commonEvent:"魔塔金币商店",args:[true]},{id:"expShop2",textInList:"魔塔经验商店",mustEnable:true,commonEvent:"魔塔经验商店",args:[true]},{id:"keyshop",textInList:"钥匙商店",mustEnable:true,commonEvent:"钥匙商店",args:[true]},{id:"doorShop",textInList:"随意门商店",mustEnable:true,commonEvent:"随意门商店",args:[true]},{id:"moneyShop3",textInList:"异国商人",mustEnable:true,commonEvent:"异国商人",args:[true]},{id:"expShop3",textInList:"退役战士",mustEnable:true,commonEvent:"退役战士",args:[true]},{id:"keyshop2",textInList:"奸商盗贼",mustEnable:true,commonEvent:"奸商盗贼",args:[true]},{id:"coinShop",textInList:"回收钱币商店",mustEnable:true,commonEvent:"回收钱币商店",args:[true]},{id:"sellKeyShop",textInList:"回收钥匙商店",mustEnable:true,commonEvent:"回收钥匙商店",args:[true]}],levelUp:[{need:"0",title:"",action:[{type:"comment",text:"此处是初始等级，只需填写称号"}]},{need:"20",title:"",action:[{type:"setValue",name:"status:atk",operator:"+=",value:"10"},{type:"setValue",name:"status:def",operator:"+=",value:"10"}]},{need:"40",title:"",action:[{type:"tip",text:"恭喜升级"}]}]},values:{lavaDamage:50,poisonDamage:5,weakValue:0,redGem:2,blueGem:2,greenGem:5,redPotion:150,bluePotion:400,yellowPotion:500,greenPotion:800,breakArmor:0.9,counterAttack:0.1,purify:3,hatred:2,animateSpeed:200,moveSpeed:100,statusCanvasRowsOnMobile:3,floorChangeTime:500},flags:{statusBarItems:["enableLv","enableHPMax","enableHP","enableMana","enableAtk","enableDef","enableMDef","enableMoney","enableExp","enableKeys","enableGreenKey","enableDebuff","enableSkill"],extendToolbar:false,flyNearStair:false,flyRecordPosition:false,steelDoorWithoutKey:true,itemFirstText:true,equipboxButton:false,enableAddPoint:false,enableNegativeDamage:true,betweenAttackMax:false,useLoop:true,startUsingCanvas:false,statusCanvas:false,enableEnemyPoint:true,displayEnemyDamage:true,displayCritical:true,displayExtraDamage:true,enableGentleClick:true,ignoreChangeFloor:true,canGoDeadZone:false,enableMoveDirectly:true,enableRouteFolding:false,disableShopOnDamage:false,blurFg:false}};var enemys_fcae963b_31c9_42b4_b48c_bb48d09f3f80={greenSlime:{name:"史莱姆",hp:35,atk:19,def:2,money:0,exp:1,point:0,special:[],range:null,value:25},redSlime:{name:"红色史莱姆",hp:45,atk:23,def:3,money:1,exp:1,point:0,special:[],value:25},blackSlime:{name:"黑色史莱姆",hp:70,atk:45,def:15,money:6,exp:1,point:6,special:[],value:29},slimelord:{name:"史莱姆王",hp:400,atk:149,def:94,money:18,exp:2,point:0,special:[],value:25},bat:{name:"蝙蝠",hp:35,atk:30,def:3,money:2,exp:1,point:0,special:[],value:27},bigBat:{name:"大蝙蝠",hp:70,atk:61,def:29,money:8,exp:1,point:0,special:4,n:2,value:47},redBat:{name:"红蝙蝠",hp:200,atk:201,def:119,money:25,exp:3,point:0,special:[5],value:60},vampire:{name:"魔王·格勒第",hp:600,atk:279,def:190,money:400,exp:70,point:0,special:[4],value:75},skeleton:{name:"骷髅",hp:70,atk:80,def:0,money:5,exp:1,point:0,special:[],value:40},skeletonSoilder:{name:"骷髅剑士",hp:320,atk:189,def:15,money:17,exp:2,point:0,special:[],value:50},skeletonCaptain:{name:"骷髅队长",hp:500,atk:330,def:34,money:30,exp:4,point:0,special:[],value:50},ghostSkeleton:{name:"不死骷髅兵",hp:1400,atk:1400,def:601,money:33,exp:4,point:0,special:[57],value:80,add:true},zombie:{name:"丧尸",hp:110,atk:90,def:30,money:8,exp:1,point:0,special:[],value:28},zombieKnight:{name:"丧尸剑士",hp:535,atk:305,def:180,money:41,exp:5,point:0,special:[],value:30},rock:{name:"石头怪",hp:10,atk:70,def:110,money:12,exp:2,point:0,special:[],value:35},slimeMan:{name:"史莱姆人",hp:176,atk:98,def:66,money:12,exp:2,point:0,special:[],atkValue:2,defValue:3,value:31,n:20},bluePriest:{name:"魔术师",hp:50,atk:18,def:4,money:3,exp:1,point:0,special:[2],value:35},redPriest:{name:"炎术士",hp:330,atk:90,def:170,money:38,exp:4,point:0,special:[2],value:90},brownWizard:{name:"大法师",hp:496,atk:112,def:182,money:43,exp:5,point:0,special:[2],value:90,range:2},redWizard:{name:"火炎大法师",hp:1130,atk:202,def:540,money:67,exp:7,point:0,special:[2,70],value:190,zoneSquare:true,reid:11},yellowGuard:{name:"守卫",hp:20,atk:50,def:36,money:4,exp:1,point:0,special:[],value:33},blueGuard:{name:"中级守卫",hp:210,atk:120,def:118,money:20,exp:3,point:0,special:[],value:36},redGuard:{name:"高级守卫",hp:310,atk:724,def:700,money:54,exp:6,point:0,special:[],value:88},swordsman:{name:"双手剑士",hp:180,atk:123,def:81,money:14,exp:2,point:0,special:[4],value:42},soldier:{name:"不死战士",hp:1100,atk:1240,def:800,money:22,exp:3,point:0,special:[13,23],reid:212,value:100,damage:9},yellowKnight:{name:"骑士",hp:210,atk:91,def:47,money:12,exp:2,point:0,special:[51],value:31},redKnight:{name:"近卫骑士",hp:1002,atk:777,def:592,money:66,exp:7,point:0,special:[51],value:40},darkKnight:{name:"死灵战士",hp:1300,atk:1120,def:890,money:40,exp:3,point:0,special:[23,51],reid:225,value:140},blackKing:{name:"黑衣魔王",hp:1000,atk:500,def:0,money:1000,exp:1000,point:0,special:[],notBomb:true},yellowKing:{name:"魔王近卫兵",hp:1220,atk:880,def:612,money:70,exp:8,point:0,special:[56],value:119,n:10},greenKing:{name:"魔法师元帅",hp:737,atk:155,def:402,money:57,exp:6,point:0,special:[62],value:110},blueKnight:{name:"铁骑士",hp:370,atk:213,def:130,money:27,exp:3,point:0,special:[51],value:27},goldSlime:{name:"剑神·沙士",hp:1320,atk:1410,def:1090,money:800,exp:190,point:0,special:[59],value:60},poisonSkeleton:{name:"骷髅头目",hp:999,atk:692,def:90,money:50,exp:6,point:0,special:[13],value:93,damage:5},poisonBat:{name:"毒蝙蝠",hp:402,atk:426,def:245,money:46,exp:5,point:0,special:[4,12],value:80},steelRock:{name:"铁怪",hp:20,atk:688,def:800,money:57,exp:6,point:0,special:[3],value:30},skeletonPriest:{name:"混沌术士",hp:708,atk:250,def:1110,money:92,exp:10,point:0,special:[66],value:180},skeletonKing:{name:"魔神·些多",hp:1630,atk:310,def:1104,money:700,exp:300,point:0,special:[64],value:160},skeletonWizard:{name:"骷髅巫师",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},redSkeletonCaption:{name:"骷髅武士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},badHero:{name:"迷失勇者",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},demon:{name:"魔神武士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},demonPriest:{name:"魔神法师",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},goldHornSlime:{name:"黄金史莱姆",hp:9,atk:100,def:9999,money:1,exp:1,point:0,special:[20],value:0},redKing:{name:"魔王",hp:1029,atk:210,def:705,money:82,exp:9,point:0,special:[63],value:130},whiteKing:{name:"魔法师首领",hp:610,atk:120,def:210,money:44,exp:5,point:0,special:[61],value:130},blackMagician:{name:"暗黑魔法师",hp:700,atk:120,def:120,money:300,exp:50,point:0,special:[60],value:70,add:false,notBomb:false},silverSlime:{name:"黄金史莱姆王",hp:7,atk:200,def:9999,money:1,exp:1,point:0,special:[20],value:0},swordEmperor:{name:"白银史莱姆",hp:2,atk:50,def:9999,money:1,exp:1,point:0,special:[20],value:0},whiteHornSlime:{name:"白银史莱姆王",hp:7,atk:150,def:9999,money:1,exp:1,point:0,special:[20],value:0},badPrincess:{name:"痛苦魔女",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},badFairy:{name:"黑暗仙子",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},grayPriest:{name:"雷术士",hp:160,atk:30,def:37,money:10,exp:2,point:0,special:[2],value:60},redSwordsman:{name:"剑王",hp:920,atk:1020,def:620,money:73,exp:8,point:0,special:[6],n:4,value:80},whiteGhost:{name:"水银人",hp:888,atk:661,def:502,money:59,exp:6,point:0,special:[54],value:90,n:13},poisonZombie:{name:"毒丧尸",hp:660,atk:500,def:387,money:48,exp:5,point:0,special:[12],value:70},magicDragon:{name:"恶龙",hp:1200,atk:608,def:452,money:120,exp:50,point:0,special:[],value:60},octopus:{name:"魔界八爪鱼",hp:2008,atk:880,def:700,money:400,exp:100,point:0,special:[],value:90},darkFairy:{name:"仙子",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},greenKnight:{name:"强盾骑士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},angel:{name:"天使",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},elemental:{name:"元素生物",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},steelGuard:{name:"铁守卫",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:18,value:20},evilBat:{name:"邪恶蝙蝠",hp:1000,atk:1,def:0,money:0,exp:0,point:0,special:[2,3]},E300:{name:"紫色史莱姆",hp:90,atk:40,def:1,money:8,exp:1,point:0,special:[]},E301:{name:"橙色史莱姆",hp:60,atk:25,def:1,money:3,exp:1,point:0,special:[]},E302:{name:"黄色史莱姆",hp:70,atk:30,def:1,money:4,exp:1,point:0,special:[]},E303:{name:"绿色史莱姆",hp:75,atk:32,def:1,money:5,exp:1,point:0,special:[]},E304:{name:"青色史莱姆",hp:80,atk:35,def:1,money:6,exp:1,point:0,special:[]},E305:{name:"蓝色史莱姆",hp:85,atk:38,def:1,money:7,exp:1,point:0,special:[]},E306:{name:"白银史莱姆",hp:130,atk:50,def:2,money:12,exp:1,point:0,special:[]},E307:{name:"黄金史莱姆",hp:135,atk:60,def:1,money:1,exp:13,point:0,special:[]},E329:{name:"骷髅兵",hp:210,atk:140,def:102,money:15,exp:2,point:0,special:[],value:33},E330:{name:"八爪鱼",hp:300,atk:188,def:150,money:22,exp:3,point:0,special:[],value:37},E331:{name:"新敌人",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},E332:{name:"八爪鱼",hp:300,atk:188,def:150,money:22,exp:3,point:0,special:[],value:37},E333:{name:"毒八爪鱼",hp:938,atk:530,def:400,money:49,exp:5,point:0,special:[12],value:80},E334:{name:"四手史莱姆人",hp:280,atk:234,def:164,money:36,exp:4,point:0,special:[],value:52,n:15},E335:{name:"烈焰丧尸",hp:1097,atk:1024,def:789,money:80,exp:8,point:0,special:[72],reid:11,value:100},E336:{name:"新敌人",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},E337:{name:"邪眼史莱姆",hp:932,atk:621,def:404,money:55,exp:6,point:0,special:[50],value:70},E377:{name:"弓兵",hp:380,atk:10,def:200,money:37,exp:4,point:0,special:[55],value:60},E378:{name:"精锐弓兵",hp:620,atk:35,def:502,money:61,exp:7,point:0,special:[55],value:130},E379:{name:"箭神·法比",hp:2330,atk:155,def:1110,money:800,exp:190,point:0,special:[55],value:110},E380:{name:"斗神·高巴",hp:2110,atk:1287,def:1010,money:800,exp:190,point:0,special:[58],value:90},E381:{name:"触手植物",hp:592,atk:874,def:794,money:66,exp:7,point:0,special:[6],n:6,value:170},E382:{name:"冻死骨",hp:1080,atk:911,def:593,money:68,exp:7,point:0,special:[71],value:110,reid:374},E383:{name:"新敌人",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},E384:{name:"骷髅战士",hp:830,atk:570,def:390,money:20,exp:3,point:0,special:[13,23],value:76,reid:385,damage:3},E385:{name:"重生骷髅兵",hp:800,atk:610,def:320,money:30,exp:4,point:0,special:[57],value:50},E396:{name:"死灵大法师",hp:850,atk:175,def:490,money:63,exp:7,point:0,special:[60],value:190},E397:{name:"死灵术士",hp:905,atk:200,def:750,money:89,exp:9,point:0,special:[60],value:170},E411:{name:"闪光八爪鱼",hp:1044,atk:999,def:826,money:74,exp:8,point:0,special:[13],value:120,damage:10},E413:{name:"极地法师",hp:868,atk:155,def:720,money:84,exp:8,point:0,special:[2,73],reid:374,value:110},E414:{name:"鬼邪石",hp:30,atk:999,def:999,money:99,exp:9,point:0,special:[50,85],value:120},E431:{name:"黄金龙",hp:3000,atk:1530,def:1240,money:200,exp:180,point:0,special:[74],value:110},E432:{name:"毒龙",hp:2500,atk:1346,def:999,money:700,exp:150,point:0,special:[12],value:120},E433:{name:"皇室枪兵",hp:1390,atk:1700,def:1523,money:111,exp:12,point:0,special:[89],atkValue:32,defValue:8,value:130},E434:{name:"皇室剑士",hp:1108,atk:1393,def:1339,money:88,exp:10,point:0,special:[81],n:5,defValue:20,value:90},E435:{name:"生气灵",hp:872,atk:162,def:1531,money:109,exp:12,point:0,special:[2,88],value:200},E436:{name:"冥界矮人战士",hp:2000,atk:1497,def:1080,money:98,exp:10,point:0,special:[84],value:180},E437:{name:"魔眼",hp:994,atk:0,def:1343,money:94,exp:10,point:0,special:[80],value:10},E438:{name:"触手魔物",hp:600,atk:1634,def:1616,money:105,exp:11,point:0,special:[87],value:100,damage:4},E439:{name:"龙蝠",hp:1247,atk:1501,def:1307,money:95,exp:10,point:0,special:[82],value:80},E440:{name:"魔剑之凯撒",hp:3000,atk:2019,def:1479,money:0,exp:0,point:0,special:[91],value:0},E441:{name:"灵盾之柏奇",hp:3300,atk:1880,def:1619,money:0,exp:0,point:0,special:[92],value:0},E442:{name:"血剑士",hp:1800,atk:133,def:1411,money:130,exp:15,point:0,special:[55,67],value:160},E443:{name:"地狱马",hp:1002,atk:1660,def:1368,money:101,exp:11,point:0,special:[86],value:100,n:10},E444:{name:"血使者",hp:1900,atk:280,def:1241,money:140,exp:15,point:0,special:[65],value:150},E446:{name:"史莱姆阿修罗",hp:1440,atk:1579,def:1211,money:97,exp:11,point:0,special:[83],value:110,range:5,n:6},E447:{name:"魔界之王·古顿",hp:5000,atk:1966,def:1542,money:0,exp:0,point:0,special:[93],value:160}};var icons_4665ee12_3a1f_44a4_bea3_0fccba634dc1={hero:{down:{loc:0,stop:0,leftFoot:1,rightFoot:3},left:{loc:1,stop:0,leftFoot:1,rightFoot:3},right:{loc:2,stop:0,leftFoot:1,rightFoot:3},up:{loc:3,stop:0,leftFoot:1,rightFoot:3},width:32,height:48},terrains:{ground:0,grass:1,grass2:2,yellowWall:3,whiteWall:4,blueWall:5,snowGround:6,ground2:7,ground3:8,ground4:9,sand:10,ground5:11,yellowWall2:12,whiteWall2:13,blueWall2:14,blockWall:15,grayWall:16,white:17,ground6:18,soil:19,ground7:20,ground8:21,ice:22,downFloor:23,upFloor:24,T991:25,T992:26,T993:27,T994:28,T995:29,T996:30,"blueShop-left":31,"blueShop-right":32,"pinkShop-left":33,"pinkShop-right":34,arrowUp:35,arrowDown:36,arrowLeft:37,arrowRight:38,light:39,darkLight:40,ski:41,flower:42,box:43,boxed:44,T359:45,T360:46,T361:47,T362:48,T363:49,T364:50,T365:51,T366:52,T367:53,T368:54,T369:55,T370:56,T371:57,T372:58,T373:59,T390:60,T391:61,T392:62,T393:63,T394:64,T412:65,T448:66},animates:{star:0,lava:1,blueWater:2,water:3,yellowDoor:4,blueDoor:5,redDoor:6,greenDoor:7,specialDoor:8,steelDoor:9,yellowWall:10,whiteWall:11,blueWall:12,crystalUp:13,crystalBottom:14,starPortal:15,fire:16,portal:17,"switch":18,lavaNet:19,poisonNet:20,weakNet:21,curseNet:22,downPortal:23,leftPortal:24,rightPortal:25,upPortal:26,A376:27,A450:28,A374:29,A304:30,A452:31},npcs:{man:0,woman:1,thief:2,fairy:3,magician:4,womanMagician:5,oldMan:6,child:7,wood:8,pinkShop:9,blueShop:10,princess:11,wlt:12,wt:13,wrt:14,wl:15,wc:16,wr:17,wlb:18,wrb:19,dlt:20,dt:21,drt:22,dl:23,dc:24,dr:25,dlb:26,drb:27,N300:28,N301:29,ook:29,N302:28,N303:29,N386:30,N387:31,N388:32,N389:33,N408:34,N409:35,N410:36,N415:37,N416:38,N417:39,N418:40,N419:41,N420:42,N421:43,N422:44,N423:45,N424:46,N425:47,N426:48,N427:49,N428:50,N429:51,N430:52,N449:53,N454:54,N455:55,N456:56,N457:57,N458:58,N459:59,N460:60,N461:61,N462:62,N463:63,N464:64,N465:65,N466:66,N467:67,N468:68,N469:69,N470:70,N471:71,N472:72,N473:73,N474:74,N475:75,N476:76,N477:77,N478:78,N479:79,N480:80,N481:81,N482:82,N483:83,N484:84,N485:85,N486:86,N487:87,N488:88,N489:89},npc48:{npc0:0,npc1:1,npc2:2,npc3:3,npc4:4},enemys:{greenSlime:0,redSlime:1,blackSlime:2,slimelord:3,bat:4,bigBat:5,redBat:6,vampire:7,skeleton:8,skeletonSoilder:9,skeletonCaptain:10,ghostSkeleton:11,zombie:12,zombieKnight:13,rock:14,slimeMan:15,bluePriest:16,redPriest:17,brownWizard:18,redWizard:19,yellowGuard:20,blueGuard:21,redGuard:22,swordsman:23,soldier:24,yellowKnight:25,redKnight:26,darkKnight:27,blackKing:28,yellowKing:29,greenKing:30,blueKnight:31,goldSlime:32,poisonSkeleton:33,poisonBat:34,steelRock:35,skeletonPriest:36,skeletonKing:37,skeletonWizard:38,redSkeletonCaption:39,badHero:40,demon:41,demonPriest:42,goldHornSlime:43,redKing:44,whiteKing:45,blackMagician:46,silverSlime:47,swordEmperor:48,whiteHornSlime:49,badPrincess:50,badFairy:51,grayPriest:52,redSwordsman:53,whiteGhost:54,poisonZombie:55,magicDragon:56,octopus:57,darkFairy:58,greenKnight:59,E329:60,E330:61,E331:62,E332:63,E333:64,E334:65,E335:66,E336:67,E337:68,E377:69,E378:70,E379:71,E380:72,E381:73,E382:74,E383:75,E384:76,E385:77,E396:78,E397:79,E411:80,E413:81,E414:82,E431:83,E432:84,E433:85,E434:86,E435:87,E436:88,E437:89,E438:90,E439:91,E440:92,E441:93,E442:94,E443:95,E444:96,E446:97,E447:98},enemy48:{angel:0,elemental:1,steelGuard:2,evilBat:3},items:{yellowKey:0,blueKey:1,redKey:2,greenKey:3,bigKey:5,redGem:15,blueGem:16,greenGem:17,yellowGem:18,redPotion:19,bluePotion:20,greenPotion:21,yellowPotion:22,lifeWand:32,sword0:59,sword1:49,sword2:50,sword3:51,sword4:52,sword5:53,shield0:60,shield1:54,shield2:55,shield3:56,shield4:57,shield5:58,book:8,fly:11,pickaxe:44,icePickaxe:43,bomb:42,centerFly:12,upFly:14,downFly:13,coin:10,snow:40,cross:39,superPotion:28,earthquake:7,poisonWine:23,weakWine:24,curseWine:26,superWine:27,knife:41,moneyPocket:45,shoes:46,hammer:47,jumpShoes:48,skill1:29,wand:9,I305:6,I306:25,I307:30,I308:31,I309:33,I310:34,I311:35,I312:36,I313:37,I314:38,I316:62,I317:63,I318:64,I319:65,I320:66,I321:67,I322:68,I323:69,I324:70,I325:71,I326:72,I327:73,I328:74,I338:75,I339:76,I315:61,I375:77,I395:78,I398:79,I399:79,I400:80,I401:79,I402:80,I403:81,I404:79,I405:80,I406:81,I407:82,I445:83,A1:84,A2:85,A3:86,A4:87,A5:88,A6:89,A7:90,A8:91,A9:92,I451:93,iceCube:4,I453:94},autotile:{autotile:0,autotile1:0,autotile2:0,autotile3:0}};var maps_90f36752_8815_4be8_b32b_d7fad1d0542e={"1":{cls:"terrains",id:"yellowWall",canBreak:true,animate:1},"2":{cls:"terrains",id:"whiteWall",canBreak:true,animate:1},"3":{cls:"terrains",id:"blueWall",canBreak:true,animate:1},"4":{cls:"animates",id:"star"},"5":{cls:"animates",id:"lava"},"6":{cls:"terrains",id:"ice"},"7":{cls:"terrains",id:"blueShop-left"},"8":{cls:"terrains",id:"blueShop-right"},"9":{cls:"terrains",id:"pinkShop-left"},"10":{cls:"terrains",id:"pinkShop-right"},"11":{cls:"animates",id:"lavaNet",trigger:null,canPass:true,script:"(function () {\n\t// 血网的伤害效果移动到 checkBlock 中处理\n\n\t// 如果要做一次性血网，可直接注释掉下面这句话：\n\tif (core.hasItem('snow')) {\n\t\tcore.removeBlock(core.getHeroLoc('x'), core.getHeroLoc('y'));\n\t\tcore.autoGetItem();\n\t}\n})();"},"12":{cls:"animates",id:"poisonNet",trigger:"passNet"},"13":{cls:"animates",id:"weakNet",trigger:"passNet"},"14":{cls:"animates",id:"curseNet",trigger:"passNet"},"15":{cls:"animates",id:"blueWater"},"16":{cls:"animates",id:"water"},"20":{cls:"autotile",id:"autotile"},"21":{cls:"items",id:"yellowKey"},"22":{cls:"items",id:"blueKey"},"23":{cls:"items",id:"redKey"},"24":{cls:"items",id:"greenKey"},"25":{cls:"items",id:"iceCube"},"26":{cls:"items",id:"bigKey"},"27":{cls:"items",id:"redGem"},"28":{cls:"items",id:"blueGem"},"29":{cls:"items",id:"greenGem"},"30":{cls:"items",id:"yellowGem"},"31":{cls:"items",id:"redPotion"},"32":{cls:"items",id:"bluePotion"},"33":{cls:"items",id:"greenPotion"},"34":{cls:"items",id:"yellowPotion"},"35":{cls:"items",id:"sword1"},"36":{cls:"items",id:"shield1"},"37":{cls:"items",id:"sword2"},"38":{cls:"items",id:"shield2"},"39":{cls:"items",id:"sword3"},"40":{cls:"items",id:"shield3"},"41":{cls:"items",id:"sword4"},"42":{cls:"items",id:"shield4"},"43":{cls:"items",id:"sword5"},"44":{cls:"items",id:"shield5"},"45":{cls:"items",id:"book"},"46":{cls:"items",id:"fly"},"47":{cls:"items",id:"pickaxe"},"48":{cls:"items",id:"icePickaxe"},"49":{cls:"items",id:"bomb"},"50":{cls:"items",id:"centerFly"},"51":{cls:"items",id:"upFly"},"52":{cls:"items",id:"downFly"},"53":{cls:"items",id:"coin"},"54":{cls:"items",id:"snow"},"55":{cls:"items",id:"cross"},"56":{cls:"items",id:"superPotion"},"57":{cls:"items",id:"earthquake"},"58":{cls:"items",id:"poisonWine"},"59":{cls:"items",id:"weakWine"},"60":{cls:"items",id:"curseWine"},"61":{cls:"items",id:"superWine"},"62":{cls:"items",id:"knife"},"63":{cls:"items",id:"moneyPocket"},"64":{cls:"items",id:"shoes"},"65":{cls:"items",id:"hammer"},"68":{cls:"items",id:"lifeWand"},"69":{cls:"items",id:"jumpShoes"},"70":{cls:"items",id:"sword0"},"71":{cls:"items",id:"shield0"},"72":{cls:"items",id:"skill1"},"73":{cls:"items",id:"wand"},"81":{cls:"animates",id:"yellowDoor",trigger:"openDoor",doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{yellowKey:1}},animate:1,name:"黄门"},"82":{cls:"animates",id:"blueDoor",trigger:"openDoor",doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{blueKey:1}},animate:1,name:"蓝门"},"83":{cls:"animates",id:"redDoor",trigger:"openDoor",doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{redKey:1}},animate:1,name:"红门"},"84":{cls:"animates",id:"greenDoor",trigger:"openDoor",doorInfo:{time:1,openSound:"door.mp3",closeSound:"door.mp3",keys:{greenKey:1},afterOpenDoor:[{type:"setBlock",number:"yellowDoor"},{type:"function","function":"function(){\ncore.drawTip('随意门使用成功');\n}"}]},animate:1,name:"可被使用随意门的墙"},"85":{cls:"animates",id:"specialDoor",trigger:"openDoor",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{specialKey:1}},name:"机关门"},"86":{cls:"animates",id:"steelDoor",trigger:"openDoor",doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{yellowKey:1}},animate:1,name:"铁门"},"87":{cls:"terrains",id:"upFloor",canPass:true},"88":{cls:"terrains",id:"downFloor",script:null,canPass:true},"89":{cls:"animates",id:"portal"},"90":{cls:"animates",id:"starPortal"},"91":{cls:"animates",id:"upPortal"},"92":{cls:"animates",id:"leftPortal"},"93":{cls:"animates",id:"downPortal"},"94":{cls:"animates",id:"rightPortal"},"101":{cls:"animates",id:"crystalUp"},"102":{cls:"animates",id:"crystalBottom"},"103":{cls:"animates",id:"fire"},"104":{cls:"animates",id:"switch"},"121":{cls:"npcs",id:"man"},"122":{cls:"npcs",id:"woman"},"123":{cls:"npcs",id:"thief"},"124":{cls:"npcs",id:"fairy"},"125":{cls:"npcs",id:"magician"},"126":{cls:"npcs",id:"womanMagician"},"127":{cls:"npcs",id:"oldMan"},"128":{cls:"npcs",id:"child"},"129":{cls:"npcs",id:"wood"},"130":{cls:"npcs",id:"pinkShop"},"131":{cls:"npcs",id:"blueShop"},"132":{cls:"npcs",id:"princess"},"133":{cls:"npc48",id:"npc0"},"134":{cls:"npc48",id:"npc1"},"135":{cls:"npc48",id:"npc2"},"136":{cls:"npc48",id:"npc3"},"137":{cls:"npc48",id:"npc4"},"151":{cls:"autotile",id:"autotile1"},"152":{cls:"autotile",id:"autotile2"},"153":{cls:"autotile",id:"autotile3"},"161":{cls:"terrains",id:"arrowUp",cannotOut:["left","right","down"],cannotIn:["down"]},"162":{cls:"terrains",id:"arrowDown",cannotOut:["left","right","up"],cannotIn:["up"]},"163":{cls:"terrains",id:"arrowLeft",cannotOut:["up","down","right"],cannotIn:["right"]},"164":{cls:"terrains",id:"arrowRight",cannotOut:["up","down","left"],cannotIn:["left"]},"165":{cls:"terrains",id:"light",trigger:"changeLight",canPass:true},"166":{cls:"terrains",id:"darkLight"},"167":{cls:"terrains",id:"ski",trigger:"ski",canPass:true},"168":{cls:"terrains",id:"flower",canPass:true},"169":{cls:"terrains",id:"box",trigger:null,canPass:true},"170":{cls:"terrains",id:"boxed",trigger:null,canPass:true},"181":{cls:"npcs",id:"wlt"},"182":{cls:"npcs",id:"wt"},"183":{cls:"npcs",id:"wrt"},"184":{cls:"npcs",id:"wl"},"185":{cls:"npcs",id:"wc"},"186":{cls:"npcs",id:"wr"},"187":{cls:"npcs",id:"wlb"},"188":{cls:"npcs",id:"wrb"},"189":{cls:"npcs",id:"dlt"},"190":{cls:"npcs",id:"dt"},"191":{cls:"npcs",id:"drt"},"192":{cls:"npcs",id:"dl"},"193":{cls:"npcs",id:"dc"},"194":{cls:"npcs",id:"dr"},"195":{cls:"npcs",id:"dlb"},"196":{cls:"npcs",id:"drb"},"198":{cls:"npcs",id:"ook"},"201":{cls:"enemys",id:"greenSlime"},"202":{cls:"enemys",id:"redSlime"},"203":{cls:"enemys",id:"blackSlime"},"204":{cls:"enemys",id:"slimelord"},"205":{cls:"enemys",id:"bat"},"206":{cls:"enemys",id:"bigBat"},"207":{cls:"enemys",id:"redBat"},"208":{cls:"enemys",id:"vampire"},"209":{cls:"enemys",id:"skeleton"},"210":{cls:"enemys",id:"skeletonSoilder"},"211":{cls:"enemys",id:"skeletonCaptain"},"212":{cls:"enemys",id:"ghostSkeleton"},"213":{cls:"enemys",id:"zombie"},"214":{cls:"enemys",id:"zombieKnight"},"215":{cls:"enemys",id:"rock"},"216":{cls:"enemys",id:"slimeMan"},"217":{cls:"enemys",id:"bluePriest"},"218":{cls:"enemys",id:"redPriest"},"219":{cls:"enemys",id:"brownWizard"},"220":{cls:"enemys",id:"redWizard"},"221":{cls:"enemys",id:"yellowGuard"},"222":{cls:"enemys",id:"blueGuard"},"223":{cls:"enemys",id:"redGuard"},"224":{cls:"enemys",id:"swordsman"},"225":{cls:"enemys",id:"soldier"},"226":{cls:"enemys",id:"yellowKnight"},"227":{cls:"enemys",id:"redKnight"},"228":{cls:"enemys",id:"darkKnight"},"229":{cls:"enemys",id:"blackKing"},"230":{cls:"enemys",id:"yellowKing"},"231":{cls:"enemys",id:"greenKing"},"232":{cls:"enemys",id:"blueKnight"},"233":{cls:"enemys",id:"goldSlime"},"234":{cls:"enemys",id:"poisonSkeleton"},"235":{cls:"enemys",id:"poisonBat"},"236":{cls:"enemys",id:"steelRock"},"237":{cls:"enemys",id:"skeletonPriest"},"238":{cls:"enemys",id:"skeletonKing"},"239":{cls:"enemys",id:"skeletonWizard"},"240":{cls:"enemys",id:"redSkeletonCaption"},"241":{cls:"enemys",id:"badHero"},"242":{cls:"enemys",id:"demon"},"243":{cls:"enemys",id:"demonPriest"},"244":{cls:"enemys",id:"goldHornSlime"},"245":{cls:"enemys",id:"redKing"},"246":{cls:"enemys",id:"whiteKing"},"247":{cls:"enemys",id:"blackMagician"},"248":{cls:"enemys",id:"silverSlime"},"249":{cls:"enemys",id:"swordEmperor"},"250":{cls:"enemys",id:"whiteHornSlime"},"251":{cls:"enemys",id:"badPrincess"},"252":{cls:"enemys",id:"badFairy"},"253":{cls:"enemys",id:"grayPriest"},"254":{cls:"enemys",id:"redSwordsman"},"255":{cls:"enemys",id:"whiteGhost"},"256":{cls:"enemys",id:"poisonZombie"},"257":{cls:"enemys",id:"magicDragon"},"258":{cls:"enemys",id:"octopus"},"259":{cls:"enemys",id:"darkFairy"},"260":{cls:"enemys",id:"greenKnight"},"261":{cls:"enemy48",id:"angel"},"262":{cls:"enemy48",id:"elemental"},"263":{cls:"enemy48",id:"steelGuard"},"264":{cls:"enemy48",id:"evilBat"},"300":{cls:"npcs",id:"N300"},"301":{cls:"npcs",id:"N301"},"302":{cls:"npcs",id:"N302"},"303":{cls:"npcs",id:"N303"},"304":{cls:"animates",id:"A304",animate:4,canPass:true,script:"(function () {\n\thero.mana += (hero.manamax / 6);\n\tcore.removeBlock(core.getHeroLoc('x'), core.getHeroLoc('y'));\n\tcore.drawTip('获得 亡灵之火，回复一整格气息');\n\tcore.autoGetItem();\n})();"},"305":{cls:"items",id:"I305"},"306":{cls:"items",id:"I306"},"307":{cls:"items",id:"I307"},"308":{cls:"items",id:"I308"},"309":{cls:"items",id:"I309"},"310":{cls:"items",id:"I310"},"311":{cls:"items",id:"I311"},"312":{cls:"items",id:"I312"},"313":{cls:"items",id:"I313"},"314":{cls:"items",id:"I314"},"315":{cls:"items",id:"I315"},"316":{cls:"items",id:"I316"},"317":{cls:"items",id:"I317"},"318":{cls:"items",id:"I318"},"319":{cls:"items",id:"I319"},"320":{cls:"items",id:"I320"},"321":{cls:"items",id:"I321"},"322":{cls:"items",id:"I322"},"323":{cls:"items",id:"I323"},"324":{cls:"items",id:"I324"},"325":{cls:"items",id:"I325"},"326":{cls:"items",id:"I326"},"327":{cls:"items",id:"I327"},"328":{cls:"items",id:"I328"},"329":{cls:"enemys",id:"E329"},"330":{cls:"enemys",id:"E330"},"331":{cls:"enemys",id:"E331"},"332":{cls:"enemys",id:"E332"},"333":{cls:"enemys",id:"E333"},"334":{cls:"enemys",id:"E334"},"335":{cls:"enemys",id:"E335"},"336":{cls:"enemys",id:"E336"},"337":{cls:"enemys",id:"E337"},"338":{cls:"items",id:"I338"},"339":{cls:"items",id:"I339"},"340":{cls:"terrains",id:"ground",canPass:true},"341":{cls:"terrains",id:"grass"},"342":{cls:"terrains",id:"grass2"},"343":{cls:"terrains",id:"snowGround"},"344":{cls:"terrains",id:"ground2"},"345":{cls:"terrains",id:"ground3",canPass:true},"346":{cls:"terrains",id:"ground4",canPass:true},"347":{cls:"terrains",id:"sand"},"348":{cls:"terrains",id:"ground5"},"349":{cls:"terrains",id:"yellowWall2"},"350":{cls:"terrains",id:"whiteWall2"},"351":{cls:"terrains",id:"blueWall2"},"352":{cls:"terrains",id:"blockWall"},"353":{cls:"terrains",id:"grayWall",canPass:true},"354":{cls:"terrains",id:"white",canPass:true},"355":{cls:"terrains",id:"ground6",canPass:true},"356":{cls:"terrains",id:"soil",canPass:true},"357":{cls:"terrains",id:"ground7",canPass:true},"358":{cls:"terrains",id:"ground8",canPass:true},"359":{cls:"terrains",id:"T359",canPass:true},"360":{cls:"terrains",id:"T360",canPass:true},"361":{cls:"terrains",id:"T361",canPass:true},"362":{cls:"terrains",id:"T362",canPass:true},"363":{cls:"terrains",id:"T363"},"364":{cls:"terrains",id:"T364",canPass:true},"365":{cls:"terrains",id:"T365",canPass:true},"366":{cls:"terrains",id:"T366",canPass:true},"367":{cls:"terrains",id:"T367",canPass:true},"368":{cls:"terrains",id:"T368",canPass:true},"369":{cls:"terrains",id:"T369",canPass:true},"370":{cls:"terrains",id:"T370",canPass:true},"371":{cls:"terrains",id:"T371",canPass:true},"372":{cls:"terrains",id:"T372",canPass:true},"373":{cls:"terrains",id:"T373",canPass:true},"374":{cls:"animates",id:"A374",trigger:"openDoor",doorInfo:{time:1,openSound:"door.mp3",closeSound:"door.mp3",keys:{greenKey:1},afterOpenDoor:[{type:"function","function":"function(){\ncore.drawTip('随意门使用成功');\n}"}]}},"375":{cls:"items",id:"I375"},"376":{cls:"animates",id:"A376",canPass:true},"377":{cls:"enemys",id:"E377"},"378":{cls:"enemys",id:"E378"},"379":{cls:"enemys",id:"E379"},"380":{cls:"enemys",id:"E380"},"381":{cls:"enemys",id:"E381"},"382":{cls:"enemys",id:"E382"},"383":{cls:"enemys",id:"E383"},"384":{cls:"enemys",id:"E384"},"385":{cls:"enemys",id:"E385"},"386":{cls:"npcs",id:"N386"},"387":{cls:"npcs",id:"N387"},"388":{cls:"npcs",id:"N388"},"389":{cls:"npcs",id:"N389"},"390":{cls:"terrains",id:"T390",canPass:true},"391":{cls:"terrains",id:"T391",canPass:true},"392":{cls:"terrains",id:"T392"},"393":{cls:"terrains",id:"T393"},"394":{cls:"terrains",id:"T394"},"395":{cls:"items",id:"I395"},"396":{cls:"enemys",id:"E396"},"397":{cls:"enemys",id:"E397"},"398":{cls:"items",id:"I398"},"399":{cls:"items",id:"I399"},"400":{cls:"items",id:"I400"},"401":{cls:"items",id:"I401"},"402":{cls:"items",id:"I402"},"403":{cls:"items",id:"I403"},"404":{cls:"items",id:"I404"},"405":{cls:"items",id:"I405"},"406":{cls:"items",id:"I406"},"407":{cls:"items",id:"I407"},"408":{cls:"npcs",id:"N408"},"409":{cls:"npcs",id:"N409"},"410":{cls:"npcs",id:"N410"},"411":{cls:"enemys",id:"E411"},"412":{cls:"terrains",id:"T412"},"413":{cls:"enemys",id:"E413"},"414":{cls:"enemys",id:"E414"},"415":{cls:"npcs",id:"N415"},"416":{cls:"npcs",id:"N416"},"417":{cls:"npcs",id:"N417"},"418":{cls:"npcs",id:"N418"},"419":{cls:"npcs",id:"N419"},"420":{cls:"npcs",id:"N420"},"421":{cls:"npcs",id:"N421"},"422":{cls:"npcs",id:"N422"},"423":{cls:"npcs",id:"N423"},"424":{cls:"npcs",id:"N424"},"425":{cls:"npcs",id:"N425"},"426":{cls:"npcs",id:"N426"},"427":{cls:"npcs",id:"N427"},"428":{cls:"npcs",id:"N428"},"429":{cls:"npcs",id:"N429"},"430":{cls:"npcs",id:"N430"},"431":{cls:"enemys",id:"E431"},"432":{cls:"enemys",id:"E432"},"433":{cls:"enemys",id:"E433"},"434":{cls:"enemys",id:"E434"},"435":{cls:"enemys",id:"E435"},"436":{cls:"enemys",id:"E436"},"437":{cls:"enemys",id:"E437"},"438":{cls:"enemys",id:"E438"},"439":{cls:"enemys",id:"E439"},"440":{cls:"enemys",id:"E440"},"441":{cls:"enemys",id:"E441"},"442":{cls:"enemys",id:"E442"},"443":{cls:"enemys",id:"E443"},"444":{cls:"enemys",id:"E444"},"445":{cls:"items",id:"I445"},"446":{cls:"enemys",id:"E446"},"447":{cls:"enemys",id:"E447"},"448":{cls:"terrains",id:"T448"},"449":{cls:"npcs",id:"N449"},"450":{cls:"animates",id:"A450",trigger:"openDoor",animate:1,doorInfo:{time:1,openSound:"door.mp3",closeSound:"door.mp3",keys:{greenKey:1},afterOpenDoor:[{type:"setBlock",number:"A376"},{type:"function","function":"function(){\ncore.drawTip('随意门使用成功');\n}"}]}},"451":{cls:"items",id:"I451"},"452":{cls:"animates",id:"A452",trigger:"openDoor",animate:1,doorInfo:{time:1,openSound:"door.mp3",closeSound:"door.mp3",keys:{greenKey:1},afterOpenDoor:[{type:"function","function":"function(){\ncore.drawTip('随意门使用成功');\n}"}]}},"453":{cls:"items",id:"I453"},"454":{cls:"npcs",id:"N454"},"455":{cls:"npcs",id:"N455"},"456":{cls:"npcs",id:"N456"},"457":{cls:"npcs",id:"N457"},"458":{cls:"npcs",id:"N458"},"459":{cls:"npcs",id:"N459"},"460":{cls:"npcs",id:"N460"},"461":{cls:"npcs",id:"N461"},"462":{cls:"npcs",id:"N462"},"463":{cls:"npcs",id:"N463"},"464":{cls:"npcs",id:"N464"},"465":{cls:"npcs",id:"N465"},"466":{cls:"npcs",id:"N466"},"467":{cls:"npcs",id:"N467"},"468":{cls:"npcs",id:"N468"},"469":{cls:"npcs",id:"N469"},"470":{cls:"npcs",id:"N470"},"471":{cls:"npcs",id:"N471"},"472":{cls:"npcs",id:"N472"},"473":{cls:"npcs",id:"N473"},"474":{cls:"npcs",id:"N474"},"475":{cls:"npcs",id:"N475"},"476":{cls:"npcs",id:"N476"},"477":{cls:"npcs",id:"N477"},"478":{cls:"npcs",id:"N478"},"479":{cls:"npcs",id:"N479"},"480":{cls:"npcs",id:"N480"},"481":{cls:"npcs",id:"N481"},"482":{cls:"npcs",id:"N482"},"483":{cls:"npcs",id:"N483"},"484":{cls:"npcs",id:"N484"},"485":{cls:"npcs",id:"N485"},"486":{cls:"npcs",id:"N486"},"487":{cls:"npcs",id:"N487"},"488":{cls:"npcs",id:"N488"},"489":{cls:"npcs",id:"N489"},"991":{cls:"terrains",id:"T991"},"992":{cls:"terrains",id:"T992"},"993":{cls:"terrains",id:"T993"},"994":{cls:"terrains",id:"T994"},"995":{cls:"terrains",id:"T995"},"996":{cls:"terrains",id:"T996"},"5001":{cls:"items",id:"A1"},"5002":{cls:"items",id:"A2"},"5003":{cls:"items",id:"A3"},"5004":{cls:"items",id:"A4"},"5005":{cls:"items",id:"A5"},"5006":{cls:"items",id:"A6"},"5007":{cls:"items",id:"A7"},"5008":{cls:"items",id:"A8"},"5009":{cls:"items",id:"A9"},"10017":{cls:"tileset",id:"X10017",canPass:true},"10024":{cls:"tileset",id:"X10024",canPass:true},"10026":{cls:"tileset",id:"X10026",canPass:true},"10033":{cls:"tileset",id:"X10033",canPass:true}};var items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a={yellowKey:{cls:"tools",name:"黄钥匙",text:"可以打开一扇黄门",hideInToolbox:true},blueKey:{cls:"tools",name:"蓝钥匙",text:"可以打开一扇蓝门",hideInToolbox:true},redKey:{cls:"tools",name:"红钥匙",text:"可以打开一扇红门",hideInToolbox:true},redGem:{cls:"items",name:"红宝石",text:"攻击+${core.values.redGem}",itemEffect:"core.status.hero.atk += core.values.redGem",itemEffectTip:"，攻击力+${core.values.redGem}",useItemEffect:"core.status.hero.atk += core.values.redGem",canUseItemEffect:"true"},blueGem:{cls:"items",name:"蓝宝石",text:"，防御+${core.values.blueGem}",itemEffect:"core.status.hero.def += core.values.blueGem",itemEffectTip:"，防御力+${core.values.blueGem}",useItemEffect:"core.status.hero.def += core.values.blueGem",canUseItemEffect:"true"},greenGem:{cls:"items",name:"绿宝石",text:"，气息条上限-1",itemEffect:'var h = { "mana": core.status.hero.mana, "mmm": core.status.hero.manamax / 6 };\ncore.setKiMana(h);\nif (h.charge == h.mmm) {\n\tif (flags.bugFix) h.charge--;\n\telse core.addFlag(\'overCharge\', 1);\n}\ncore.status.hero.manamax -= 6;\nh.mmm--;\ncore.setKiMana(h);\ncore.status.hero.mana = h.mana;',itemEffectTip:"，气息条上限-1",useItemEffect:"core.status.hero.mana -= Math.floor(core.status.hero.mana / core.status.hero.manamax);\ncore.status.hero.manamax -= 6;",canUseItemEffect:"true"},yellowGem:{cls:"items",name:"黄宝石",text:"，疲劳上限增加",itemEffect:"core.addFlag('deepBreath', 2)",itemEffectTip:"，深呼吸回复的疲劳+2",useItemEvent:null,canUseItemEffect:"true"},redPotion:{cls:"items",name:"伤药",text:"，生命+${core.values.redPotion}",itemEffect:"core.status.hero.hp += core.values.redPotion",itemEffectTip:"，体力+${core.values.redPotion}",useItemEffect:"core.status.hero.hp += core.values.redPotion",canUseItemEffect:"true"},bluePotion:{cls:"items",name:"高级伤药",text:"，生命+${core.values.bluePotion}",itemEffect:"core.status.hero.hp += core.values.bluePotion",itemEffectTip:"，体力+${core.values.bluePotion}",useItemEffect:"core.status.hero.hp += core.values.bluePotion",canUseItemEffect:"true"},yellowPotion:{cls:"items",name:"能量水",text:null,itemEffect:"core.addFlag('tiredMax', 2)",itemEffectTip:"，能使用技能的疲劳阈值+2",useItemEffect:null,canUseItemEffect:"true"},greenPotion:{cls:"items",name:"经验药水",text:null,itemEffect:"core.status.hero.exp += 5",itemEffectTip:"，EXP+5",useItemEffect:"core.status.hero.exp += 5",canUseItemEffect:"true"},sword0:{cls:"items",name:"破旧的剑",text:"一把已经生锈的剑",equip:{type:0,animate:"sword",value:{atk:0}},itemEffect:"core.status.hero.atk += 0",itemEffectTip:"，攻击+0"},sword1:{cls:"items",name:"铁剑",text:"一把很普通的铁剑",equip:{type:0,animate:"sword",value:{atk:10}},itemEffect:"core.status.hero.atk += 10",itemEffectTip:"，攻击+10"},sword2:{cls:"items",name:"银剑",text:"一把很普通的银剑",equip:{type:0,animate:"sword",value:{atk:20}},itemEffect:"core.status.hero.atk += 20",itemEffectTip:"，攻击+20"},sword3:{cls:"items",name:"骑士剑",text:"一把很普通的骑士剑",equip:{type:0,animate:"sword",value:{atk:40}},itemEffect:"core.status.hero.atk += 40",itemEffectTip:"，攻击+40"},sword4:{cls:"items",name:"圣剑",text:"一把很普通的圣剑",equip:{type:0,animate:"sword",value:{atk:80}},itemEffect:"core.status.hero.atk += 80",itemEffectTip:"，攻击+80"},sword5:{cls:"items",name:"神圣剑",text:"一把很普通的神圣剑",equip:{type:0,animate:"sword",value:{atk:160}},itemEffect:"core.status.hero.atk += 100",itemEffectTip:"，攻击+100"},shield0:{cls:"items",name:"破旧的盾",text:"一个很破旧的铁盾",equip:{type:1,value:{def:0}},itemEffect:"core.status.hero.def += 0",itemEffectTip:"，防御+0"},shield1:{cls:"items",name:"铁盾",text:"一个很普通的铁盾",equip:{type:1,value:{def:10}},itemEffect:"core.status.hero.def += 10",itemEffectTip:"，防御+10"},shield2:{cls:"items",name:"银盾",text:"一个很普通的银盾",equip:{type:1,value:{def:20}},itemEffect:"core.status.hero.def += 20",itemEffectTip:"，防御+20"},shield3:{cls:"constants",name:"火神之水晶球(未鉴定)",text:"需要交给主塔25F老人进行鉴定",equip:null,itemEffect:null,itemEffectTip:null},shield4:{cls:"constants",name:"树精之水晶球(未鉴定)",text:"需要交给主塔25F老人进行鉴定",equip:null,itemEffect:null,itemEffectTip:null},shield5:{cls:"constants",name:"海王之水晶球(未鉴定)",text:"需要交给主塔25F老人进行鉴定",equip:null,itemEffect:null,itemEffectTip:null},superPotion:{cls:"items",name:"圣水",itemEffect:"core.status.hero.hp = Math.floor(0.5 + 1.5 * core.status.hero.hp)",itemEffectTip:"，体力1.5倍",useItemEffect:"core.status.hero.hp *= 2; core.playSound('回血');",canUseItemEffect:"true",text:"生命值x1.5"},moneyPocket:{cls:"constants",name:"冒险袋",itemEffect:null,itemEffectTip:null,text:"存储草药精华和高级草药精华，可选择给勇士或公主使用",useItemEffect:null,canUseItemEffect:"true",useItemEvent:[{type:"setValue",name:"flag:keyDown",value:"true"},{type:"choices",text:"给谁使用草药精华？",choices:[{text:"勇者",icon:"N449",action:[{type:"while",condition:"true",data:[{type:"choices",text:"\t[给勇者使用,N449]\\i[I324]：体力+80,回复中毒\n\\i[I323]：体力+180,回复衰弱",choices:[{text:"×${core.getFlag('red_herb',0)}",icon:"I324",need:"core.getFlag('red_herb',0)>0",action:[{type:"setValue",name:"flag:red_herb",operator:"-=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"80"},{type:"function","function":"function(){\ncore.triggerDebuff('remove', 'poison')\n}"},{type:"playSound",name:"recovery.mp3"}]},{text:"×${core.getFlag('blue_herb',0)}",icon:"I323",need:"core.getFlag('blue_herb',0)>0",action:[{type:"setValue",name:"flag:blue_herb",operator:"-=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"180"},{type:"function","function":"function(){\ncore.triggerDebuff('remove', 'weak')\n}"},{type:"playSound",name:"recovery.mp3"}]},{text:"退出",action:[{type:"setValue",name:"flag:keyDown",value:"false"},{type:"exit"}]}]}]}]},{text:"公主",icon:"princess",action:[{type:"while",condition:"true",data:[{type:"choices",text:"\t[给公主使用,princess]\\i[I324]：体力+80\n\\i[I323]：体力+180",choices:[{text:"×${core.getFlag('red_herb',0)}",icon:"I324",need:"core.getFlag('red_herb',0)>0",action:[{type:"setValue",name:"flag:red_herb",operator:"-=",value:"1"},{type:"setValue",name:"status:hpmax",operator:"+=",value:"80"},{type:"playSound",name:"recovery.mp3"}]},{text:"×${core.getFlag('blue_herb',0)}",icon:"I323",need:"core.getFlag('blue_herb',0)>0",action:[{type:"setValue",name:"flag:blue_herb",operator:"-=",value:"1"},{type:"setValue",name:"status:hpmax",operator:"+=",value:"180"},{type:"playSound",name:"recovery.mp3"}]},{text:"退出",action:[{type:"setValue",name:"flag:keyDown",value:"false"},{type:"exit"}]}]}]}]},{text:"退出",action:[]}]}]},book:{cls:"constants",name:"心镜",text:"可以查看当前楼层各怪物属性，包括衍生怪物",hideInToolbox:true,useItemEffect:"core.ui.drawBook(0);",canUseItemEffect:"true"},fly:{cls:"constants",name:"黄金色羽根",text:"可以自由往来去过的楼层",hideInReplay:true,hideInToolbox:false,useItemEffect:"core.ui.drawFly(core.floorIds.indexOf(core.status.floorId));",canUseItemEffect:"(function () {\n\tif (core.flags.flyNearStair && !core.nearStair()) return false;\n\tvar xieyan = false;\n\tcore.status.thisMap.blocks.forEach(function (b) {\n\t\tif (b.event.cls == 'enemys' && core.hasSpecial(b.event.id, 50)) xieyan = true;\n\t});\n\tif (xieyan) {\n\t\treturn false;\n\t}\n\treturn core.status.maps[core.status.floorId].canFlyFrom;\n})();"},coin:{cls:"items",name:"大金币",text:null,itemEffect:"hero.money += 200;",itemEffectTip:"，金钱+200"},snow:{cls:"constants",name:"永恒冰结晶",text:"减少受熔岩伤害，并能移除熔岩",useItemEffect:"(function () {\n\tvar success = false;\n\n\tvar snowFourDirections = false; // 是否四方向雪花；如果是将其改成true\n\tif (snowFourDirections) {\n\t\t// 四方向雪花\n\t\tfor (var direction in core.utils.scan) {\n\t\t\tvar delta = core.utils.scan[direction];\n\t\t\tvar nx = core.getHeroLoc('x') + delta.x,\n\t\t\t\tny = core.getHeroLoc('y') + delta.y;\n\t\t\tif (core.getBlockId(nx, ny) == 'lava') {\n\t\t\t\tcore.removeBlock(nx, ny);\n\t\t\t\tsuccess = true;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (core.getBlockId(core.nextX(), core.nextY()) == 'lava') {\n\t\t\tcore.removeBlock(core.nextX(), core.nextY());\n\t\t\tsuccess = true;\n\t\t}\n\t}\n\n\tif (success) {\n\t\tcore.playSound('打开界面');\n\t\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n\t} else {\n\t\tcore.playSound('操作失败');\n\t\tcore.drawTip(\"当前无法使用\" + core.material.items[itemId].name);\n\t\tcore.addItem(itemId, 1);\n\t\treturn;\n\t}\n})();",canUseItemEffect:"false",hideInToolbox:false},cross:{cls:"items",name:"神之护符",text:null,itemEffect:"core.status.hero.mdef += 5",itemEffectTip:"，公主的魔法防御+5"},knife:{cls:"constants",name:"强剑之首饰",text:"一击秒杀白银系怪物"},shoes:{cls:"constants",name:"护符",text:"持有时无视负面地形"},bigKey:{cls:"items",name:"魔法匙",text:"可以开启当前层所有黄门",itemEffect:"core.addItem('yellowKey', 1);\ncore.addItem('blueKey', 1);\ncore.addItem('redKey', 1);",itemEffectTip:"，钥匙数各+1",useItemEffect:'(function () {\n\tvar actions = core.searchBlock("yellowDoor").map(function (block) {\n\t\treturn { "type": "openDoor", "loc": [block.x, block.y], "async": true };\n\t});\n\tactions.push({ "type": "waitAsync" });\n\tactions.push({ "type": "tip", "text": core.material.items[itemId].name + "使用成功" });\n\tcore.insertAction(actions);\n})();',canUseItemEffect:"(function () {\n\treturn core.searchBlock('yellowDoor').length > 0;\n})();"},greenKey:{cls:"tools",name:"随意门",text:"可以将特定墙体（以紫门标识）变为黄门或传送阵，或移除冰块。直接撞击对应的墙体或冰块即可。"},pickaxe:{cls:"constants",name:"锄头",text:"可变为宝石锄头",useItemEffect:"(function () {\n\tvar canBreak = function (x, y) {\n\t\tvar block = core.getBlock(x, y);\n\t\tif (block == null || block.disable) return false;\n\t\treturn block.event.canBreak;\n\t};\n\n\tvar success = false;\n\tvar pickaxeFourDirections = false; // 是否四方向破；如果是将其改成true\n\tif (pickaxeFourDirections) {\n\t\t// 四方向破\n\t\tfor (var direction in core.utils.scan) {\n\t\t\tvar delta = core.utils.scan[direction];\n\t\t\tvar nx = core.getHeroLoc('x') + delta.x,\n\t\t\t\tny = core.getHeroLoc('y') + delta.y;\n\t\t\tif (canBreak(nx, ny)) {\n\t\t\t\tcore.removeBlock(nx, ny);\n\t\t\t\tsuccess = true;\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// 仅破当前\n\t\tif (canBreak(core.nextX(), core.nextY())) {\n\t\t\tcore.removeBlock(core.nextX(), core.nextY());\n\t\t\tsuccess = true;\n\t\t}\n\t}\n\n\tif (success) {\n\t\tcore.playSound('破墙镐');\n\t\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n\t} else {\n\t\t// 无法使用\n\t\tcore.playSound('操作失败');\n\t\tcore.drawTip(\"当前无法使用\" + core.material.items[itemId].name);\n\t\tcore.addItem(itemId, 1);\n\t\treturn;\n\t}\n})();",canUseItemEffect:"false"},icePickaxe:{cls:"constants",name:"宝石锄头",text:"恶龙最爱",useItemEffect:"(function () {\n\tcore.removeBlock(core.nextX(), core.nextY());\n\tcore.playSound('打开界面');\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n})();",canUseItemEffect:"false"},bomb:{cls:"tools",name:"炸弹",text:"可以炸掉勇士面前的怪物",useItemEffect:"(function () {\n\tvar canBomb = function (x, y) {\n\t\tvar block = core.getBlock(x, y);\n\t\tif (block == null || block.disable || block.event.cls.indexOf('enemy') != 0) return false;\n\t\tvar enemy = core.material.enemys[block.event.id];\n\t\treturn enemy && !enemy.notBomb;\n\t};\n\n\tvar bombList = []; // 炸掉的怪物坐标列表\n\tvar bombFourDirections = false; // 是否四方向可炸；如果是将其改成true。\n\tif (bombFourDirections) {\n\t\t// 四方向炸\n\t\tfor (var direction in core.utils.scan) {\n\t\t\tvar delta = core.utils.scan[direction];\n\t\t\tvar nx = core.getHeroLoc('x') + delta.x,\n\t\t\t\tny = core.getHeroLoc('y') + delta.y;\n\t\t\tif (canBomb(nx, ny)) {\n\t\t\t\tbombList.push([nx, ny]);\n\t\t\t\tcore.removeBlock(nx, ny);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// 仅炸当前\n\t\tif (canBomb(core.nextX(), core.nextY())) {\n\t\t\tbombList.push([core.nextX(), core.nextY()]);\n\t\t\tcore.removeBlock(core.nextX(), core.nextY());\n\t\t}\n\t}\n\n\tif (bombList.length > 0) {\n\t\tcore.playSound('炸弹');\n\t\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n\t} else {\n\t\tcore.playSound('操作失败');\n\t\tcore.drawTip('当前无法使用' + core.material.items[itemId].name);\n\t\tcore.addItem(itemId, 1);\n\t\treturn;\n\t}\n\n\t// 炸弹后事件\n\t// 这是一个使用炸弹也能开门的例子\n\t/*\n\tif (core.status.floorId=='xxx' && core.terrainExists(x0,y0,'specialDoor') // 某个楼层，该机关门存在\n\t\t&& !core.enemyExists(x1,y1) && !core.enemyExists(x2,y2)) // 且守门的怪物都不存在\n\t{\n\t\tcore.insertAction([ // 插入事件\n\t\t\t{\"type\": \"openDoor\", \"loc\": [x0,y0]} // 开门\n\t\t])\n\t}\n\t*/\n})();",canUseItemEffect:"true"},centerFly:{cls:"items",name:"跃进之翼",text:"提升一个等级",useItemEffect:null,canUseItemEffect:null,itemEffect:"hero.lv += 1;\nhero.hp += 400;\nhero.atk += 5;\nhero.def += 5;",itemEffectTip:"，提升一个等级"},upFly:{cls:"tools",name:"上楼器",text:"可以飞往楼上的相同位置",useItemEffect:'(function () {\n\tvar floorId = core.floorIds[core.floorIds.indexOf(core.status.floorId) + 1];\n\tif (core.status.event.id == \'action\') {\n\t\tcore.insertAction([\n\t\t\t{ "type": "changeFloor", "loc": [core.getHeroLoc(\'x\'), core.getHeroLoc(\'y\')], "floorId": floorId },\n\t\t\t{ "type": "tip", "text": core.material.items[itemId].name + \'使用成功\' }\n\t\t]);\n\t} else {\n\t\tcore.changeFloor(floorId, null, core.status.hero.loc, null, function () {\n\t\t\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\t\tcore.replay();\n\t\t});\n\t}\n})();',canUseItemEffect:"(function () {\n\tvar floorId = core.status.floorId,\n\t\tindex = core.floorIds.indexOf(floorId);\n\tif (index < core.floorIds.length - 1) {\n\t\tvar toId = core.floorIds[index + 1],\n\t\t\ttoX = core.getHeroLoc('x'),\n\t\t\ttoY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width,\n\t\t\tmh = core.floors[toId].height;\n\t\tif (toX >= 0 && toX < mw && toY >= 0 && toY < mh && core.getBlock(toX, toY, toId) == null) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();"},downFly:{cls:"tools",name:"下楼器",text:"可以飞往楼下的相同位置",useItemEffect:'(function () {\n\tvar floorId = core.floorIds[core.floorIds.indexOf(core.status.floorId) - 1];\n\tif (core.status.event.id == \'action\') {\n\t\tcore.insertAction([\n\t\t\t{ "type": "changeFloor", "loc": [core.getHeroLoc(\'x\'), core.getHeroLoc(\'y\')], "floorId": floorId },\n\t\t\t{ "type": "tip", "text": core.material.items[itemId].name + \'使用成功\' }\n\t\t]);\n\t} else {\n\t\tcore.changeFloor(floorId, null, core.status.hero.loc, null, function () {\n\t\t\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\t\tcore.replay();\n\t\t});\n\t}\n})();',canUseItemEffect:"(function () {\n\tvar floorId = core.status.floorId,\n\t\tindex = core.floorIds.indexOf(floorId);\n\tif (index > 0) {\n\t\tvar toId = core.floorIds[index - 1],\n\t\t\ttoX = core.getHeroLoc('x'),\n\t\t\ttoY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width,\n\t\t\tmh = core.floors[toId].height;\n\t\tif (toX >= 0 && toX < mw && toY >= 0 && toY < mh && core.getBlock(toX, toY, toId) == null) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();"},earthquake:{cls:"tools",name:"地震卷轴",text:"可以破坏当前层的所有墙",useItemEffect:"(function () {\n\tvar indexes = [];\n\tfor (var index in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[index];\n\t\tif (!block.disable && block.event.canBreak) {\n\t\t\tindexes.push(index);\n\t\t}\n\t}\n\tcore.removeBlockByIndexes(indexes);\n\tcore.drawMap();\n\tcore.playSound('打开界面');\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n})();",canUseItemEffect:"(function () {\n\treturn core.status.thisMap.blocks.filter(function (block) {\n\t\treturn !block.disable && block.event.canBreak;\n\t}).length > 0;\n})();"},poisonWine:{cls:"items",name:"解毒剂",text:"可以解除中毒状态",useItemEffect:"core.triggerDebuff('remove', 'poison');",canUseItemEffect:"core.hasFlag('poison');",itemEffectTip:"，回复中毒状态",itemEffect:"core.triggerDebuff('remove', 'poison');\ncore.autoGetItem();"},weakWine:{cls:"items",name:"火酒",text:"可以解除衰弱状态",useItemEffect:"core.triggerDebuff('remove', 'weak');",canUseItemEffect:"core.hasFlag('weak');",itemEffectTip:"，回复衰弱状态",itemEffect:"core.triggerDebuff('remove', 'weak');"},curseWine:{cls:"tools",name:"解咒药水",text:"可以解除诅咒状态",useItemEffect:"core.triggerDebuff('remove', 'curse');",canUseItemEffect:"core.hasFlag('curse');"},superWine:{cls:"tools",name:"万能药水",text:"可以解除所有不良状态",useItemEffect:"core.triggerDebuff('remove', ['poison', 'weak', 'curse']);",canUseItemEffect:"(function() {\n\treturn core.hasFlag('poison') || core.hasFlag('weak') || core.hasFlag('curse');\n})();"},hammer:{cls:"tools",name:"圣锤",text:"该道具尚未被定义"},lifeWand:{cls:"tools",name:"生命魔杖",text:"可以恢复100点生命值",useItemEvent:[{type:"comment",text:"先恢复一个魔杖（因为使用道具必须消耗一个）"},{type:"function","function":"function(){\ncore.addItem('lifeWand', 1);\n}"},{type:"playSound",name:"打开界面"},{type:"input",text:"请输入生命魔杖使用次数：(0-${item:lifeWand})"},{type:"if",condition:"flag:input<=item:lifeWand","true":[{type:"setValue",name:"item:lifeWand",operator:"-=",value:"flag:input"},{type:"setValue",name:"status:hp",operator:"+=",value:"flag:input*100"},{type:"playSound",name:"回血"},"成功使用${flag:input}次生命魔杖，恢复${flag:input*100}点生命。"],"false":[{type:"playSound",name:"操作失败"},"输入不合法！"]}],canUseItemEffect:"true"},jumpShoes:{cls:"tools",name:"跳跃靴",text:"能跳跃到前方两格处",useItemEffect:'core.playSound("跳跃");\ncore.insertAction({ "type": "jumpHero", "loc": [core.nextX(2), core.nextY(2)] });',canUseItemEffect:"(function () {\n\tvar nx = core.nextX(2),\n\t\tny = core.nextY(2);\n\treturn nx >= 0 && nx < core.bigmap.width && ny >= 0 && ny < core.bigmap.height && core.getBlockId(nx, ny) == null;\n})();"},skill1:{cls:"constants",name:"妖精之歌颂",text:"三相之力一号",hideInReplay:true,useItemEffect:null,canUseItemEffect:null,hideInToolbox:true},wand:{cls:"items",name:"新物品"},I305:{cls:"constants",name:"说明书",text:"关于本复刻版的一些说明",useItemEvent:[{type:"choices",choices:[{text:"复刻说明",action:[{type:"while",condition:"1",data:[{type:"choices",choices:[{text:"复刻版(原版)说明",action:["\t[欢迎来到新新魔塔续的H5复刻版]本复刻版忠实复刻了「新新魔塔续」的所有内容（包括所有Bug），除了：\n1.战斗UI：你需要在战前输入战斗中需要发动的技能，详见说明书的「技能输入帮助」部分。\n2.随机因素，列举如下：疲劳小于100时必定不会miss；中毒、衰弱为战斗进入第5回合时必定触发；其它带有随机因素的怪物见各自说明。\n3.白银系怪物的小游戏：集齐三相之力后可零伤解决。\n\n最后更新：2023/2/26",{type:"drawImage",image:"baiyin.png",x:3,y:192},{type:"text",text:"\t[白银系怪物伤害表]白银系怪物的伤害如下，建议集齐三相之力后再与它们战斗：",pos:[96,32]},{type:"clearMap"},"\t[计分方式]原作目前的“主流”玩法为高攻防和玩法以及速通玩法，复刻版提供这两种玩法的计分方式，你需要在游戏结束时进行选择。\n高攻防和：最终得分=勇者的攻击+防御。\n速通：最终得分=5000-杀敌数（杀敌数可在数据统计[B]中查看）。"]},{text:"原作Bug列举",action:["\t[原作Bug列举] · 流石C不会给怪物带来防增气。\n · 未装备过剑技时，XC可以透支气息。\n（以上两条详解见教程3）\n · 流石结算时，先吸气再扣除需要消耗的1格气息。\n · 满槽获得绿宝石时爆槽（如5+40/40吃绿宝石会变为5+40/39）。\n · 防御≤1.5*等级时凡骨的转换攻防无效（应为防御<等级时无效）。\n · 反射盾不能反弹增加疲劳的效果（将mtmptir错写为mtmptired导致的Bug）。\n · 反射盾不能反弹皇室枪兵的降低防御效果。\n · 使用精灵罩时按(血+防)%等级计算增加的防御，而承受三次攻击后按(防/50+血%等级)计算扣减的防御。","\t[原作Bug列举] · 不死骷髅兵的吸血效果仅为1/3（应与其它怪物同为1/2）。\n · 斗神·高巴技能的描述判定条件为：被它的会心一击击中时。实际判定条件为：伤害大于怪物攻击减勇者防御。这会导致：临界防杀斗神·高巴时，其普通攻击也会触发技能；斗神·高巴会心一击时（且未临界防杀），勇者使用镜膜盾能躲过他的技能。\n · 魔神·些多的“死寂光环”能力实际上没有起作用，这会影响到：攻防增气、流石吸气、拥有绿水晶时公主被攻击。\n · 血剑士会心一击的伤害应该是基本伤害的3倍，但实际上是2倍。\n · 魔界之王·古顿在暴击时弹射伤害计算为NaN导致弹射伤害为0。\n · 魔界之王·古顿计算弹射伤害时使用的基础伤害未考虑盾技减伤的效果。","\t[魔眼相关Bug] · 魔眼操纵勇者放剑技时，若勇者攻击不大于防御，则操纵的技能会保存下来，由勇者攻击魔眼时施放。\n · 魔眼操纵勇者放剑技的效果与描述不符：\n    凡骨：伤害为1.8倍\n    流石：没有吸取一半气息的效果\n    深红：将伤害改为100，没有回血效果\n    天灵：伤害为1.5倍\n · 勇者使用盾技抵挡自己攻击的效果与描述不符：\n    结晶盾：无冻结一回合的效果\n    反射盾：反弹伤害仅为伤害值/2.6\n    精灵罩：承受三次攻击失效时，降低的防御值按(经验+防御)%等级来计算\n · 勇者攻击自己没有防增气（只有攻增气）\n"]},{text:"修复版说明",action:["\t[修复版说明]修复版修复了原版游戏中存在的所有Bug（详见说明书的「原作Bug列举」部分）。\n\n修复版计分：能力分+道具分+成就分。\n能力分=(勇者体力/2+公主体力)开方+等级+攻防和+公主魔防+剑/盾技数×10+绿/黄宝石及能量水×2\n道具分=剩余的\\i[I324]×1+\\i[I323]×3+\\i[redKey]×4+\\i[I398]×5+\\i[I400]×10+\\i[I403]×20+\\i[I407]×30\n成就分=成就点数","\t[修复版说明]修复版进行了以下平衡调整，使游戏内容及难度更合理：\n · 深红、贤者结界的回血效果改为向下取整（防止卡攻防刷更多血）。\n · 反射盾的气息消耗改为2。\n · 精灵罩的气息消耗改为1，且可多次叠加（每次被攻击前可使用一次）。\n · 中毒、衰弱状态可共存。\n · 金币商店价格统一为20，每购买一次+1，价格到达150后每购买一次+2。"]},{text:"技能输入帮助",action:["\t[技能输入帮助]快捷键1-9的用法见教程1\n基础输入见技能面板（快捷键6）\n高级输入：\n-C：最后一回合(≤10)用C\n-V：有一格气息且疲劳≥深呼吸回复量时使用V\n@+数字：进行到对应回合后继续结算后续技能（如@4C@8CC表示在第4、8、9回合分别使用会心一击）\n内容*数字：内容重复数字次（如(A*3C)*2C=(AAAC)*2C=AAACAAACC，表示在第4、8、9回合分别使用会心一击）","\t[示例]@4C=AAAC=A*3C：第4回合用会心一击。\n-V*21：在适当的时机用21次深呼吸（如防杀水银人时，回合数为81，深呼吸回复量为7，则需要(80*3-99)/7向上取整=21次深呼吸）。\nCX1C：有蓝水晶或绿水晶时：第一回合用会心一击和镜膜盾(X1)，第二回合用会心一击；否则若当前装备着镜膜盾，则自动替换为CXC，若未装备镜膜盾，则为非法输入。\nX2AZX3（装备流石）：有蓝水晶时：第一回合用结晶盾(X2)，第三回合用流石(Z，写作Z2也可)+反射盾(X3)；否则为非法输入。"]},{text:"退出",action:[{type:"exit"}]}]}]}]},{text:"高级设置[U]",action:[{type:"insert",name:"高级设置"}]},{text:"查看技能库",action:[{type:"insert",name:"技能库管理"}]},{text:"退出",action:[]}]}],canUseItemEffect:true},I306:{cls:"items",name:"新物品"},I307:{cls:"constants",name:"圣神之加护",text:"三相之力二号",hideInToolbox:true,hideInReplay:true},I308:{cls:"constants",name:"会心一击",text:"气息消耗40\n首回合造成的伤害×2。\n快捷键1"},I309:{cls:"constants",name:"魔力之源",text:"三相之力三号",hideInToolbox:true,hideInReplay:true},I310:{cls:"items",name:"新物品"},I311:{cls:"items",name:"新物品"},I312:{cls:"constants",name:"风之翼",text:"魔神身上遗落的，似乎可以用来飞行。\n",hideInToolbox:true},I313:{cls:"items",name:"新物品"},I314:{cls:"items",name:"新物品"},I316:{cls:"equips",name:"皇者(Z5)",text:"伤害*5，不致死，随后攻击退化。\n最低使用等级=100 气息消费=2 疲劳+30",equip:{type:0,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I325') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]},{type:"setValue",name:"flag:swordUsed",value:"true"},{type:"if",condition:"(flag:swordUsed!==true)","true":[{type:"setValue",name:"flag:swordUsed",value:"true"},{type:"function","function":"function(){\ncore.clearMyCache('all');\n}"},{type:"function","function":"function(){\ncore.drawFg(core.status.floorId);\n}"}]}]},canUseItemEffect:"hero.lv >= 100"},I317:{cls:"equips",name:"天灵(Z4)",text:"伤害*1.8，怪物疲劳+15。\n最低使用等级=76 气息消费=2 疲劳+8",equip:{type:0,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I325') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]},{type:"setValue",name:"flag:swordUsed",value:"true"},{type:"if",condition:"(flag:swordUsed!==true)","true":[{type:"setValue",name:"flag:swordUsed",value:"true"},{type:"function","function":"function(){\ncore.clearMyCache('all');\n}"},{type:"function","function":"function(){\ncore.drawFg(core.status.floorId);\n}"}]}]},canUseItemEffect:"hero.lv >= 76"},I318:{cls:"equips",name:"深红(Z3)",text:"伤害*0.8，不致死，将实际伤害*0.3回复至自身。\n最低使用等级=26 气息消费=1 疲劳+4",equip:{type:0,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I325') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]},{type:"setValue",name:"flag:swordUsed",value:"true"},{type:"if",condition:"(flag:swordUsed!==true)","true":[{type:"setValue",name:"flag:swordUsed",value:"true"},{type:"function","function":"function(){\ncore.clearMyCache('all');\n}"},{type:"function","function":"function(){\ncore.drawFg(core.status.floorId);\n}"}]}]},canUseItemEffect:"hero.lv >= 26"},I319:{cls:"equips",name:"流石(Z2)",text:"伤害*1.3，吸取怪物的全部气息至自身。\n最低使用等级=20 气息消费=1 疲劳+4",equip:{type:0,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I325') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]},{type:"setValue",name:"flag:swordUsed",value:"true"},{type:"if",condition:"((flag:skill_1==='-C')&&(!flag:bugFix))","true":[{type:"setValue",name:"flag:skill_1",value:"'C'"}]},{type:"if",condition:"((flag:skill_2==='XC')&&(!flag:bugFix))","true":[{type:"setValue",name:"flag:skill_2",value:"'CX'"}]}],unequipEvent:[{type:"if",condition:"((flag:skill_1==='C')&&(!flag:bugFix))","true":[{type:"setValue",name:"flag:skill_1",value:"'-C'"}]},{type:"if",condition:"((flag:skill_2==='CX')&&(!flag:bugFix))","true":[{type:"setValue",name:"flag:skill_2",value:"'XC'"}]}]},canUseItemEffect:"hero.lv >= 20"},I320:{cls:"equips",name:"贤者结界(X5)",text:"将所受伤害的1.5倍回复至公主身上\n最低使用等级=100 气息消费=2 疲劳+2",equip:{type:1,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I327') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]}]},canUseItemEffect:"hero.lv >= 100"},I321:{cls:"equips",name:"结晶盾(X2)",text:"所受的伤害除以1.5，敌人本回合以及下回合不能行动\n最低使用等级=18 气息消费=2 疲劳+12",equip:{type:1,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I327') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]}]},canUseItemEffect:"hero.lv >= 18"},I322:{cls:"equips",name:"精灵罩(X4)",text:"防御暂时增加防御/50+生命值%等级，效果抵挡三次攻击\n最低使用等级=57 气息消费=${flags.bugFix? 1 : 2} 疲劳+9",equip:{type:1,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I327') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]}]},canUseItemEffect:"hero.lv >=57"},I323:{cls:"items",name:"高级草药精华",text:null,itemEffectTip:"，${core.hasItem('moneyPocket') ? '放在冒险袋中' : '体力+180，回复衰弱'}",itemEffect:"if (core.hasItem('moneyPocket')) core.addFlag('blue_herb', 1);\nelse {\n\thero.hp += 180;\n\tcore.triggerDebuff('remove', 'weak');\n}"},I324:{cls:"items",name:"草药精华",text:null,itemEffect:"if (core.hasItem('moneyPocket')) core.addFlag('red_herb', 1);\nelse {\n\thero.hp += 80;\n\tcore.triggerDebuff('remove', 'poison');\n}",itemEffectTip:"，${core.hasItem('moneyPocket') ? '放在冒险袋中' : '体力+80，回复中毒'}"},I325:{cls:"constants",name:"火神之水晶球",text:"切换剑技不需要消耗体力，战斗中也可切换剑技。\n公主受到伤害时反弹一半的伤害（公主受到的伤害不变）。"},I326:{cls:"constants",name:"树精之水晶球",text:"切换剑技和盾技均不需要消耗生命。\n公主受伤会回复主角气息（回复量为所受伤害的1/3）。"},I327:{cls:"constants",name:"海王之水晶球",text:"切换盾技不需要消耗体力，战斗中也可切换盾技。\n公主被攻击时，怪物疲劳+5。"},I328:{cls:"constants",name:"幻之史莱姆虹币",text:"大大增加游戏分数"},I338:{cls:"items",name:"新物品"},I339:{cls:"equips",name:"镜膜盾(X1)",text:"所受的伤害除以2.5\n最低使用等级=1 气息消费=1 疲劳+3",hideInReplay:false,canUseItemEffect:"hero.lv >= 1",equip:{type:1,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I327') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]}]}},I315:{cls:"equips",name:"凡骨(Z1)",text:"伤害*1.5，暂时将(等级)防御转换为(等级*1.5)攻击，但给予伤害不超过(等级)就没有效果。最低使用等级=1 气息消费=1 疲劳+10",equip:{type:0,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I325') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]},{type:"setValue",name:"flag:swordUsed",value:"true"},{type:"if",condition:"(flag:swordUsed!==true)","true":[{type:"setValue",name:"flag:swordUsed",value:"true"},{type:"function","function":"function(){\ncore.clearMyCache('all');\n}"},{type:"function","function":"function(){\ncore.drawFg(core.status.floorId);\n}"}]}]},hideInReplay:false,canUseItemEffect:"hero.lv >= 1"},I375:{cls:"equips",name:"反射盾(X3)",text:"所受的伤害除以1.3，将（初始伤害除以2.6+勇者攻击除以10）和负面效果反弹给敌人。 最低使用等级=28 气息消费=${flags.bugFix? 2 : 1} 疲劳+3",canUseItemEffect:"hero.lv >= 28",equip:{type:1,value:{},percentage:{},equipEvent:[{type:"if",condition:"((!core.hasItem('I327') )&&(!core.hasItem('I326')))","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"50"}]}]}},I395:{cls:"tools",name:"随意门（废弃）",text:"可以将部分墙面变成黄门或传送门，或者移除地上的冰块。若随意门将暗墙变成了传送门或物品，则在开门后返还一把黄钥匙。"},I398:{cls:"tools",name:"史莱姆银币",text:"增加游戏分数"},I399:{cls:"items",name:"新物品"},I400:{cls:"tools",name:"史莱姆金币",text:"增加游戏分数"},I401:{cls:"items",name:"新物品"},I402:{cls:"items",name:"新物品"},I403:{cls:"tools",name:"史莱姆纯银块",text:"大大增加游戏分数"},I404:{cls:"items",name:"新物品"},I405:{cls:"items",name:"新物品"},I406:{cls:"items",name:"新物品"},I407:{cls:"tools",name:"史莱姆纯金块",text:"大大增加游戏分数"},I445:{cls:"tools",name:"随意门（冰）",text:"消除地面上的冰块"},A1:{cls:"constants",name:"新物品",canUseItemEffect:"true",hideInToolbox:true,useItemEffect:"(function () {\n\tcore.useSkill(itemId.substr(1, 1))\n})();",text:"技能组合1",hideInReplay:true},A2:{cls:"constants",name:"新物品",canUseItemEffect:"true",hideInToolbox:true,text:"技能组合2",useItemEffect:"(function () {\n\tcore.useSkill(itemId.substr(1, 1))\n})();",hideInReplay:true},A3:{cls:"constants",name:"新物品",canUseItemEffect:"true",hideInToolbox:true,text:"技能3",useItemEffect:"(function () {\n\tcore.useSkill(itemId.substr(1, 1))\n})();",hideInReplay:true},A4:{cls:"constants",name:"新物品",canUseItemEffect:"true",hideInToolbox:true,text:"技能4",useItemEffect:"(function () {\n\tcore.useSkill(itemId.substr(1, 1))\n})();",hideInReplay:true},A5:{cls:"constants",name:"新物品",canUseItemEffect:"true",hideInToolbox:true,useItemEffect:"(function () {\n\tcore.useSkill(itemId.substr(1, 1))\n})();",hideInReplay:true},A6:{cls:"constants",name:"技能面板（快捷键6）",canUseItemEffect:"true",hideInToolbox:false,useItemEffect:null,hideInReplay:true,text:"呼出技能面板进行技能输入，能满足大部分需求，手机端强烈推荐",useItemEvent:[{type:"setValue",name:"flag:skillName",value:"''"},{type:"setAttribute",alpha:0.75},{type:"if",condition:"true","true":[{type:"drawImage",image:"ground2.png",x:0,y:0,w:288,h:160,x1:64,y1:32,w1:288,h1:160},{type:"strokeRect",x:64,y:32,width:288,height:160,radius:5,style:[205,0,154],lineWidth:3},{type:"drawTextContent",text:"输入技能：（点击按钮或用键盘输入）\nA：平砍；Z：使用剑技；C：使用会心一击。\nD：不使用盾技；X：使用盾技。V：深呼吸。\n示例：（A和D在无歧义时可省略）\n第4回合使用会心一击：AAAC；\n平砍+盾技+会心一击：AXC（或XC）；\n剑,不用盾,平A,盾,深呼吸,平A,盾,暴击：\nZDAXVAXC 或 ZAXVXC 或 ZDXVXC。",left:72,top:40,fontSize:14,bold:true}]},{type:"if",condition:"core.getEquip(0)","true":[{type:"drawImage",image:"ground2.png",x:0,y:0,w:64,h:64,x1:32,y1:320,w1:64,h1:64},{type:"strokeRect",x:32,y:320,width:64,height:64,radius:5,style:[205,0,154],lineWidth:3},{type:"fillBoldText",x:48,y:371,style:[255,255,255,1],strokeStyle:[0,0,0,1],font:"bold 52px Arial",text:"Z"}]},{type:"if",condition:"core.getEquip(1)","true":[{type:"drawImage",image:"ground2.png",x:0,y:0,w:64,h:64,x1:128,y1:320,w1:64,h1:64},{type:"strokeRect",x:128,y:320,width:64,height:64,radius:5,style:[205,0,154],lineWidth:3},{type:"fillBoldText",x:143,y:371,style:[255,255,255,1],strokeStyle:[0,0,0,1],font:"bold 52px Arial",text:"X"}]},{type:"if",condition:"true","true":[{type:"drawImage",image:"ground2.png",x:0,y:0,w:64,h:64,x1:224,y1:320,w1:64,h1:64},{type:"strokeRect",x:224,y:320,width:64,height:64,radius:5,style:[205,0,154],lineWidth:3},{type:"fillBoldText",x:236,y:371,style:[255,255,255,1],strokeStyle:[0,0,0,1],font:"bold 52px Arial",text:"C"}]},{type:"if",condition:"true","true":[{type:"drawImage",image:"ground2.png",x:0,y:0,w:64,h:64,x1:320,y1:320,w1:64,h1:64},{type:"strokeRect",x:320,y:320,width:64,height:64,radius:5,style:[205,0,154],lineWidth:3},{type:"fillBoldText",x:335,y:371,style:[255,255,255,1],strokeStyle:[0,0,0,1],font:"bold 52px Arial",text:"V"}]},{type:"if",condition:"true","true":[{type:"drawImage",image:"ground2.png",x:0,y:0,w:64,h:64,x1:64,y1:224,w1:64,h1:64},{type:"strokeRect",x:64,y:224,width:64,height:64,radius:5,style:[205,0,154],lineWidth:3},{type:"fillBoldText",x:77,y:274,style:[255,255,255,1],strokeStyle:[0,0,0,1],font:"bold 52px Arial",text:"A"}]},{type:"if",condition:"core.getEquip(1)","true":[{type:"drawImage",image:"ground2.png",x:0,y:0,w:64,h:64,x1:160,y1:224,w1:64,h1:64},{type:"strokeRect",x:160,y:224,width:64,height:64,radius:5,style:[205,0,154],lineWidth:3},{type:"fillBoldText",x:174,y:274,style:[255,255,255,1],strokeStyle:[0,0,0,1],font:"bold 52px Arial",text:"D"}]},{type:"if",condition:"true","true":[{type:"drawImage",image:"ground2.png",x:0,y:0,w:96,h:64,x1:256,y1:224,w1:96,h1:64},{type:"strokeRect",x:256,y:224,width:96,height:64,radius:5,style:[205,0,154],lineWidth:3},{type:"fillBoldText",x:267,y:269,style:[255,255,255,1],strokeStyle:[0,0,0,1],font:"bold 36px Arial",text:"退出"}]},{type:"dowhile",condition:"(!temp:A)",data:[{type:"wait",forceChild:true,data:[{"case":"mouse",px:[32,96],py:[320,384],action:[{type:"if",condition:"core.getEquip(0)","true":[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'Z'"},{type:"if",condition:"(core.hasItem('I325')||(core.hasItem('I326')&&(!temp:B)))","true":[{type:"setValue",name:"temp:B",value:"true"},{type:"choices",text:"选择发动哪个剑技",choices:[{text:"凡骨",need:"core.canEquip('I315',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"1"}]},{text:"流石",need:"core.canEquip('I319',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"2"}]},{text:"深红",need:"core.canEquip('I318',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"3"}]},{text:"天灵",need:"core.canEquip('I317',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"4"}]},{text:"皇者",need:"core.canEquip('I316',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"5"}]},{text:"不切换",action:[]}]}]}]}]},{"case":"mouse",px:[128,192],py:[320,384],action:[{type:"if",condition:"core.getEquip(1)","true":[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'X'"},{type:"if",condition:"(core.hasItem('I327')||(core.hasItem('I326')&&(!temp:C)))","true":[{type:"setValue",name:"temp:C",value:"true"},{type:"choices",text:"选择发动哪个盾技",choices:[{text:"镜膜盾",need:"core.canEquip('I339',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"1"}]},{text:"结晶盾",need:"core.canEquip('I321',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"2"}]},{text:"反射盾",need:"core.canEquip('I375',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"3"}]},{text:"精灵罩",need:"core.canEquip('I322',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"4"}]},{text:"贤者结界",need:"core.canEquip('I320',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"5"}]},{text:"不切换",action:[]}]}]}]}]},{"case":"mouse",px:[224,288],py:[320,384],action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'C'"}]},{"case":"mouse",px:[320,384],py:[320,384],action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'V'"}]},{"case":"mouse",px:[64,128],py:[224,288],action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'A'"}]},{"case":"mouse",px:[160,224],py:[224,288],action:[{type:"if",condition:"core.getEquip(1)","true":[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'D'"}]}]},{"case":"mouse",px:[260,356],py:[224,288],action:[{type:"setValue",name:"temp:A",value:"true"}]},{"case":"keyboard",keycode:"90",action:[{type:"if",condition:"core.getEquip(0)","true":[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'Z'"},{type:"if",condition:"(core.hasItem('I325')||(core.hasItem('I326')&&(!temp:B)))","true":[{type:"setValue",name:"temp:B",value:"true"},{type:"choices",text:"选择发动哪个剑技",choices:[{text:"凡骨",need:"core.canEquip('I315',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"1"}]},{text:"流石",need:"core.canEquip('I319',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"2"}]},{text:"深红",need:"core.canEquip('I318',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"3"}]},{text:"天灵",need:"core.canEquip('I317',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"4"}]},{text:"皇者",need:"core.canEquip('I316',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"5"}]},{text:"不切换",action:[]}]}]}]}]},{"case":"keyboard",keycode:"88",action:[{type:"if",condition:"core.getEquip(1)","true":[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'X'"},{type:"if",condition:"(core.hasItem('I327')||(core.hasItem('I326')&&(!temp:C)))","true":[{type:"setValue",name:"temp:C",value:"true"},{type:"choices",text:"选择发动哪个盾技",choices:[{text:"镜膜盾",need:"core.canEquip('I339',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"1"}]},{text:"结晶盾",need:"core.canEquip('I321',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"2"}]},{text:"反射盾",need:"core.canEquip('I375',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"3"}]},{text:"精灵罩",need:"core.canEquip('I322',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"4"}]},{text:"贤者结界",need:"core.canEquip('I320',false)",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"5"}]},{text:"不切换",action:[]}]}]}]}]},{"case":"keyboard",keycode:"67",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'C'"}]},{"case":"keyboard",keycode:"86",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'V'"}]},{"case":"keyboard",keycode:"65",action:[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'A'"}]},{"case":"keyboard",keycode:"68",action:[{type:"if",condition:"core.getEquip(1)","true":[{type:"setValue",name:"flag:skillName",operator:"+=",value:"'D'"}]}]},{"case":"keyboard",keycode:"13,32,27,8,54,102",action:[{type:"setValue",name:"temp:A",value:"true"}]},{"case":"timeout",action:[{type:"setValue",name:"temp:A",value:"true"}]}]},{type:"function","function":"function(){\ncore.setFlag('skillName',core.myFormatSkill(core.getFlag('skillName', '')))\n}"}]},{type:"clearMap"}]},A7:{cls:"constants",name:"使用推荐的技能（快捷键7）",canUseItemEffect:'(function () {\n\tvar b = core.getBlock(core.nextX(), core.nextY());\n\tif (b && b.event.cls == "enemys") return true;\n\tvar list = [];\n\t[\n\t\t[1, 0],\n\t\t[0, 1],\n\t\t[-1, 0],\n\t\t[0, -1]\n\t].forEach(function (e) {\n\t\tb = core.getBlock(hero.loc.x + e[0], hero.loc.y + e[1]);\n\t\tif (b && b.event.cls == "enemys") list.push(b);\n\t})\n\tif (list.length == 1) return true;\n\treturn false;\n})();',hideInToolbox:false,useItemEffect:'(function () {\n\tif (!core.isReplaying()) {\n\t\tvar b = core.getBlock(core.nextX(), core.nextY());\n\t\tif (!b || b.event.cls != "enemys") {\n\t\t\t[\n\t\t\t\t[1, 0],\n\t\t\t\t[0, 1],\n\t\t\t\t[-1, 0],\n\t\t\t\t[0, -1]\n\t\t\t].forEach(function (e) {\n\t\t\t\tvar b0 = core.getBlock(hero.loc.x + e[0], hero.loc.y + e[1]);\n\t\t\t\tif (b0 && b0.event.cls == "enemys") b = b0;\n\t\t\t})\n\t\t}\n\t\tvar skill = (core.getRecomSkill(b.event.id, 0, b.x, b.y, core.status.floorId) || []).skill || "";\n\t\tif (core.getFlag("skillName", "") == skill) skill = \'\';\n\t\tcore.setFlag("skillName", skill);\n\t\tcore.status.route.push("key:57");\n\t\tcore.status.route.push("input2:" + core.encodeBase64(skill));\n\t}\n})();',text:"自动使用面前怪物的推荐技能，需在怪物面前使用",hideInReplay:true},A8:{cls:"constants",name:"技能选择（快捷键8）",canUseItemEffect:"true",useItemEffect:null,useItemEvent:[{type:"choices",text:"选择哪个技能？",choices:[{text:"快捷键1：${core.getFlag('skill_1','无')}",action:[{type:"choices",choices:[{text:"使用${core.getFlag('skill_1','无')}",action:["系统提示：\n你可以直接使用快捷键1（电脑端使用键盘，字母区、数字区的数字均可；手机端竖屏点击右下角的难度，下方状态栏变为数字，点击相应的数字即可）"]},{text:"修改并使用",action:[{type:"input2",text:"将快捷键1绑定的技能修改为"},{type:"setValue",name:"flag:input",value:"core.myFormatSkill(core.getFlag('input',''))"},{type:"if",condition:"(flag:input!=='')","true":[{type:"setValue",name:"flag:skill_1",value:"flag:input"}],"false":["输入有误！请尝试使用技能面板（快捷键6）"]}]}]},{type:"useItem",id:"A1"}]},{text:"快捷键2：${core.getFlag('skill_2','无')}",action:[{type:"choices",choices:[{text:"使用${core.getFlag('skill_2','无')}",action:["系统提示：\n你可以直接使用快捷键2（电脑端使用键盘，字母区、数字区的数字均可；手机端竖屏点击右下角的难度，下方状态栏变为数字，点击相应的数字即可）"]},{text:"修改并使用",action:[{type:"input2",text:"将快捷键2绑定的技能修改为"},{type:"setValue",name:"flag:input",value:"core.myFormatSkill(core.getFlag('input',''))"},{type:"if",condition:"(flag:input!=='')","true":[{type:"setValue",name:"flag:skill_2",value:"flag:input"}],"false":["输入有误！请尝试使用技能面板（快捷键6）"]}]}]},{type:"useItem",id:"A2"}]},{text:"快捷键3：${core.getFlag('skill_3','无')}",action:[{type:"choices",choices:[{text:"使用${core.getFlag('skill_3','无')}",action:["系统提示：\n你可以直接使用快捷键3（电脑端使用键盘，字母区、数字区的数字均可；手机端竖屏点击右下角的难度，下方状态栏变为数字，点击相应的数字即可）"]},{text:"修改并使用",action:[{type:"input2",text:"将快捷键3绑定的技能修改为"},{type:"setValue",name:"flag:input",value:"core.myFormatSkill(core.getFlag('input',''))"},{type:"if",condition:"(flag:input!=='')","true":[{type:"setValue",name:"flag:skill_3",value:"flag:input"}],"false":["输入有误！请尝试使用技能面板（快捷键6）"]}]}]},{type:"useItem",id:"A3"}]},{text:"快捷键4：${core.getFlag('skill_4','无')}",action:[{type:"choices",choices:[{text:"使用${core.getFlag('skill_4','无')}",action:["系统提示：\n你可以直接使用快捷键4（电脑端使用键盘，字母区、数字区的数字均可；手机端竖屏点击右下角的难度，下方状态栏变为数字，点击相应的数字即可）"]},{text:"修改并使用",action:[{type:"input2",text:"将快捷键4绑定的技能修改为"},{type:"setValue",name:"flag:input",value:"core.myFormatSkill(core.getFlag('input',''))"},{type:"if",condition:"(flag:input!=='')","true":[{type:"setValue",name:"flag:skill_4",value:"flag:input"}],"false":["输入有误！请尝试使用技能面板（快捷键6）"]}]}]},{type:"useItem",id:"A4"}]},{text:"快捷键5：${core.getFlag('skill_5','无')}",action:[{type:"choices",choices:[{text:"使用${core.getFlag('skill_5','无')}",action:["系统提示：\n你可以直接使用快捷键5（电脑端使用键盘，字母区、数字区的数字均可；手机端竖屏点击右下角的难度，下方状态栏变为数字，点击相应的数字即可）"]},{text:"修改并使用",action:[{type:"input2",text:"将快捷键5绑定的技能修改为"},{type:"setValue",name:"flag:input",value:"core.myFormatSkill(core.getFlag('input',''))"},{type:"if",condition:"(flag:input!=='')","true":[{type:"setValue",name:"flag:skill_5",value:"flag:input"}],"false":["输入有误！请尝试使用技能面板（快捷键6）"]}]}]},{type:"useItem",id:"A5"}]},{text:"自定义输入[9]",action:[{type:"insert",name:"设置技能"}]},{text:"查看技能库",action:[{type:"insert",name:"技能库管理"}]},{text:"退出",action:[]}]}],hideInReplay:true,text:"使用或修改预设的技能，或自定义输入技能"},A9:{cls:"constants",name:"无用项",canUseItemEffect:"true",useItemEffect:null,hideInToolbox:true,hideInReplay:true},I451:{cls:"constants",name:"能量转换器",canUseItemEffect:"true",text:"将勇士的体力2:1转换给公主",useItemEvent:[{type:"input",text:"转换多少勇者体力值？（必须为100的倍数）"},{type:"setValue",name:"flag:input",operator:"//=",value:"100"},{type:"setValue",name:"flag:input",operator:"*=",value:"100"},{type:"if",condition:"(flag:input<status:hp)","true":[{type:"setValue",name:"status:hp",operator:"-=",value:"flag:input"},{type:"setValue",name:"status:hpmax",operator:"+=",value:"(flag:input/2)"},"勇者体力-${flag:input}，公主体力+${flag:input/2}"],"false":["勇者体力不足！"]}]},iceCube:{cls:"constants",name:"魔法冰块",text:"用于在妖精之泉（魔塔22F的密室）制取永恒冰结晶"},I453:{cls:"constants",name:"查看成就",canUseItemEffect:"true",text:"你的当前成就点数为 ${flags.achieveScore}",useItemEffect:"var score = flags.achieveScore,\n\ta = flags.achieves,\n\ttitle = '\\t[当前成就点数：' + score + ']',\n\ts = [title, title, title],\n\tj = 0;\nfor (var i = 1; i <= a.length; i++) {\n\tvar x = a[i - 1];\n\ts[j] += (x[4] ? '\\r[white]' : '\\r[grey]') + '\\\\i[N' + (453 + i) + ']' + x[0] + '(' + x[3] + ')：' + x[1];\n\tif (i % 12 == 0) j++;\n\telse s[j] += '\\n';\n}\nif (!a[16][4]) s.push('完成智能施法成就所需的4种特定情况：\\n1. 战斗中对魔法师系怪物使用凡骨；\\n2. 战斗中当使用皇者的给予伤害大于或等于怪物当前血量时使用皇者；\\n3. 战斗中当怪物给予伤害大于0时对石头怪、铁怪或鬼邪石使用反射盾；\\n4. 战斗中对魔法师系怪物使用贤者结界。');\ncore.insertAction(s);"}};var functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a={events:{resetGame:function(d,c,a,f,g){core.clearStatus();core.status=core.clone(core.initStatus,function(h){return h!="hero"&&h!="maps"});core.control._bindRoutePush();core.status.played=true;core.status.hero=core.clone(d);window.hero=core.status.hero;window.flags=core.status.hero.flags;core.events.setHeroIcon(core.status.hero.image,true);core.control._initStatistics(core.animateFrame.totalTime);core.status.hero.statistics.totalTime=core.animateFrame.totalTime=Math.max(core.status.hero.statistics.totalTime,core.animateFrame.totalTime);core.status.hero.statistics.start=null;core.status.hard=c||"";core.status.floorId=a;core.status.maps=f;core.maps._resetFloorImages();core.material.enemys=core.enemys.getEnemys();core.material.items=core.items.getItems();core.values=core.clone(core.data.values);for(var e in g||{}){core.values[e]=g[e]}core.flags=core.clone(core.data.flags);var b=core.getFlag("globalFlags",{});for(var e in b){core.flags[e]=b[e]}core._init_sys_flags();core.resize();if(core.hasFlag("hideStatusBar")){core.hideStatusBar(core.hasFlag("showToolbox"))}else{core.showStatusBar()}core.dom.musicBtn.style.display="none";core.dom.enlargeBtn.style.display="none"},win:function(c,b,a){if(a){core.status.extraEvent=core.clone(core.status.event)}core.ui.closePanel();var d=core.isReplaying();if(d){core.stopReplay()}core.waitHeroToStop(function(){if(!a){core.clearMap("all");core.deleteAllCanvas();core.dom.gif2.innerHTML=""}c=core.replaceText(c);core.drawText(["\t["+(c||"恭喜通关")+"]你的分数是${status:hp}。"],function(){core.events.gameOver(c||"",d,b)})})},lose:function(a){core.ui.closePanel();var b=core.isReplaying();core.stopReplay();core.waitHeroToStop(function(){core.drawText(["\t["+(a||"结局1")+"]你死了。\n如题。"],function(){core.events.gameOver(null,b)})})},changingFloor:function(d,f){var c=core.status.floorId||null;var e=core.hasFlag("__fromLoad__");var g=core.hasFlag("__isFlying__");if(!e&&!(g&&c==d)){if(!core.hasFlag("__leaveLoc__")){core.setFlag("__leaveLoc__",{})}if(c!=null){core.getFlag("__leaveLoc__")[c]=core.clone(core.status.hero.loc)}}if(e){core.playSound("读档")}else{if(g){core.playSound("飞行器")}else{if(c){core.playSound("上下楼")}}}if(core.autoRemoveMaps){core.autoRemoveMaps(d)}core.maps.resizeMap(d);f.direction=core.turnDirection(f.direction);core.status.hero.loc=f;if(!e){core.extractBlocks(d);core.status.maps[d].blocks.forEach(function(i){if(i.disable&&core.enemys.hasSpecial(i.event.id,23)){i.disable=false;core.setMapBlockDisabled(d,i.x,i.y,false);core.maps._updateMapArray(d,i.x,i.y)}});core.control.gatherFollowers()}core.drawMap(d);if(core.status.maps[d].bgm){var a=core.status.maps[d].bgm;if(a instanceof Array){a=a[Math.floor(Math.random()*a.length)]}if(!core.hasFlag("__bgm__")){core.playBgm(a)}}var b=core.getFlag("__color__",null);if(!b&&core.status.maps[d].color){b=core.status.maps[d].color}core.clearMap("curtain");core.status.curtainColor=b;if(b){core.fillRect("curtain",0,0,core.__PIXELS__,core.__PIXELS__,core.arrayToRGBA(b))}var h=core.getFlag("__weather__",null);if(!h&&core.status.maps[d].weather){h=core.status.maps[d].weather}if(h){core.setWeather(h[0],h[1])}else{core.setWeather()}},afterChangeFloor:function(a){core.autoGetItem();if(core.hasFlag("__fromLoad__")){core.events.recoverEvents(core.getFlag("__events__"));core.removeFlag("__events__")}else{core.insertAction(core.floors[a].eachArrive);if(!core.hasVisitedFloor(a)){core.insertAction(core.floors[a].firstArrive);core.visitFloor(a)}}},flyTo:function(f,a){var b=core.status.floorId;if(!core.status.maps[b].canFlyFrom||!core.status.maps[f].canFlyTo||!core.hasVisitedFloor(f)){core.playSound("操作失败");core.drawTip("无法飞往"+core.status.maps[f].title+"！","fly");return false}var h=false;core.status.thisMap.blocks.forEach(function(i){if(i.event.cls=="enemys"&&core.hasSpecial(i.event.id,50)){h=true}});if(h){core.playSound("操作失败");core.drawTip("当前层有邪眼怪物，无法使用黄金之羽根！","fly");return false}if(flags.poison){if(b.indexOf("B")>=0&&f.indexOf("B")>=0){}else{if(b.indexOf("S")>=0&&f.indexOf("S")>=0){}else{if(b.indexOf("MT")>=0&&f.indexOf("MT")>=0){}else{core.playSound("操作失败");core.drawTip("中毒时无法跨区域使用黄金之羽根！","fly");return false}}}}var e=null,d=null;if(core.flags.flyRecordPosition){d=core.getFlag("__leaveLoc__",{})[f]||null}if(core.status.maps[f].flyPoint!=null&&core.status.maps[f].flyPoint.length==2){e="flyPoint"}if(e==null&&d==null){var c=core.floorIds.indexOf(b),g=core.floorIds.indexOf(f);var e=c<=g?"downFloor":"upFloor";if(c==g&&core.status.maps[b].underGround){e="upFloor"}if((b.indexOf("B")>=0||b.indexOf("S")>=0)&&f.indexOf("MT")>=0){e="upFloor"}if((b.indexOf("B")>=0||b.indexOf("MT")>=0)&&f.indexOf("S")>=0){e="downFloor"}if(b.indexOf("FT")>=0){e="upFloor"}if(core.status.maps[b].title==core.status.maps[f].title||f.indexOf("b")>=0||(0&&flags.bugFix&&core.floorIds.indexOf(f+"b")>=0)){if(core.status.maps[f].underGround){e="upFloor"}else{e="downFloor"}}}core.status.route.push("fly:"+f);core.ui.closePanel();core.setFlag("__isFlying__",true);core.changeFloor(f,e,d,null,function(){core.removeFlag("__isFlying__");if(a){a()}});return true},beforeBattle:function(c,f,g){if(f!=null&&g!=null){var e=f+","+g,b=core.status.checkBlock.cache[e]||{},d=b.guards||[];if(d.length>0){core.setFlag("__guards__"+f+"_"+g,d);var a=[{type:"playSound",name:"跳跃"}];d.forEach(function(h){core.push(a,{type:"jump",from:[h[0],h[1]],to:[f,g],time:300,keep:false,async:true})});core.push(a,[{type:"waitAsync"},{type:"battle",loc:[f,g]}]);core.insertAction(a);return false}}return true},afterBattle:function(e,t,v){var d=core.material.enemys[e];var o=d.special;var a="hand";var f=core.getEquip(0);if(f&&(core.material.items[f].equip||{}).animate){a=core.material.items[f].equip.animate}if(!(core.material.animates[a]||{}).se){core.playSound("attack.mp3")}if(t!=null&&v!=null){core.drawAnimate(a,t,v)}else{core.drawHeroAnimate(a)}var c=core.getDamageInfo(e,null,t,v)||{};var b=c.damage,i=c.hdmg,l=c.pdmg;var s=c.turn;if(b==null||i>=core.status.hero.hp||l>=core.status.hero.hpmax){core.status.hero.hp=0;core.updateStatusBar();core.events.lose("战斗失败");return}core.status.hero.hp-=i;core.status.hero.hpmax-=l;core.status.hero.mana=c.mana;core.setFlag("overCharge",c.overCharge);core.status.hero.statistics.battleDamage+=b;core.status.hero.statistics.battle++;var h=[];if(t!=null&&v!=null){h=core.getFlag("__guards__"+t+"_"+v,[]);core.removeFlag("__guards__"+t+"_"+v)}var k=h.reduce(function(x,y){return x+core.material.enemys[y[2]].money},core.getEnemyValue(d,"money",t,v));if(core.hasItem("coin")){k*=2}if(core.hasFlag("curse")){k=0}core.status.hero.money+=k;core.status.hero.statistics.money+=k;var g=h.reduce(function(x,y){return x+core.material.enemys[y[2]].exp},core.getEnemyValue(d,"exp",t,v));if(core.hasFlag("curse")){g=0}core.status.hero.exp+=g;core.status.hero.statistics.exp+=g;var j="打败 "+core.getEnemyValue(d,"name",t,v);if(core.flags.statusBarItems.indexOf("enableMoney")>=0){j+=","+core.getStatusLabel("money")+"+"+k}if(core.flags.statusBarItems.indexOf("enableExp")>=0){j+=","+core.getStatusLabel("exp")+"+"+g}if(core.isReplaying()){j="打败 "+core.getEnemyValue(d,"name",t,v)+",技能 "+(c.skill==""?"无":c.skill)}core.drawTip(j,d.id);if((core.enemys.hasSpecial(o,12)||core.enemys.hasSpecial(o,61)||core.enemys.hasSpecial(o,82))&&s>=5){core.triggerDebuff("get","poison")}if((core.enemys.hasSpecial(o,13)||core.enemys.hasSpecial(o,87))&&s>=5){core.setFlag("weakV",(d.damage||1));core.triggerDebuff("get","weak")}if(core.enemys.hasSpecial(o,14)){core.triggerDebuff("get","curse")}if(core.enemys.hasSpecial(o,17)){core.setFlag("hatred",Math.floor(core.getFlag("hatred",0)/2))}if(core.enemys.hasSpecial(o,19)){core.status.hero.statistics.battleDamage+=core.status.hero.hp-1;core.status.hero.hp=1}if(core.enemys.hasSpecial(o,21)){core.status.hero.atk-=(d.atkValue||0);core.status.hero.def-=(d.defValue||0);if(core.status.hero.atk<0){core.status.hero.atk=0}if(core.status.hero.def<0){core.status.hero.def=0}}core.setFlag("hatred",core.getFlag("hatred",0)+core.values.hatred);var q="";core.setFlag("battleTips","");if(core.myFormatSkill(core.getFlag("skillName",""))!=c.skill){core.setFlag("battleTips","实战"+(c.skill==""?":无":c.skill)+" ");q="实战技能："+(c.skill==""?"无":c.skill)+"（预设："+(flags.skillName==""?"无":flags.skillName)+"）\n"}if(c.flowMana){core.addFlag("battleTips","溢出气息"+c.flowMana+"点");q+="溢出气息"+c.flowMana+"点"}if(core.flags.statusBarItems.indexOf("enableSkill")>=0){var n=core.getFlag("skill",0);core.setFlag("skill",0);core.setFlag("skillName","")}var r=[];var m=h.reduce(function(x,y){return x+core.material.enemys[y[2]].point},core.getEnemyValue(d,"point",t,v))||0;if(core.flags.enableAddPoint&&m>0){core.push(r,[{type:"insert",name:"加点事件",args:[m]}])}if(core.status.floorId!=null){core.push(r,core.floors[core.status.floorId].afterBattle[t+","+v])}core.push(r,d.afterBattle);if(r.length>0){core.insertAction(r,t,v)}delete ((flags.enemyOnPoint||{})[core.status.floorId]||{})[t+","+v];if(core.getBlock(t,v)!=null){if(core.hasSpecial(d.special,999)){core.hideBlock(t,v)}else{if(core.hasSpecial(d.special,20)){if(d.id=="swordEmperor"){core.setBlock(398,t,v)}if(d.id=="goldHornSlime"){core.setBlock(400,t,v)}if(d.id=="whiteHornSlime"){core.setBlock(403,t,v)}if(d.id=="silverSlime"){core.setBlock(407,t,v)}}else{if(core.hasSpecial(d.special,23)){if(d.id=="E384"){core.setBlock(385,t,v)}if(d.id=="darkKnight"){core.setBlock(225,t,v)}if(d.id=="soldier"){core.setBlock(212,t,v)}}else{if(core.hasSpecial(d.special,70)){core.setBlock(11,t,v)}else{if(core.hasSpecial(d.special,71)){core.setBlock(374,t,v)}else{if(c.ic){core.setBlock(25,t,v)}else{core.removeBlock(t,v);if(core.hasSpecial(d.special,72)||core.hasSpecial(d.special,73)){for(var u=Math.max(1,t-1);u<=Math.min(11,t+1);u++){for(var w=Math.max(1,v-1);w<=Math.min(11,v+1);w++){if(!core.getBlock(u,w)||!core.getBlock(u,w).id||core.getBlock(u,w).id==340){if(core.hasSpecial(d.special,72)){core.setBlock(11,u,w)}if(core.hasSpecial(d.special,73)&&(hero.loc.x!=u||hero.loc.y!=w)&&(!core.status.hero.followers[0]||core.status.hero.followers[0].x!=u||core.status.hero.followers[0].y!=w)){core.setBlock(374,u,w)}}}}}}}}}}}}else{core.updateStatusBar()}core.autoGetItem();var p=function(){var x=true;var z=core.status.maps;for(var y in z){if(z[y].deleted){continue}(z[y].blocks||[]).forEach(function(A){if(A&&A.event&&A.event.id==d.id){x=false}});if(!x){return x}}return x};if(p()){Object.keys(core.status.hero.flags).forEach(function(x){if(x.indexOf("__@"+d.id+"@")>=0){delete core.status.hero.flags[x]}})}if(hero.hp<200||hero.hpmax<50){core.triggerAchieve(2)}if(c.znsf){core.triggerAchieve(17)}if(!flags.noBattleHint&&q&&e!="E447"){q="战斗异常提示：\n"+q;q+="\n\n你可以在帮助->高级设置里关闭战后弹出的战斗异常提示";core.insertAction([q])}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}},afterOpenDoor:function(b,d,e){if(b!="greenDoor"){core.autoGetItem()}var c=[];if(core.status.floorId){core.push(c,core.floors[core.status.floorId].afterOpenDoor[d+","+e])}var a=core.getBlockById(b);if(a&&a.event.doorInfo){core.push(c,a.event.doorInfo.afterOpenDoor)}if(c.length>0){core.insertAction(c,d,e)}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}},afterGetItem:function(c,e,f,b){if(c.endsWith("Potion")&&core.material.items[c].cls=="items"){core.playSound("回血")}else{core.playSound("获得道具")}core.autoGetItem();var d=[];if(core.status.floorId==null){return}var a=core.floors[core.status.floorId].afterGetItem[e+","+f];if(a&&(a instanceof Array||!b||!a.disableOnGentleClick)){core.unshift(d,a)}if(d.length>0){core.insertAction(d,e,f)}switch(c){case"I328":core.triggerAchieve(1);break;case"redPotion":if(hero.hp<450){core.triggerAchieve(3)}break;case"bluePotion":if(hero.hp<700){core.triggerAchieve(3)}break;case"I315":case"I316":case"I317":case"I318":case"I319":if(flags.atkm==10){core.triggerAchieve(6)}else{if(flags.atkm==34){core.triggerAchieve(23)}}break;case"I320":case"I321":case"I322":case"I339":case"I375":if(flags.defm==40){core.triggerAchieve(7)}else{if(flags.defm==16){core.triggerAchieve(24)}}break;case"I451":core.triggerAchieve(11);break;case"moneyPocket":core.triggerAchieve(12);break;case"skill1":case"I307":case"I309":if(flags.sxzl>=2){core.triggerAchieve(15)}break;case"pickaxe":core.triggerAchieve(16);break;case"shield3":case"shield4":case"shield5":core.triggerAchieve(18);break;case"iceCube":core.triggerAchieve(19);break;case"snow":core.triggerAchieve(20);break;case"I398":case"I400":case"I403":case"I407":if(core.itemCount("I398")+core.itemCount("I400")+core.itemCount("I403")+core.itemCount("I407")>90){core.triggerAchieve(21)}break;case"knife":core.triggerAchieve(22);break;case"redKey":case"bigKey":if(core.itemCount("redKey")>=10){core.triggerAchieve(25)}break;case"icePickaxe":core.triggerAchieve(26);break;case"greenKey":if(core.itemCount("greenKey")>15){core.triggerAchieve(27)}break;case"cross":if(hero.mdef>260){core.triggerAchieve(28)}break;case"superPotion":if(flags.achieves[28][4]){core.triggerAchieve(30)}else{core.triggerAchieve(29)}break}},afterPushBox:function(){if(core.searchBlock("box").length==0){}}},enemys:{getSpecials:function(){return[[2,function(a){if(typeof a.special!="object"||a.special.length<=1){return"魔法攻击"}else{if(a.name=="火炎大法师"){return"炎魔法"}else{if(a.name=="极地法师"){return"冰魔法"}else{return"魔法"}}}},"攻击无视主角防御力","#bbb0ff"],[3,"硬化","如主角攻击力比它基本防御力高时，它的防御力会变成主角的攻击力","#c0b088"],[4,"二回攻击","怪物每回合攻击2次","#ffee77"],[5,"三回攻击","怪物每回合攻击3次","#ffee77"],[6,function(a){if(a.n==4){return"刀刀相连"}else{if(a.n==6){return"触手攻击"}else{return(a.n||"")+"连击"}}},function(a){return"怪物每回合攻击"+(a.n||4)+"次"},"#ffee77"],[12,"毒攻击","进入第5回合时主角会中毒，每一步损失生命"+core.values.poisonDamage+"点","#99ee88"],[13,"衰弱攻击",function(a){return"进入第5回合时主角会进入衰弱状态，攻防暂时下降"+(a.damage||1)+"点"},"#f0bbcc"],[20,"特殊战斗","勇士无法打败怪物，除非拥有三相之力","#aaaaaa"],[23,"不死","死后由四周的邪恶能量而重生，并获得新特殊能力","#a0e0ff"],[50,"邪眼","主角不能使用黄金之羽根","#a349a4"],[51,"必杀剑","会心一击的伤害是基本伤害的2.5倍","#ffee77"],[52,"黏液拳","主角被击中后，疲劳度会上升（每攻击一次疲劳+1）","#bbeef0"],[53,"狂暴之拳","随机攻击次数（1-3，复刻版固定为1），且主角被击中后会增加疲劳（每次攻击疲劳+1）","#bbeef0"],[54,"水银拳","被击中后会感到很疲倦（每攻击一次疲劳+3）","#bbeef0"],[55,"狙击","攻击的对象是公主而不是主角","#80eed6"],[56,"雷击","攻击会使主角因感到麻痹而疲劳（当做出有效攻击时疲劳+4）","#bbeef0"],[57,"吸血攻击",function(a){return"给予主角伤害的"+((a.add&&!flags.bugFix)?"1/3":"50%")+"会恢复至自身的体力"},"#ff00d2"],[58,"神气合一",function(){return"被它的会心一击击中时"+(flags.bugFix?"":"（实际判定条件为：伤害大于怪物攻击减勇者防御）")+"，主角的气息会减去一格"},"#bbeef0"],[59,"天地破坏剑","会心一击十分厉害（会心一击伤害是基本伤害的4倍）","#ffee77"],[60,"暗魔法","攻击无视主角防御力，且主角的防御力不比它的攻击高时，攻击会三倍化；即使被攻击也不会增加气息","#bbb0ff"],[61,"冰秘术","全体魔法攻击，进入第5回合时主角会中毒","#80eed6"],[62,"风秘术","全体魔法攻击，攻击会恢复自身的疲倦","#80eed6"],[63,"火秘术","全体魔法攻击","#80eed6"],[64,"秘术·死寂光环","全体魔法攻击；战斗中主角不会增加气息（实际仍会增加）","#80eed6"],[65,"血秘术","全体魔法攻击；攻击总伤害的一半会回复在身上","#80eed6"],[66,"血魔法","攻击无视主角防御力；给予主角伤害的50%会恢复至自身的体力","#bbb0ff"],[67,"魔法剑",function(){return"会心一击很痛（会心一击伤害是基本伤害的"+(flags.bugFix?"3":"2")+"倍）；攻击伤害的一半会回复在身上"},"#ff00d2"],[70,"炎之身体","死后会使地上留下熔岩","#d00000"],[71,"寒冰身体","死后会使地上留下冰块","#bbb0ff"],[72,"烈焰身体","死后四周的地上会被焦成一片熔岩","#d00000"],[73,"极寒身体","死后四周的土地会冻成冰块","#bbb0ff"],[74,"黄金身体","它整个身体都是黄金，总之击败它后就是有很多钱啦！！！（掉落1600金币外加强剑之首饰）","#e6e099"],[80,"催眠","令主角攻击自己","#c0ddbb"],[81,"破甲刃","攻击会减低主角防御力，40%几率降低12点（复刻版为3k+1次攻击时触发）","#b30000"],[82,"猛毒","进入第5回合时主角会中毒；如果主角已在毒状态时，它每次攻击有60%几率使攻击力与防御力提升10点（复刻版为奇数次攻击时触发）","#99ee88"],[83,"狂战士之拳","随机攻击次数（2-5，复刻版为2,3,2,3,...），且主角被击中后会增加疲劳（每次攻击疲劳+4）","#bbeef0"],[84,"狂战士之斧","攻击附带额外固定100伤害","#bbb0ff"],[85,"硬化+","如主角攻击力比它基本防御力高时，它的攻击力及防御力会变成主角的攻击力","#c0b088"],[86,"死气","它被攻击中时，主角会感到很疲劳（主角每击中它一次疲劳+10）","#a349a4"],[87,"麻痹触手","一回合六次攻击；进入第5回合时主角会进入衰弱状态","#f0bbcc"],[88,"鬼吹灯","攻击会扣除主角的气息40点（不足则清零），然后自身气息增加40点","#ff6666"],[89,"压制","攻击会减低主角战斗力，60%几率降低20攻击，5防御（复刻版为奇数次攻击时触发）","#b30000"],[91,"剑大师","气息满时不暴击；顺序使用剑技：\n天灵：主角被击中后会增加疲劳8点；\n流石：主角被击中后会减少气息30点；\n深红：伤害的五分之一会回复到身上","#ff0000"],[92,"盾大师","气息满时不暴击；顺序使用防御技：\n镜膜盾：所受伤害减半；\n结晶盾：主角下一回合不能行动；\n反射盾：伤害的四分之一反射在主角身上","#0000ff"],[93,"超负荷魔力",function(){return(flags.bugFix?"":"普通")+"攻击时发出的魔力术击会在主角和公主之间跳弹并做成伤害，每次弹跳的伤害减少20%，总共跳弹四次"},"#00ff00"]]},getEnemyInfo:function(d,g,v,w,e){e=e||core.status.floorId;var j=core.getRealStatusOrDefault(g,"hp"),h=core.getRealStatusOrDefault(g,"atk"),i=core.getRealStatusOrDefault(g,"def"),k=core.getRealStatusOrDefault(g,"mdef");var q=core.getEnemyValue(d,"hp",v,w,e),n=core.getEnemyValue(d,"atk",v,w,e),o=core.getEnemyValue(d,"def",v,w,e),t=core.getEnemyValue(d,"special",v,w,e);var r=core.getEnemyValue(d,"money",v,w,e),p=core.getEnemyValue(d,"exp",v,w,e),s=core.getEnemyValue(d,"point",v,w,e);if(core.hasSpecial(t,10)){n=h;o=i}if(core.hasSpecial(t,3)&&o<h){o=h}if(core.hasSpecial(t,85)&&o<h){o=h;n=h}if(core.hasSpecial(t,60)&&n>=i){n*=3}var f=[];if(!core.status.checkBlock){core.status.checkBlock={}}if(core.status.checkBlock.needCache){var l=0,a=0,c=0;var u={};var m=v!=null&&w!=null?(v+","+w):"floor";if(!core.status.checkBlock.cache){core.status.checkBlock.cache={}}var b=core.status.checkBlock.cache[m];if(!b){core.extractBlocks(e);core.status.maps[e].blocks.forEach(function(x){if(!x.disable){var B=x.event.id,A=core.material.enemys[B];if(A&&core.hasSpecial(A.special,25)){var C=A.range==null;if(A.range!=null&&v!=null&&w!=null){var y=Math.abs(x.x-v),z=Math.abs(x.y-w);if(y+z<=A.range){C=true}if(A.zoneSquare&&y<=A.range&&z<=A.range){C=true}}if(C&&(A.add||!u[A.id])){l+=A.value||0;a+=A.atkValue||0;c+=A.defValue||0;u[A.id]=true}}if(A&&core.hasSpecial(A.special,26)&&v!=null&&w!=null&&Math.abs(x.x-v)<=1&&Math.abs(x.y-w)<=1&&!(v==x.x&&w==x.y)){f.push([x.x,x.y,B])}}});core.status.checkBlock.cache[m]={hp_buff:l,atk_buff:a,def_buff:c,guards:f}}else{l=b.hp_buff;a=b.atk_buff;c=b.def_buff;f=b.guards}q*=(1+l/100);n*=(1+a/100);o*=(1+c/100)}return{hp:Math.floor(q),atk:Math.floor(n),def:Math.floor(o),money:Math.floor(r),exp:Math.floor(p),point:Math.floor(s),special:t,guards:f,}},getDamageInfo:function(b,k,X,Z,d){d=d||core.status.floorId;if(typeof b=="string"){b=core.material.enemys[b]}var o=core.getRealStatusOrDefault(k,"hp"),l=core.getRealStatusOrDefault(k,"atk"),n=core.getRealStatusOrDefault(k,"def"),r=core.getRealStatusOrDefault(k,"mdef"),q=core.status.hero.mana;if(k&&"mana" in k){q=k.mana}o=Math.max(0,o);l=Math.max(0,l);n=Math.max(0,n);r=Math.max(0,r);var c=core.enemys.getEnemyInfo(b,k,X,Z,d);var F=c.hp,C=c.atk,D=c.def,S=core.clone(c.special),J=false,W=0;if(core.enemys.hasSpecial(S,12)||core.enemys.hasSpecial(S,61)||core.enemys.hasSpecial(S,82)){J=true}if(core.enemys.hasSpecial(S,13)||core.enemys.hasSpecial(S,87)){W=(b.damage||1)}[61,62,64,65].forEach(function(h){if(core.hasSpecial(S,h)){S.push(63)}});[60,63,66].forEach(function(h){if(core.hasSpecial(S,h)){S.push(2)}});[65,66,67].forEach(function(h){if(core.hasSpecial(S,h)){S.push(57)}});var L={h:{hp:o,atk:l,def:n,tired:0,mana:q,mmax:core.status.hero.manamax,mmm:core.status.hero.manamax/6,defBuff:[],fmana:0,res:"",overCharge:core.getFlag("overCharge",0)},p:{hp:core.status.hero.hpmax,def:r},m:{hp:F,atk:C,def:D,tired:0,mana:0,mmax:b.value||0,sp:S,poi:J,weakPt:W,vampireRate:((b.add&&!flags.bugFix)?3:2),rock:["石头怪","铁怪","鬼邪石"].indexOf(b.name||"")>=0},turn:0,skillBar:""};var e=L.h,w=L.m,H=L.p;core.setKiMana(e);e.res=("start:"+e.ki+"+"+e.charge);var B=F*10;var R=core.myFormatSkill(core.getFlag("skillName",""),false,true),P="",aa="",Y="";switch(core.getEquip(0)){case"I315":aa=1;break;case"I319":aa=2;break;case"I318":aa=3;break;case"I317":aa=4;break;case"I316":aa=5;break}e.Zi=aa;switch(core.getEquip(1)){case"I339":Y=1;break;case"I321":Y=2;break;case"I375":Y=3;break;case"I322":Y=4;break;case"I320":Y=5;break}var E=1;if(core.hasSpecial(S,4)){E=2}if(core.hasSpecial(S,5)){E=3}if(core.hasSpecial(S,6)){E=(b.n||4)}if(core.hasSpecial(S,87)){E=6}if(core.hasSpecial(S,20)){L.turn++;R=core.removeStopper(R,L.turn,L);R=core.deepBreath(L,R);if(R.substr(0,2)=="-C"){var N=core.clone(L),O=core.clone(L);if(core.heroAtk(N,"C").m.hp<=0&&core.heroAtk(O,"").m.hp>0){R=R.substr(1);L.skillBar+="-"}}P=R.substr(0,1);if("CZA".indexOf(P)>=0){R=R.substr(1)}else{P=""}if(P=="Z"){var Q=R.substr(0,1);if(/[1-5]/.test(Q)){P+=Q;R=R.substr(1);if(core.hasItem("I326")){e.Zi=Q}}else{P+=aa}}core.heroAtk(L,P);var U=flags.sxzl;if(U>=3){w.hp=0}else{if(w.hp>0){if(U<=0){return null}else{if(core.hasItem("knife")){U+=2}switch(b.id){case"swordEmperor":if(U<4||core.hasItem("skill1")){return null}break;case"silverSlime":if(U<4){return null}break;case"goldHornSlime":if(U<=1){e.hp-=Math.ceil(w.hp/3*5)*w.atk}else{if(U<=2){e.hp-=Math.ceil(w.hp/3)*w.atk}}break;case"whiteHornSlime":if(U<=1){e.hp-=Math.ceil(w.hp*1.4)*w.atk}else{if(U<=2){e.hp-=Math.ceil(w.hp/4)*w.atk}}break;default:return null}w.hp=0}}}}var a=true,K=false;if(e.atk+core.getFlag("atkm",10)<w.def){a=(w.hp==0)}if(core.getEquip(1)=="I375"&&R.indexOf("X")>=0){a=true}if(core.hasItem("I325")){[55,61,62,63,64,65].forEach(function(h){if(core.hasSpecial(S,h)){K=true}})}if(K){a=true}if(core.hasItem("I327")&&core.canEquip("I375")&&R.indexOf("X3")>=0){a=true}if(!a){return null}var M,T=0,G=1;[83,89].forEach(function(h){if(core.hasSpecial(S,h)){G=2}});[81,91,92].forEach(function(h){if(core.hasSpecial(S,h)){G=3}});for(L.turn=1;L.turn<=B;L.turn++){if(w.hp<=0){L.turn--;break}if(L.turn==11){R=core.myReplaceAll(R,"-C","")}if(M&&T==2&&M.m.mana==w.mana&&M.mdmg==L.mdmg&&M.hdmg==L.hdmg&&M.pdmg==L.pdmg&&(M.turn-L.turn)%G==0&&e.tired<100&&w.tired<100&&w.hp>0&&!core.hasSpecial(S,81)&&!core.hasSpecial(S,89)){var f=e.tired-M.h.tired,A=w.tired-M.m.tired,z=M.m.hp-w.hp;var V=10000;if(f>0){V=Math.min(V,Math.ceil((100-e.tired)/f)-1)}if(A>0){V=Math.min(V,Math.ceil((100-w.tired)/A)-1)}if(z>0){V=Math.min(V,Math.ceil(w.hp/z)-1)}e.tired+=V*f;w.tired+=V*A;w.hp-=V*z;e.hp-=V*(M.h.hp-e.hp);H.hp-=V*(M.p.hp-H.hp);core.setKiMana(e);core.setKiMana(M.h);core.chargeKi(e,V*(Math.floor(e.mana)-Math.floor(M.h.mana)));L.turn+=V*(L.turn-M.turn);T++}if(T==1){M=core.clone(L);T++}if(!T&&R.length==0&&e.defBuff==0&&(w.mana==0||w.mana==w.mmax)&&L.turn>5){T=1}if(w.tired>=100&&e.tired<100&&!core.hasSpecial(S,86)&&e.atk+core.getFlag("atkm",10)>=w.def&&R.length==0){var V=w.hp;if(e.atk>w.def){V=Math.ceil(w.hp/(e.atk-w.def));core.chargeKi(e,V*Math.floor(0.5+w.def*10/e.atk))}L.turn+=V;w.hp=0}if((e.tired>=100||e.atk+core.getFlag("atkm",10)<w.def)&&R.length==0&&!K){return null}if(w.hp<=0){L.turn--;break}R=core.removeStopper(R,L.turn,L);R=core.deepBreath(L,R);if(e.freeze){e.freeze--}else{if(R.substr(0,2)=="-C"){var N=core.clone(L),O=core.clone(L);if(core.heroAtk(N,"C").m.hp<=0&&core.heroAtk(O,"").m.hp>0){R=R.substr(1);L.skillBar+="-"}}P=R.substr(0,1);if("CZA".indexOf(P)>=0){R=R.substr(1)}else{P=""}if(P=="Z"){var Q=R.substr(0,1);if(/[1-5]/.test(Q)){P+=Q;R=R.substr(1);if(core.hasItem("I326")){e.Zi=Q}}else{P+=aa}}core.heroAtk(L,P);if(w.hp<=0){break}}if(w.freeze){w.freeze--}else{if(core.hasSpecial(S,83)){if(E==2){E++}else{E=2}}for(var u=1;u<=E;u++){if(!w.freeze){R=core.deepBreath(L,R);P=R.substr(0,1);if("XD".indexOf(P)>=0){R=R.substr(1)}else{P=""}if(P=="X"){var Q=R.substr(0,1);if(/[1-5]/.test(Q)){P+=Q;R=R.substr(1);if(core.hasItem("I326")){Y=Q}}else{P+=Y}}core.monAtk(L,P);if(w.hp<=0){break}if(core.hasSpecial(S,93)&&w.sp2){for(var v=1;v<=3;v++){core.monAtk(L);if(w.hp<=0){break}}}}}}}if(w.hp>0){return null}e.res+=(",end:"+e.ki+"+"+e.charge);var g=Math.floor(o-e.hp),I=Math.floor(core.status.hero.hpmax-L.p.hp);core.setKiMana(e);return{mon_hp:Math.floor(F),mon_atk:Math.floor(C),mon_def:Math.floor(D),init_damage:0,per_damage:0,hero_per_damage:0,turn:Math.floor(L.turn),damage:g+I,mana:e.mana,flowMana:Math.floor(e.fmana),manaResult:e.res,hdmg:g,pdmg:I,skill:core.myFormatSkill(L.skillBar),overCharge:e.overCharge,ic:L.ic&&b.id=="bluePriest",znsf:L.znsf}}},actions:{onKeyUp:function(g,a){if(core.isMoving()){return}if(0&&a&&g>=48&&g<=57){core.items.quickLoadEquip(g-48);return}var j=false;if(a){j=!j}if(flags.xinHotkey){j=!j}if((g>=49&&g<=56)||(g>=97&&g<=104)){var e=g-48;if(e>10){e-=48}if(!a||e==8){core.status.route.push("key:"+g);core.useItem("A"+e,true)}else{switch(e){case 1:core.openBook(true);break;case 2:core.useFly(true);break;case 3:core.openEquipbox(true);break;case 4:core.openQuickShop(true);break;case 5:core.doSL("autoSave","load");break;case 6:core.doSL("autoSave","reload");break;case 7:core.status.route.push("key:85");core.insertCommonEvent("高级设置");break}}return}var c="新新快捷键：\n";if(!flags.xinHotkey){c+="(你选择H5快捷键优先，使用新新快捷键时，若与H5快捷键冲突，则需要按住Alt键；按U进入高级设置修改优先的快捷键)\n"}c+="S=音乐开关\nR=重新开始\n[=保存进度\n]=载入进度\nA=查看成就\nD=查看怪物能力\nF=飞行\nW=剑技装备\nH=防御术装备\nG=启动体力转换器\nB=查看道具袋\n\n随意门直接撞紫门即可";var d="H5重要快捷键：\n";if(flags.xinHotkey){d+="(你选择新新快捷键优先，使用H5快捷键时，若与新新快捷键冲突，则需要按住Alt键；按U进入高级设置修改优先的快捷键)\n"}d+="A=单步回退\nW=取消单步回退\nS=存档\nD=读档\nG=楼层传送\nX=怪物手册\nV=快捷商店\n\nZ=转身\n空格=取面前物品\nH=查看所有H5快捷键";var b=[c,d];switch(g){case 76:case 89:core.insertAction(b);break;case 85:core.status.route.push("key:85");core.insertCommonEvent("高级设置");break;case 57:core.status.route.push("key:57");core.insertCommonEvent("设置技能");break;case 27:core.openSettings(true);break;case 88:core.openBook(true);break;case 71:if((j&&core.canUseItem("I451"))||core.isReplaying()){core.status.route.push("key:71");core.useItem("I451",true)}else{core.useFly(true)}break;case 65:if((j&&core.canUseItem("I453"))||core.isReplaying()){core.status.route.push("key:65");core.useItem("I453",true)}else{core.doSL("autoSave","load")}break;case 87:if(j){core.openEquipbox(true)}else{core.doSL("autoSave","reload")}break;case 83:if(j){core.triggerBgm()}else{core.save(true)}break;case 219:core.save(true);break;case 68:if(j){core.openBook(true)}else{core.load(true)}break;case 221:core.load(true);break;case 69:core.ui._drawCursor();break;case 84:core.openToolbox(true);break;case 81:core.openEquipbox(true);break;case 90:core.turnHero();break;case 86:core.openQuickShop(true);break;case 32:core.getNextItem();break;case 82:if(j){core.confirmRestart()}else{core.ui._drawReplay()}break;case 33:case 34:core.ui._drawViewMaps();break;case 66:if((j&&core.canUseItem("moneyPocket"))||core.isReplaying()){core.status.route.push("key:66");core.useItem("moneyPocket",true)}else{core.ui._drawStatistics()}break;case 72:if(j){core.openEquipbox(true)}else{core.ui._drawHelp()}break;case 77:core.actions._clickNotes_show();break;case 78:core.confirmRestart();break;case 79:core.actions._clickGameInfo_openProject();break;case 80:core.actions._clickGameInfo_openComments();break;case 49:if(core.hasItem("pickaxe")){core.status.route.push("key:49");core.useItem("pickaxe",true)}break;case 50:if(core.hasItem("bomb")){core.status.route.push("key:50");core.useItem("bomb",true)}break;case 51:if(core.hasItem("centerFly")){core.ui._drawCenterFly()}break;case 52:var h=["icePickaxe","freezeBadge","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine"];for(var e=0;e<h.length;e++){var f=h[e];if(core.canUseItem(f)){core.status.route.push("key:52");core.useItem(f,true);break}}break;case 53:core.doSL("autoSave","load");break;case 54:core.doSL("autoSave","reload");break;case 55:core.getNextItem();break;case 118:core.debug();break;case 70:if(j){core.useFly(true)}else{core.status.route.push("key:56");core.useItem("A8",true)}break}},onStatusBarClick:function(b,c,d){var a=function(){if(core.isReplaying()&&d!=null){return d}return core.domStyle.isVertical};if(core.status.lockControl){return}if(core.isMoving()){return}}},control:{saveData:function(){var c={};for(var b in core.values){if(!core.same(core.values[b],core.data.values[b])){c[b]=core.clone(core.values[b])}}var a={floorId:core.status.floorId,hero:core.clone(core.status.hero),hard:core.status.hard,maps:core.maps.saveMap(),route:core.encodeRoute(core.status.route),values:c,version:core.firstData.version,guid:core.getGuid(),time:new Date().getTime()};return a},loadData:function(b,a){core.resetGame(b.hero,b.hard,b.floorId,core.maps.loadMap(b.maps,null,b.hero.flags),b.values);core.status.route=core.decodeRoute(b.route);core.control._bindRoutePush();core.status.textAttribute=core.getFlag("textAttribute",core.status.textAttribute);var d=core.getFlag("globalAttribute",core.status.globalAttribute);if(!core.same(d,core.status.globalAttribute)){core.status.globalAttribute=d;core.resize()}core.events.setVolume(core.getFlag("__volume__",1),0);var c=core.status.hero.image;c=core.getMappedName(c);if(core.material.images.images[c]){core.material.images.hero=core.material.images.images[c];core.material.icons.hero.width=core.material.images.images[c].width/4;core.material.icons.hero.height=core.material.images.images[c].height/4}core.setFlag("__fromLoad__",true);core.changeFloor(b.floorId,null,b.hero.loc,0,function(){if(core.hasFlag("__bgm__")){core.playBgm(core.getFlag("__bgm__"))}core.removeFlag("__fromLoad__");if(a){a()}})},getStatusLabel:function(a){return{name:"名称",lv:"等级",hpmax:"生命上限",hp:"生命",manamax:"魔力上限",mana:"魔力",atk:"攻击",def:"防御",mdef:"护盾",money:"金币",exp:"经验",point:"加点",steps:"步数",}[a]||a},triggerDebuff:function(a,b){if(!(b instanceof Array)){b=[b]}if(a=="get"){if(core.inArray(b,"poison")&&!core.hasFlag("poison")&&(flags.bugFix||!core.hasFlag("weak"))){core.setFlag("poison",true)}if(core.inArray(b,"weak")&&(flags.bugFix||!core.hasFlag("poison"))){core.setFlag("weak",true);if(1||core.values.weakValue>=1){core.addStatus("atk",-core.getFlag("weakV",1));core.addStatus("def",-core.getFlag("weakV",1));core.addFlag("weakValue",core.getFlag("weakV",1))}else{core.addBuff("atk",-core.values.weakValue);core.addBuff("def",-core.values.weakValue)}}if(core.inArray(b,"curse")&&!core.hasFlag("curse")){core.setFlag("curse",true)}}else{if(a=="remove"){if(core.inArray(b,"poison")&&core.hasFlag("poison")){core.setFlag("poison",false);core.autoGetItem()}if(core.inArray(b,"weak")&&core.hasFlag("weak")){core.setFlag("weak",false);if(1||core.values.weakValue>=1){core.addStatus("atk",core.getFlag("weakValue",0));core.addStatus("def",core.getFlag("weakValue",0));core.setFlag("weakValue",0)}else{core.addBuff("atk",core.values.weakValue);core.addBuff("def",core.values.weakValue)}}if(core.inArray(b,"curse")&&core.hasFlag("curse")){core.setFlag("curse",false)}}}},updateStatusBar:function(){core.events.checkLvUp();if(false&&core.flags.statusBarItems.indexOf("enableHPMax")>=0){core.setStatus("hp",Math.min(core.getRealStatus("hpmax"),core.getStatus("hp")))}if(core.status.floorId){var c="公主未入队";if(hero.mdef>0){c=hero.hpmax+";"+hero.mdef}core.setStatusBarInnerHTML("floor",c)}core.setStatusBarInnerHTML("name",core.getStatus("name"));core.setStatusBarInnerHTML("lv",core.getLvName());var j=["hpmax","hp","atk","def","mdef","money","exp"];j.forEach(function(h){core.status.hero[h]=Math.floor(core.status.hero[h]);core.setStatusBarInnerHTML(h,core.status.hero[h])});var j=["atk","def"];j.forEach(function(h){core.status.hero[h]=Math.floor(core.status.hero[h]);core.setStatusBarInnerHTML(h,core.status.hero[h]+core.getFlag("weakValue",0))});if(core.status.hero.mdef<=0){core.setStatusBarInnerHTML("hpmax","公主未入队");core.setStatusBarInnerHTML("mdef","公主未入队")}if(core.status.hero.manamax!=null&&core.getRealStatus("manamax")>=0){var d={mana:core.status.hero.mana,mmm:core.status.hero.manamax/6};core.setKiMana(d);core.setStatusBarInnerHTML("mana",d.ki);if(!main.replayChecking&&1>0){var f=core.statusBar.mana.innerHTML.indexOf("<font color");if(f>=0){core.statusBar.mana.innerHTML=core.statusBar.mana.innerHTML.substring(0,f)}var b=d.charge+"/"+(core.getRealStatus("manamax")/6);core.statusBar.mana.innerHTML+="<font color='#ccc' , style='font-size: 0.75em; position: absolute; top: 12%; '>&nbsp;+"+b+"</font>"}}else{core.setStatusBarInnerHTML("mana",core.status.hero.mana)}var i=core.getFlag("skillName","");core.setStatusBarInnerHTML("skill",i==""?"无":(i.length>10?i.substr(0,9)+"..":i));var a=core.getFlag("battleTips","");if(i==""&&a!=""){core.setStatusBarInnerHTML("skill",a.length>8?a.substr(0,7)+"..":a)}["atk","def"].forEach(function(l){if(!main.replayChecking){var k=core.statusBar[l].innerHTML.indexOf("<font color");if(k>=0){core.statusBar[l].innerHTML=core.statusBar[l].innerHTML.substring(0,k)}var h=-core.getFlag("weakValue");if(h>0){core.statusBar[l].innerHTML+="<font color='#40c340' , style='font-size: 0.75em; position: absolute; top: 12%; '>&nbsp;+"+h+"</font>"}if(h<0){core.statusBar[l].innerHTML+="<font color='#FF6666' , style='font-size: 0.75em; position: absolute; top: 12%; '>??"+h+"</font>"}}});if(core.flags.statusBarItems.indexOf("enableLevelUp")>=0){core.setStatusBarInnerHTML("up",core.formatBigNumber(core.getNextLvUpNeed())||"")}else{core.setStatusBarInnerHTML("up","")}var g=["yellowKey","blueKey","redKey","greenKey"];g.forEach(function(h){core.setStatusBarInnerHTML(h,(h=="greenKey"?"随":"")+core.setTwoDigits(core.itemCount(h)))});g.forEach(function(h){core.setStatusBarInnerHTML(h,(h=="greenKey"?"随":"")+core.itemCount(h))});core.setStatusBarInnerHTML("poison",core.hasFlag("poison")?"中毒":"");core.setStatusBarInnerHTML("weak",core.hasFlag("weak")?"衰弱-"+core.getFlag("weakValue",0):"");core.setStatusBarInnerHTML("curse",core.hasFlag("curse")?"咒":"");core.setStatusBarInnerHTML("pickaxe","破"+core.itemCount("pickaxe"));core.setStatusBarInnerHTML("bomb","炸"+core.itemCount("bomb"));core.setStatusBarInnerHTML("fly","飞"+core.itemCount("centerFly"));if(core.statusBar.hard.innerText!=core.status.hard){core.statusBar.hard.innerText=core.status.hard}var e=core.getFlag("__hardColor__","red");if(core.statusBar.hard.getAttribute("_style")!=e){core.statusBar.hard.style.color=e;core.statusBar.hard.setAttribute("_style",e)}core.drawStatusBar();core.updateCheckBlock();core.updateDamage();if(hero.hp>5000){core.triggerAchieve(4)}if(hero.atk>100&&hero.def>100){core.triggerAchieve(5)}if(hero.mana>=hero.manamax){core.triggerAchieve(8)}if(hero.hp>12000){core.triggerAchieve(9)}if(hero.money>1000){core.triggerAchieve(13)}if(hero.exp>280){core.triggerAchieve(14)}if(core.status.hero.statistics.battle>1200){core.triggerAchieve(33)}if(hero.atk>1700){core.triggerAchieve(34)}if(hero.def>1700){core.triggerAchieve(35)}if(hero.lv>=140){core.triggerAchieve(36)}},updateCheckBlock:function(r){r=r||core.status.floorId;if(!r||!core.status.maps){return}var Q=core.floors[r].width,s=core.floors[r].height;var d=core.getMapBlocksObj(r);var i={},O={},F={},a={};var b={};var A=false;var g=core.flags.canGoDeadZone;core.flags.canGoDeadZone=true;for(var z in d){var c=d[z],R=c.x,T=c.y,t=c.event.id,m=core.material.enemys[t];if(c.disable){continue}O[z]=O[z]||{};if(t=="lavaNet"&&!core.hasItem("amulet")){if(core.hasItem("snow")){i[z]=(i[z]||0)+core.values.lavaDamage/5}else{i[z]=(i[z]||0)+core.values.lavaDamage}O[z][(c.event.name||"血网")+"伤害"]=true}if(m&&core.hasSpecial(m.special,15)&&!core.hasFlag("no_zone")){var D=m.range||1;var U=false;if(m.zoneSquare!=null){U=m.zoneSquare}for(var k=-D;k<=D;k++){for(var l=-D;l<=D;l++){if(k==0&&l==0){continue}var B=R+k,C=T+l,h=B+","+C;if(B<0||B>=Q||C<0||C>=s){continue}if(!U&&Math.abs(k)+Math.abs(l)>D){continue}i[h]=(i[h]||0)+(m.value||0);O[h]=O[h]||{};O[h]["领域伤害"]=true}}}if(m&&core.hasSpecial(m.special,18)&&!core.hasFlag("no_repulse")){var K=m.zoneSquare?core.utils.scan2:core.utils.scan;for(var j in K){var B=R+K[j].x,C=T+K[j].y,h=B+","+C;if(B<0||B>=Q||C<0||C>=s){continue}i[h]=(i[h]||0)+(m.value||0);O[h]=O[h]||{};O[h]["阻击伤害"]=true;var E=core.turnDirection(":back",j);var I=R+K[E].x,J=T+K[E].y;if(I<0||I>=Q||J<0||J>=s){continue}if(core.getBlock(I,J,r,false)!=null){continue}if(core.utils.scan[E]&&!core.canMoveHero(R,T,E,r)){continue}F[h]=(F[h]||[]).concat([[R,T,t,E]])}}if(m&&core.hasSpecial(m.special,24)&&!core.hasFlag("no_laser")){for(var B=0;B<Q;B++){var h=B+","+T;if(B!=R){i[h]=(i[h]||0)+(m.value||0);O[h]=O[h]||{};O[h]["激光伤害"]=true}}for(var C=0;C<s;C++){var h=R+","+C;if(C!=T){i[h]=(i[h]||0)+(m.value||0);O[h]=O[h]||{};O[h]["激光伤害"]=true}}}if(m&&core.enemys.hasSpecial(m.special,27)&&!core.hasFlag("no_ambush")){var K=m.zoneSquare?core.utils.scan2:core.utils.scan;for(var j in K){var B=R+K[j].x,C=T+K[j].y,h=B+","+C;if(B<0||B>=Q||C<0||C>=s||(core.utils.scan[j]&&!core.canMoveHero(R,T,j,r))){continue}a[h]=(a[h]||[]).concat([[R,T,t,j]])}}if(m&&core.enemys.hasSpecial(m.special,16)&&!core.hasFlag("no_betweenAttack")){for(var j in core.utils.scan){var B=R+core.utils.scan[j].x,C=T+core.utils.scan[j].y,h=B+","+C;if(B<0||B>=Q||C<0||C>=s){continue}b[h]=true}}var L=core.getSpecialFlag(m);if(L&1){A=true}if(core.status.event.id=="viewMaps"){A=true}if((core.status.event.id=="book"||core.status.event.id=="bool-detail")&&core.status.event.ui){A=true}}for(var z in b){var S=z.split(","),R=parseInt(S[0]),T=parseInt(S[1]);var p=null,q=null;var u=d[(R-1)+","+T],G=d[(R+1)+","+T];var w=core.getFaceDownId(u),H=core.getFaceDownId(G);if(u&&!u.disable&&G&&!G.disable&&w==H){if(core.hasSpecial(w,16)){p=w}}var M=d[R+","+(T-1)],e=d[R+","+(T+1)];var N=core.getFaceDownId(M),f=core.getFaceDownId(e);if(M&&!M.disable&&e&&!e.disable&&N==f){if(core.hasSpecial(N,16)){q=N}}if(p!=null||q!=null){var v=core.status.hero.hp-(i[z]||0);if(v>1){var P=Math.floor(v/2);if(core.flags.betweenAttackMax){var n=core.getDamage(p,R,T,r);if(n!=null&&n<P){P=n}var o=core.getDamage(q,R,T,r);if(o!=null&&o<P){P=o}}if(P>0){i[z]=(i[z]||0)+P;O[z]=O[z]||{};O[z]["夹击伤害"]=true}}}}core.flags.canGoDeadZone=g;core.status.checkBlock={damage:i,type:O,repulse:F,ambush:a,needCache:A,cache:{}}},moveOneStep:function(b){core.status.hero.steps++;core.updateFollowers();core.drawHero();if(core.hasFlag("poison")){core.status.hero.statistics.poisonDamage+=core.values.poisonDamage;core.status.hero.hp-=core.values.poisonDamage;if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose();return}else{core.updateStatusBar()}}core.checkAutoEvents();var d=core.getHeroLoc("x"),e=core.getHeroLoc("y");var a=core.getBlock(d,e);var c=false;if(a!=null&&a.event.trigger=="getItem"&&!core.floors[core.status.floorId].afterGetItem[d+","+e]){c=true;core.trigger(d,e,b)}core.checkBlock();if(!c){core.trigger(d,e,b)}if(core.onSki()){core.insertAction({type:"moveAction"},null,null,null,true)}},moveDirectly:function(d,e,b){if(b==null){b=core.canMoveDirectly(d,e)}if(b>=0){if(core.hasFlag("poison")){var a=b*core.values.poisonDamage;if(a>=core.status.hero.hp){return false}core.status.hero.statistics.poisonDamage+=a;core.status.hero.hp-=a}core.clearMap("hero");var c=core.status.route[core.status.route.length-1];if(["left","right","up","down"].indexOf(c)>=0){core.setHeroLoc("direction",c)}core.setHeroLoc("x",d);core.setHeroLoc("y",e);core.drawHero();core.status.route.push("move:"+d+":"+e);core.status.hero.statistics.moveDirectly++;core.status.hero.statistics.ignoreSteps+=b;if(core.hasFlag("poison")){core.updateStatusBar()}core.checkRouteFolding();return true}return false},parallelDo:function(timestamp){if(!core.isPlaying()){return}if(core.status.floorId){try{eval(core.floors[core.status.floorId].parallelDo)}catch(e){main.log(e)}}}},ui:{getToolboxItems:function(a){return Object.keys(core.status.hero.items[a]||{}).filter(function(b){return !core.material.items[b].hideInToolbox}).sort()},drawStatusBar:function(){if(!core.flags.statusCanvas){return}var b=core.dom.statusCanvasCtx;core.clearMap(b);if(!core.domStyle.showStatusBar){return}core.setFillStyle(b,core.status.globalAttribute.statusBarColor||core.initStatus.globalAttribute.statusBarColor);var a=function(d,e,f,c){if(!/^[-a-zA-Z0-9`~!@#$%^&*()_=+\[{\]}\\|;:'",<.>\/?]*$/.test(d)){core.setFont(b,"bold 18px Verdana")}else{core.setFont(b,"italic bold 18px Verdana")}core.fillBoldText(b,d,e,f,c)};if(!core.domStyle.isVertical){core.drawImage(b,core.statusBar.icons.floor,6,9,25,25);a((core.status.thisMap||{}).name||"",42,29);core.drawImage(b,core.statusBar.icons.hp,6,43,25,25);a(core.formatBigNumber(core.getRealStatus("hp")),42,63);core.drawImage(b,core.statusBar.icons.atk,6,77,25,25);a(core.formatBigNumber(core.getRealStatus("atk")),42,97);core.drawImage(b,core.statusBar.icons.def,6,111,25,25);a(core.formatBigNumber(core.getRealStatus("def")),42,131);core.drawImage(b,core.statusBar.icons.mdef,6,145,25,25);a(core.formatBigNumber(core.getRealStatus("mdef")),42,165);core.drawImage(b,core.statusBar.icons.money,6,179,25,25);a(core.formatBigNumber(core.status.hero.money),42,199);core.drawImage(b,core.statusBar.icons.exp,6,213,25,25);a(core.formatBigNumber(core.status.hero.exp),42,233);a(core.setTwoDigits(core.itemCount("yellowKey")),11,267,"#FFCCAA");a(core.setTwoDigits(core.itemCount("blueKey")),46,267,"#AAAADD");a(core.setTwoDigits(core.itemCount("redKey")),81,267,"#FF8888")}else{core.drawImage(b,core.statusBar.icons.floor,6,6,25,25);a((core.status.thisMap||{}).name||"",42,26);core.drawImage(b,core.statusBar.icons.hp,137,6,25,25);a(core.formatBigNumber(core.getRealStatus("hp")),173,26);core.drawImage(b,core.statusBar.icons.atk,268,6,25,25);a(core.formatBigNumber(core.getRealStatus("atk")),304,26);core.drawImage(b,core.statusBar.icons.def,6,38,25,25);a(core.formatBigNumber(core.getRealStatus("def")),42,58);core.drawImage(b,core.statusBar.icons.mdef,137,38,25,25);a(core.formatBigNumber(core.getRealStatus("mdef")),173,58);core.drawImage(b,core.statusBar.icons.money,268,38,25,25);a(core.formatBigNumber(core.status.hero.money),304,58);core.drawImage(b,core.statusBar.icons.exp,6,70,25,25);a(core.formatBigNumber(core.status.hero.exp),42,90);a(core.setTwoDigits(core.itemCount("yellowKey")),142,90,"#FFCCAA");a(core.setTwoDigits(core.itemCount("blueKey")),177,90,"#AAAADD");a(core.setTwoDigits(core.itemCount("redKey")),212,90,"#FF8888")}},drawStatistics:function(){return["yellowDoor","blueDoor","redDoor","greenDoor","steelDoor","yellowKey","blueKey","redKey","greenKey","steelKey","redGem","blueGem","greenGem","yellowGem","redPotion","bluePotion","greenPotion","yellowPotion","superPotion","pickaxe","bomb","centerFly","icePickaxe","freezeBadge","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine","sword1","sword2","sword3","sword4","sword5","shield1","shield2","shield3","shield4","shield5",]},drawAbout:function(){core.ui.closePanel();core.lockControl();core.status.event.id="about";var c=48,f=36,d=core.__PIXELS__-2*c,a=core.__PIXELS__-2*f;core.setAlpha("ui",0.85);core.fillRect("ui",c,f,d,a,"#000000");core.setAlpha("ui",1);core.strokeRect("ui",c-1,f-1,d+1,a+1,"#FFFFFF",2);var e=c+24;core.setTextAlign("ui","left");var b=core.status.globalAttribute||core.initStatus.globalAttribute;core.fillText("ui","HTML5 魔塔样板",e,f+35,b.selectColor,"bold 22px "+b.font);core.fillText("ui","版本： "+main.__VERSION__,e,f+80,"#FFFFFF","bold 17px "+b.font);core.fillText("ui","作者： 艾之葵",e,f+112);core.fillText("ui","HTML5魔塔交流群：539113091",e,f+112+32);core.playSound("打开界面")}}};var events_c12a15a8_c380_4b28_8144_256cba95f760={commonEvent:{"加点事件":[{type:"comment",text:"通过传参，flag:arg1 表示当前应该的加点数值"},{type:"choices",choices:[{text:"攻击+${1*flag:arg1}",action:[{type:"setValue",name:"status:atk",value:"status:atk+1*flag:arg1"}]},{text:"防御+${2*flag:arg1}",action:[{type:"setValue",name:"status:def",value:"status:def+2*flag:arg1"}]},{text:"生命+${200*flag:arg1}",action:[{type:"setValue",name:"status:hp",value:"status:hp+200*flag:arg1"}]}]}],"毒衰咒处理":[{type:"comment",text:"获得毒衰咒效果，flag:arg1 为要获得的类型"},{type:"switch",condition:"flag:arg1",caseList:[{"case":"0",action:[{type:"comment",text:"获得毒效果"},{type:"if",condition:"!flag:poison","true":[{type:"setValue",name:"flag:poison",value:"true"}],"false":[]}]},{"case":"1",action:[{type:"comment",text:"获得衰效果"},{type:"if",condition:"!flag:weak","true":[{type:"setValue",name:"flag:weak",value:"true"}],"false":[]}]},{"case":"2",action:[{type:"comment",text:"获得咒效果"},{type:"if",condition:"!flag:curse","true":[{type:"setValue",name:"flag:curse",value:"true"}],"false":[]}]},{"case":"3",action:[{type:"comment",text:"获得咒效果"},{type:"if",condition:"!flag:dedef","true":[{type:"setValue",name:"flag:dedef",value:"true"}],"false":[]}]},{"case":"4",action:[{type:"comment",text:"获得咒效果"},{type:"if",condition:"!flag:deatk","true":[{type:"setValue",name:"flag:deatk",value:"true"}],"false":[]}]}]}],"滑冰事件":[{type:"comment",text:"公共事件：滑冰事件"},{type:"if",condition:"core.canMoveHero()","true":[{type:"comment",text:"检测下一个点是否可通行"},{type:"setValue",name:"flag:nx",value:"core.nextX()"},{type:"setValue",name:"flag:ny",value:"core.nextY()"},{type:"if",condition:"core.noPass(flag:nx, flag:ny)","true":[{type:"comment",text:"不可通行，触发下一个点的事件"},{type:"trigger",loc:["flag:nx","flag:ny"]}],"false":[{type:"comment",text:"可通行，先移动到下个点，然后检查阻激夹域，并尝试触发该点事件"},{type:"moveHero",time:80,steps:["forward"]},{type:"function","function":"function(){\ncore.checkBlock();\n}"},{type:"comment",text:"【触发事件】如果该点存在事件则会立刻结束当前事件"},{type:"trigger",loc:["flag:nx","flag:ny"]},{type:"comment",text:"如果该点不存在事件，则继续检测该点是否是滑冰点"},{type:"if",condition:"core.getBgNumber() == 167","true":[{type:"function","function":'function(){\ncore.insertAction("滑冰事件",null,null,null,true)\n}'}],"false":[]}]}],"false":[]}],"主塔金币商店":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[贪婪之神,blueShop]如果你能给我${20+flag:shop1}金币，\n我便能满足你一个要求。",choices:[{text:"体力+400",need:"status:money>=20+flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"400"},{type:"if",condition:"((flag:shop1>flag:shop1Cap)&&flag:bugFix)","true":[{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"}]}]},{text:"攻击+3",need:"status:money>=20+flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:atk",operator:"+=",value:"3"},{type:"if",condition:"((flag:shop1>flag:shop1Cap)&&flag:bugFix)","true":[{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"}]}]},{text:"防御+3",need:"status:money>=20+flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:def",operator:"+=",value:"3"},{type:"if",condition:"((flag:shop1>flag:shop1Cap)&&flag:bugFix)","true":[{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"}]}]},{text:"离开",action:[{type:"break",n:1}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"主塔经验商店":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[战斗之神,pinkShop]战士，看来你还很弱。\n但我可以将你所得的经验\n值转化为你的实质力量！",choices:[{text:"升1等级（70 exp）",need:"status:exp>=70",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"70"},{type:"setValue",name:"status:lv",operator:"+=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"250"},{type:"setValue",name:"status:atk",operator:"+=",value:"3"},{type:"setValue",name:"status:def",operator:"+=",value:"3"}]},{text:"攻击+1（20 exp）",need:"status:exp>=20",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"20"},{type:"setValue",name:"status:atk",operator:"+=",value:"1"}]},{text:"防御+2（20 exp）",need:"status:exp>=20",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"20"},{type:"setValue",name:"status:def",operator:"+=",value:"2"}]},{text:"离开",action:[{type:"break",n:1}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"魔塔金币商店":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"flag:bugFix","true":[{type:"disableShop",id:"moneyShop1"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"if",condition:"flag:bugFix","true":[{type:"choices",text:"\t[贪婪之神,blueShop]如果你能给我${20+flag:shop1}金币，\n我便能满足你一个要求。",choices:[{text:"体力+800",need:"status:money>=20+flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"800"},{type:"if",condition:"((flag:shop1>flag:shop1Cap)&&flag:bugFix)","true":[{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"}]}]},{text:"攻击+5",need:"status:money>=20+flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:atk",operator:"+=",value:"5"},{type:"if",condition:"((flag:shop1>flag:shop1Cap)&&flag:bugFix)","true":[{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"}]}]},{text:"防御+5",need:"status:money>=20+flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:def",operator:"+=",value:"5"},{type:"if",condition:"((flag:shop1>flag:shop1Cap)&&flag:bugFix)","true":[{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"}]}]},{text:"离开",action:[{type:"break",n:1}]}]}],"false":[{type:"choices",text:"\t[贪婪之神,blueShop]如果你能给我${50+2*flag:shop2}金币，\n我便能满足你一个要求。",choices:[{text:"体力+800",need:"status:money>=50+2*flag:shop2",action:[{type:"setValue",name:"status:money",operator:"-=",value:"50+2*flag:shop2"},{type:"setValue",name:"flag:shop2",operator:"+=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"800"}]},{text:"攻击+6",need:"status:money>=50+2*flag:shop2",action:[{type:"setValue",name:"status:money",operator:"-=",value:"50+2*flag:shop2"},{type:"setValue",name:"flag:shop2",operator:"+=",value:"1"},{type:"setValue",name:"status:atk",operator:"+=",value:"6"}]},{text:"防御+6",need:"status:money>=50+2*flag:shop2",action:[{type:"setValue",name:"status:money",operator:"-=",value:"50+2*flag:shop2"},{type:"setValue",name:"flag:shop2",operator:"+=",value:"1"},{type:"setValue",name:"status:def",operator:"+=",value:"6"}]},{text:"离开",action:[{type:"break",n:1}]}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"魔塔经验商店":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[战斗之神,pinkShop]战士，看来你还很弱。\n但我可以将你的所得经验\n值转化为你的实质力量！",choices:[{text:"升3等级（190 exp）",need:"status:exp>=190",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"190"},{type:"setValue",name:"status:lv",operator:"+=",value:"3"},{type:"setValue",name:"status:hp",operator:"+=",value:"600"},{type:"setValue",name:"status:atk",operator:"+=",value:"10"},{type:"setValue",name:"status:def",operator:"+=",value:"10"}]},{text:"攻击+3（40 exp）",need:"status:exp>=40",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"40"},{type:"setValue",name:"status:atk",operator:"+=",value:"3"}]},{text:"防御+5（40 exp）",need:"status:exp>=40",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"40"},{type:"setValue",name:"status:def",operator:"+=",value:"5"}]},{text:"离开",action:[{type:"break",n:1}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"钥匙商店":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[盗贼,thief]又是你吗？这次我准备了\n比上次还要多的钥匙！",choices:[{text:"黄钥匙（20金币）",need:"status:money>=20",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20"},{type:"setValue",name:"item:yellowKey",operator:"+=",value:"1"}]},{text:"蓝钥匙（80金币）",need:"status:money>=80",action:[{type:"setValue",name:"status:money",operator:"-=",value:"80"},{type:"setValue",name:"item:blueKey",operator:"+=",value:"1"}]},{text:"离开",action:[{type:"break",n:1}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"随意门商店":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[老人,man]嗨！\n需要随意门吗？看你是老\n相识，一个$30好了。",choices:[{text:"买",need:"status:money>=30",action:[{type:"setValue",name:"status:money",operator:"-=",value:"30"},{type:"setValue",name:"item:greenKey",operator:"+=",value:"1"}]},{text:"不买",action:[{type:"break",n:1}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"异国商人":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"if",condition:"flag:bugFix","true":[{type:"choices",text:"\t[异国商人,woman]战士你好，这里每件货品\n${20+flag:shop1}金币。",choices:[{text:"大回复药剂，体力+1200",need:"status:money>=20+flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"1200"},{type:"if",condition:"((flag:shop1>flag:shop1Cap)&&flag:bugFix)","true":[{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"}]}]},{text:"红水晶，攻击+6",need:"status:money>=20+flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:atk",operator:"+=",value:"6"},{type:"if",condition:"((flag:shop1>flag:shop1Cap)&&flag:bugFix)","true":[{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"}]}]},{text:"蓝水晶，防御+6",need:"status:money>=20+flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:def",operator:"+=",value:"6"},{type:"if",condition:"((flag:shop1>flag:shop1Cap)&&flag:bugFix)","true":[{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"}]}]},{text:"离开",action:[{type:"break",n:1}]}]}],"false":[{type:"choices",text:"\t[异国商人,woman]战士你好，这里每件货品\n${50+2*flag:shop2}金币。",choices:[{text:"大回复药剂，体力+1200",need:"status:money>=50+2*flag:shop2",action:[{type:"setValue",name:"status:money",operator:"-=",value:"50+2*flag:shop2"},{type:"setValue",name:"flag:shop2",operator:"+=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"1200"}]},{text:"红水晶，攻击+8",need:"status:money>=50+2*flag:shop2",action:[{type:"setValue",name:"status:money",operator:"-=",value:"50+2*flag:shop2"},{type:"setValue",name:"flag:shop2",operator:"+=",value:"1"},{type:"setValue",name:"status:atk",operator:"+=",value:"8"}]},{text:"蓝水晶，防御+8",need:"status:money>=50+2*flag:shop2",action:[{type:"setValue",name:"status:money",operator:"-=",value:"50+2*flag:shop2"},{type:"setValue",name:"flag:shop2",operator:"+=",value:"1"},{type:"setValue",name:"status:def",operator:"+=",value:"8"}]},{text:"离开",action:[{type:"break",n:1}]}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"退役战士":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[退役战士,man]我老了，不能再参加战斗了。\n但我可以引导你的经验值\n转化为你的实质力量！",choices:[{text:"升3等级（190 exp）",need:"status:exp>=190",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"190"},{type:"setValue",name:"status:lv",operator:"+=",value:"3"},{type:"setValue",name:"status:hp",operator:"+=",value:"1000"},{type:"setValue",name:"status:atk",operator:"+=",value:"12"},{type:"setValue",name:"status:def",operator:"+=",value:"12"}]},{text:"攻击+4（40 exp）",need:"status:exp>=40",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"40"},{type:"setValue",name:"status:atk",operator:"+=",value:"4"}]},{text:"防御+6（40 exp）",need:"status:exp>=40",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"40"},{type:"setValue",name:"status:def",operator:"+=",value:"6"}]},{text:"离开",action:[{type:"break",n:1}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"奸商盗贼":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[盗贼,thief]黄钥匙-$50\n蓝钥匙-$200\n来买吧！",choices:[{text:"黄钥匙",need:"status:money>=50",action:[{type:"setValue",name:"status:money",operator:"-=",value:"50"},{type:"setValue",name:"item:yellowKey",operator:"+=",value:"1"}]},{text:"蓝钥匙",need:"status:money>=200",action:[{type:"setValue",name:"status:money",operator:"-=",value:"200"},{type:"setValue",name:"item:blueKey",operator:"+=",value:"1"}]},{text:"离开",action:[{type:"break",n:1}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"回收钱币商店":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[富有老人,N409]我是来收购稀有的史莱姆\n钱币的，作为交换，我能\n回复你的体力，如何？",choices:[{text:"全部兑换",action:[{type:"setValue",name:"status:hp",operator:"+=",value:"(200*item:I398)"},{type:"setValue",name:"status:hp",operator:"+=",value:"(400*item:I400)"},{type:"setValue",name:"status:hp",operator:"+=",value:"(750*item:I403)"},{type:"setValue",name:"status:hp",operator:"+=",value:"(1000*item:I407)"},{type:"setValue",name:"item:I398",value:"0"},{type:"setValue",name:"item:I400",value:"0"},{type:"setValue",name:"item:I403",value:"0"},{type:"setValue",name:"item:I407",value:"0"}]},{text:"×${item:I398}：回复200体力",icon:"I398",need:"item:I398>=1",action:[{type:"setValue",name:"item:I398",operator:"-=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"200"}]},{text:"×${item:I400}：回复400体力",icon:"I400",need:"item:I400>=1",action:[{type:"setValue",name:"item:I400",operator:"-=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"400"}]},{text:"×${item:I403}：回复750体力",icon:"I403",need:"item:I403>=1",action:[{type:"setValue",name:"item:I403",operator:"-=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"750"}]},{text:"×${item:I407}：回复1000体力",icon:"I407",need:"item:I407>=1",action:[{type:"setValue",name:"item:I407",operator:"-=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"1000"}]},{text:"离开",action:[{type:"break",n:1}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"回收钥匙商店":[{type:"if",condition:"((core.status.hero.flags.arg1==true)&&!core.canUseItem('fly'))","true":["当前楼层不能使用黄金之羽根，无法远距离使用商店",{type:"exit"}]},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.hasFlag('poison'))","true":["中毒时无法远距离使用商店",{type:"exit"}]},{type:"setValue",name:"flag:keyDown",value:"true"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[盗贼,thief]附近被怪物袭击了，\n它们发现不到我吧？\n啊，对！你有钥匙卖给\n我吗？我需要大量的呢！",choices:[{text:"黄钥匙($10)",need:"item:yellowKey>=1",action:[{type:"setValue",name:"item:yellowKey",operator:"-=",value:"1"},{type:"setValue",name:"status:money",operator:"+=",value:"10"}]},{text:"蓝钥匙($50)",need:"item:blueKey>=1",action:[{type:"setValue",name:"item:blueKey",operator:"-=",value:"1"},{type:"setValue",name:"status:money",operator:"+=",value:"50"}]},{text:"红钥匙($200)",need:"item:redKey>=1",action:[{type:"setValue",name:"item:redKey",operator:"-=",value:"1"},{type:"setValue",name:"status:money",operator:"+=",value:"200"}]},{text:"离开",action:[{type:"break",n:1}]}]}]},{type:"setValue",name:"flag:keyDown",value:"false"},{type:"if",condition:"((core.status.hero.flags.arg1==true)&&core.canUseItem('fly'))","true":[{type:"if",condition:"core.status.maps[core.status.floorId].underGround","true":[{type:"changeFloor",floorId:":now",stair:"upFloor"}],"false":[{type:"changeFloor",floorId:":now",stair:"downFloor"}]}]}],"设置技能":[{type:"input2",text:"请输入技能：（格式见说明书）"},{type:"setValue",name:"flag:skillName",value:"core.myFormatSkill(core.getFlag('input',''))"}],"技能库管理":[{type:"setValue",name:"temp:index",value:"0"},{type:"while",condition:"1",data:[{type:"while",condition:"1",data:[{type:"setValue",name:"temp:index",operator:"+=",value:"Math.ceil((1+flags.skillHouse.length)/5)"},{type:"setValue",name:"temp:index",value:"temp:index%Math.ceil((1+flags.skillHouse.length)/5)"},{type:"choices",text:"\t[技能库（${core.getFlag('@temp@index')+1}/${Math.ceil((1+flags.skillHouse.length)/5)}）]这里是系统为你推荐技能时使用的技能库。选择下方的技能以对其修改、删除或添加：",choices:[{text:"上一页",action:[{type:"setValue",name:"temp:index",operator:"-=",value:"1"}]},{text:"${flags.skillHouse[temp:index*5] || '添加新技能'}",action:[{type:"setValue",name:"temp:index0",value:"0"},{type:"break",n:1}]},{text:"${flags.skillHouse[temp:index*5+1] || '添加新技能'}",action:[{type:"setValue",name:"temp:index0",value:"1"},{type:"break",n:1}]},{text:"${flags.skillHouse[temp:index*5+2] || '添加新技能'}",action:[{type:"setValue",name:"temp:index0",value:"2"},{type:"break",n:1}]},{text:"${flags.skillHouse[temp:index*5+3] || '添加新技能'}",action:[{type:"setValue",name:"temp:index0",value:"3"},{type:"break",n:1}]},{text:"${flags.skillHouse[temp:index*5+4] || '添加新技能'}",action:[{type:"setValue",name:"temp:index0",value:"4"},{type:"break",n:1}]},{text:"下一页",action:[{type:"setValue",name:"temp:index",operator:"+=",value:"1"}]},{text:"退出",action:[{type:"exit"}]}]}]},{type:"setValue",name:"temp:index2",value:"((temp:index*5)+temp:index0)"},{type:"function","function":"function(){\ncore.setFlag('@temp@name',flags.skillHouse[core.getFlag('@temp@index2')])\n}"},{type:"if",condition:"(temp:name!==0)","true":[{type:"choices",text:"\t[${temp:name}]对此技能：",choices:[{text:"修改",action:[{type:"input2",text:"将${temp:name}修改为？"},{type:"setValue",name:"flag:input",value:"core.myFormatSkill(core.getFlag('input',''),true)"},{type:"if",condition:"(flag:input!=='')","true":["成功将${temp:name}修改为${flags.input}",{type:"function","function":"function(){\nflags.skillHouse[core.getFlag('@temp@index2')]=flags.input\n}"}],"false":["输入有误！请尝试使用技能面板（快捷键6）"]}]},{text:"删除",action:[{type:"function","function":"function(){\nflags.skillHouse.splice(core.getFlag('@temp@index2'),1)\n}"}]},{text:"退出",action:[]}]}],"false":[{type:"input2",text:"请输入要添加的新技能，支持批量输入（用,分隔），输入clearAll清空技能库"},{type:"if",condition:"(flag:input!=='')","true":[{type:"if",condition:"(flag:input==='clearAll')","true":[{type:"setValue",name:"flag:skillHouse",value:"[]"},"成功清空技能库"],"false":[{type:"setValue",name:"flag:input0",value:"flags.input.split(',')"},{type:"setValue",name:"flag:input",value:"[]"},{type:"function","function":"function(){\nflags.input0.forEach(function (e){e=core.myFormatSkill(e,true);if (e != '') flags.input.push(e);})\n}"},{type:"if",condition:"(flags.input.length>0)","true":["成功添加${flags.input}至最前",{type:"function","function":"function(){\nflags.skillHouse=flags.input.concat(flags.skillHouse)\n}"},{type:"setValue",name:"temp:index",value:"0"}],"false":["输入有误！请尝试使用技能面板（快捷键6）"]}]}]}]}]},{type:"function","function":"function(){\ncore.clearMyCache('recomSkill')\n}"}],"高级设置":[{type:"while",condition:"1",data:[{type:"choices",text:"\t[高级设置]这些设置保存在存档中，开新档需重新设置。",choices:[{text:"自动拾取功能设置",action:[{type:"while",condition:"1",data:[{type:"choices",text:"\t[自动拾取功能设置]推荐启用本功能，减少操作量；\n若你在修复版中需要完成「大难\n不死」、「起死回生」等成就，\n请将自动拾取血瓶关闭；\n不推荐开启自动拾取能力，因为\n攻击和防御的提升可能会有负面\n效果（进入教程1了解更多）。",choices:[{text:"关闭自动拾取功能",condition:"flags.autoGetItem",action:[{type:"setValue",name:"flag:autoGetItem",value:"(!flag:autoGetItem)"},{type:"setValue",name:"flag:autoGetHp",value:"false"},{type:"setValue",name:"flag:autoGetAd",value:"false"}]},{text:"打开自动拾取功能",condition:"!flags.autoGetItem",action:[{type:"setValue",name:"flag:autoGetItem",value:"(!flag:autoGetItem)"}]},{text:"自动拾取血瓶：${flags.autoGetHp?'ON':'OFF'}",need:"flags.autoGetItem",action:[{type:"setValue",name:"flag:autoGetHp",value:"(!flag:autoGetHp)"}]},{text:"自动拾取能力：${flags.autoGetAd?'ON':'OFF'}",need:"flags.autoGetItem",action:[{type:"setValue",name:"flag:autoGetAd",value:"(!flag:autoGetAd)"}]},{text:"返回",action:[{type:"break",n:1}]}]}]}]},{text:"冲突时优先快捷键：${flags.xinHotkey?'新新':'H5'}",action:[{type:"setValue",name:"flag:xinHotkey",value:"(!flag:xinHotkey)"},{type:"function","function":"function(){\ncore.drawFg(core.status.floorId);\n}"}]},{text:"自动推荐技能战斗：${flags.autoRecomBattle?'ON':'OFF'}",action:[{type:"if",condition:"(!flag:autoRecomBattle)","true":["此功能有较大局限性，对气息利用效果不佳。\n仅推荐对新新2战斗系统不了解的玩家使用。"]},{type:"setValue",name:"flag:autoRecomBattle",value:"(!flag:autoRecomBattle)"},{type:"function","function":"function(){\ncore.clearMyCache('all')\n}"}]},{text:"地图显示推荐技能：${flags.noRecomSkill?'OFF':'ON'}",action:["此功能在出现卡顿时推荐关闭。",{type:"setValue",name:"flag:noRecomSkill",value:"(!flag:noRecomSkill)"}]},{text:"异常战斗弹出提示：${flags.noBattleHint?'OFF':'ON'}",action:[{type:"setValue",name:"flag:noBattleHint",value:"(!flag:noBattleHint)"}]},{text:"回放关闭临界推荐：${flags.replayCriRecom?'OFF':'ON'}",action:[{type:"setValue",name:"flag:replayCriRecom",value:"(!flag:replayCriRecom)"}]},{text:"攻击临界计算上限：${core.getFlag('criMax',99)}",action:[{type:"input",text:"请输入攻击临界的计算上限，默认值为99，值越大运行效率越低"},{type:"if",condition:"(flag:input>0)","true":[{type:"setValue",name:"flag:criMax",value:"flag:input"},{type:"function","function":"function(){\ncore.clearMyCache('critical')\n}"}]}]},{text:"推荐技能回合上限：${core.getFlag('recomTurnMax',10)}",action:[{type:"input",text:"请输入推荐技能的回合数上限。战斗回合数大于此值时，不会使用技能库中的技能计算推荐技能，而是启用特殊技能库（反射盾系列），默认值为10，值越大运行效率越低"},{type:"if",condition:"(flag:input>0)","true":[{type:"setValue",name:"flag:recomTurnMax",value:"flag:input"},{type:"function","function":"function(){\ncore.clearMyCache('recomSkill')\n}"}]}]},{text:"推荐技能最低气换血比例",action:[{type:"if",condition:"0","true":[{type:"input2",text:"输入计算表达式，当前为：${flags.hpManaRatio}\n(hero:勇者, lv:等级, atk:攻击, def:防御, mana:气息, manamax:气息条上限*6)"},"输入计算表达式，当前为：${flags.hpManaRatio}\n(hero:勇者, lv:等级, atk:攻击, def:防御, mana:气息, manamax:气息条上限*6)",{type:"function","function":"function(){\nvar ratio;try { ratio = core.calValue(flags.input) } catch (e) {} \tif (typeof ratio != 'number') core.insertAction([\"表达式有误！\"]);else flags.hpManaRatio=flags.input\n}"},{type:"function","function":"function(){\ncore.clearMyCache('recomSkill')\n}"}]},{type:"input",text:"请输入推荐技能最低气换血比例，必须为整数，暂时不支持表达式"},{type:"if",condition:"(flag:input>0)","true":[{type:"function","function":"function(){\nflags.hpManaRatio=flags.input;core.clearMyCache('recomSkill')\n}"}]}]},{text:"退出",action:[{type:"break",n:1}]}]}]}]}};var plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1={init:function(){console.log("插件编写测试");this._afterLoadResources=function(){};core.actions._keyDownAction=function(c){if(core.status.event.data.type=="choices"){this._keyDownChoices(c);if(flags.keyDown){var b=core.status.event.data.current;var a=b.choices;if(a.length>0){this._selectChoices(a.length,c,this._clickAction)}}return}if(core.status.event.data.type=="confirm"&&(c==37||c==39)){core.status.event.selection=1-core.status.event.selection;core.playSound("光标移动");core.drawConfirmBox(core.status.event.ui.text);return}};core.actions._keyUpAction=function(d){if(core.status.event.data.type=="text"&&(d==13||d==32||d==67)){return this._clickAction_text()}if(core.status.event.data.type=="wait"){var e=Math.max(0,core.status.event.timeout-new Date().getTime())||0;core.setFlag("type",0);core.setFlag("keycode",d);core.setFlag("timeout",e);var c=core.events.__action_wait_afterGet(core.status.event.data.current);if(c||!core.status.event.data.current.forceChild){core.status.route.push("input:"+(100000000*e+d));clearTimeout(core.status.event.interval);delete core.status.event.timeout;core.doAction()}return}if(core.status.event.data.type=="choices"){if(!flags.keyDown){var b=core.status.event.data.current;var a=b.choices;if(a.length>0){this._selectChoices(a.length,d,this._clickAction)}}return}if(core.status.event.data.type=="confirm"&&(d==13||d==32||d==67)){var e=Math.max(0,core.status.event.timeout-new Date().getTime())||0;delete core.status.event.timeout;core.setFlag("timeout",e);core.status.route.push("choices:"+(100*e+core.status.event.selection));if(core.status.event.selection==0){core.insertAction(core.status.event.ui.yes)}else{core.insertAction(core.status.event.ui.no)}core.doAction();return}};core.actions._clickEquipboxIndex=function(c){if(c<this.LAST){if(c>=core.status.globalAttribute.equipName.length){return}if(c==core.status.event.selection&&core.status.hero.equipment[c]){if(core.isReplaying()){return}return;core.unloadEquip(c);core.status.route.push("unEquip:"+c)}else{core.playSound("光标移动")}}else{var b=core.getToolboxItems("equips");if(c==core.status.event.selection){if(core.isReplaying()){return}var a=b[c-this.LAST+(core.status.event.data.page-1)*this.LAST];core.loadEquip(a);core.status.route.push("equip:"+a)}else{core.playSound("光标移动")}}core.ui._drawEquipbox(c)};core.maps._drawFg_draw=function(d,g,a,b){b.ctx=a;core.maps._drawFloorImages(d,b.ctx,"fg",null,null,b.onMap);core.maps._drawBgFgMap(d,"fg",b);if(b.onMap){core.drawImage(g,a.canvas,core.bigmap.v2?-32:0,core.bigmap.v2?-32:0)}b.ctx=g;var c=b.ctx;core.drawIcon(c,340,160,0);core.drawIcon(c,340,192,0);core.drawIcon(c,340,224,0);if(core.hasItem("I325")){core.drawIcon(c,325,150,389,24,24)}if(core.hasItem("I326")){core.drawIcon(c,326,150,389,24,24)}if(core.hasItem("I327")){core.drawIcon(c,327,150,389,24,24)}if(core.hasItem("skill1")){core.drawIcon(c,72,220,389,24,24)}if(core.hasItem("I307")){core.drawIcon(c,307,244,389,24,24)}if(core.hasItem("I309")){core.drawIcon(c,309,268,389,24,24)}core.strokeRect(c,30.5,30.5,355,355,"rgb(205,0,154)",3);var f=c.textAlign;c.textAlign="left";var e=core.floors[d].title;core.fillText(c,e.substr(0,2),168,20,"white","bold 15px Arial");core.fillText(c,e.substr(3),244-4*e.length,20,"white","bold 15px Arial");core.drawImage(c,"circle.png",268,384,180,40);core.fillText(c,!core.flags.leftHandPrefer?"-Press L-":"-Press Y-",316,410,"white","bold 20px Arial");c.textAlign=f};this.triggerAchieve=function(c){if(!flags.bugFix){return}var b=flags.achieves;if(typeof b!="object"){return}c--;b=b[c];if(typeof b!="object"){return}if(b[4]){return}else{b[4]=1;core.addFlag("achieveScore",b[3]);core.playSound("achievement.mp3");core.insertAction("\t[恭喜获得「"+b[0]+"」,N"+(454+c)+"]"+b[2]+"\n\n\r[yellow]成就点数+"+b[3]);return}};this.useSkill=function(c){var b=core.getFlag("skill",0);if(c==b){c=0}core.setFlag("skill",c);var a="";if(/[0-5]/.test(c)){a=core.getFlag("skill_"+c,"")}else{a=c}a=this.myFormatSkill(a);core.setFlag("skillName",a);core.setFlag("battleTipsFlow",0)};this.myReplaceAll=function(c,a,b){c=c.replace(a,b);if(c.indexOf(a)>=0){c=this.myReplaceAll(c,a,b)}return c};this.myFormatSkill=function(l,c,g){l=l.toUpperCase();var a=l;var m=["I315","I319","I318","I317","I316"],h=["I339","I321","I375","I322","I320"];while(a.indexOf("*")>=0){var b=a.indexOf("*"),d=b-1;if(a.charAt(d)!=")"){if(/[1-5]/.test(a.charAt(d))){d--}if(a.charAt(d-1)=="-"){d--}a=a.substr(0,d)+"("+a.substr(d,b-d)+")"+a.substr(b)}b=a.indexOf("*");d=a.substr(0,b-1).lastIndexOf("(");var o=(a.substr(b+1).match(/\d+/g)||[])[0];if(a.substr(b+1).indexOf(o)!=0){o=""}var p=a.substr(0,d);for(var e=1;e<=(o||1);e++){p+=a.substr(d+1,b-d-2)}a=p+a.substr(b+1+o.length)}if(!c){l=a}a=this.removeStopper(l,100000000);var r,q,f;f=l.indexOf("Z");if(f>=0){f=l.charAt(f+1);if(/[1-5]/.test(f)){r=f}}f=l.indexOf("X");if(f>=0){f=l.charAt(f+1);if(/[1-5]/.test(f)){q=f}}for(var b=1;b<=5;b++){if(c){a=core.myReplaceAll(a,"Z"+b,"");a=core.myReplaceAll(a,"X"+b,"")}else{if(core.getEquip(0)==m[b-1]){a=this.myReplaceAll(a,"Z"+b,"Z");l=this.myReplaceAll(l,"Z"+b,"Z")}else{if(core.hasItem("I325")&&core.canEquip(m[b-1],false)){a=this.myReplaceAll(a,"Z"+b,"Z")}else{if(core.hasItem("I326")&&b==r&&core.canEquip(m[b-1],false)){a=this.myReplaceAll(a,"Z"+b,"Z");l=this.myReplaceAll(l,"Z"+b,"Z");l=l.replace("Z","Z"+b)}else{a=this.myReplaceAll(a,"Z"+b,"Q")}}}if(core.getEquip(1)==h[b-1]){a=this.myReplaceAll(a,"X"+b,"X");l=this.myReplaceAll(l,"X"+b,"X")}else{if(core.hasItem("I327")&&core.canEquip(h[b-1],false)){a=this.myReplaceAll(a,"X"+b,"X")}else{if(core.hasItem("I326")&&b==q&&core.canEquip(h[b-1],false)){a=this.myReplaceAll(a,"X"+b,"X");l=this.myReplaceAll(l,"X"+b,"X");l=l.replace("X","X"+b)}else{a=this.myReplaceAll(a,"X"+b,"Q")}}}}}if(!c&&!(core.getEquip(0)||core.hasItem("I325")||core.hasItem("I326"))){l=this.myReplaceAll(l,"Z","")}if(!c&&!(core.getEquip(1)||core.hasItem("I327")||core.hasItem("I326"))){l=this.myReplaceAll(l,"X","")}["-C","-V","A","D","Z","X","C","V"].forEach(function(i){a=core.myReplaceAll(a,i,"")});if(a==""){if(!g){l=this.myReduceSkill(l)}return l}else{return""}};this.myReduceSkill=function(d){var e=["-C","-V"];for(var a=1;a<=5;a++){e.push("Z"+a,"X"+a)}for(var a=1;a<=d.length/2;a++){for(var b=0;b+a-1<=d.length-1;b++){var c=1;if(e.indexOf(d.substr(b-1,a+1))>-1){continue}while(d.substr(b,a)==d.substr(b+c*a,a)&&e.indexOf(d.substr(b+c*a,a+1))==-1){c++}if(c>=3||(c==2&&a>3)){if(a==1||e.indexOf(d.substr(b,a))>-1){d=d.substr(0,b)+d.substr(b,a)+"*"+c+d.substr(b+a*c)}else{d=d.substr(0,b)+"("+d.substr(b,a)+")*"+c+d.substr(b+a*c)}}}}return d};this.getSkillPerform=function(a,m,p,q,b,c){if(typeof a=="string"){a=core.material.enemys[a]}var l=[],k=core.getFlag("skillName",""),g=core.status.hero.mana,n=core.getFlag("skillHouse",[]),e=core.getDamageInfo(a,null,p,q,b),h=core.enemys.getEnemyInfo(a,hero,p,q,b).def;if(core.hasSpecial(a.special,20)||(e&&e.damage<=0)){return l}if(e&&e.turn>core.getFlag("recomTurnMax",10)&&(core.hasSpecial(a.special,57)||core.hasSpecial(a.special,65)||core.hasSpecial(a.special,66))){n=["C","CC","CX","XC","CXC"]}else{if(!e&&hero.atk>h&&(core.hasSpecial(a.special,53)||core.hasSpecial(a.special,54)||core.hasSpecial(a.special,56)||core.hasSpecial(a.special,83)||core.hasSpecial(a.special,86))){n=["-V*999"]}else{if(!e||e.turn>core.getFlag("recomTurnMax",10)){if(core.getEquip(1)=="I375"||(core.hasItem("I327")&&core.canEquip("I375",false))){n=["X3*9"]}else{n=[]}}}}if(n.length==0){return l}n=[""].concat(n);if(m>1+core.status.hero.manamax){g=core.status.hero.manamax}else{if(m>0){g=m-1}}n.forEach(function(j){if(j!=""){j=core.myFormatSkill(j);if(j==""){return}}core.setFlag("skillName",j);var i=core.getDamageInfo(a,{mana:g},p,q,b);if(i){l.push([i.skill,i.damage,i.mana,0])}});core.setFlag("skillName",k);for(var d=0;d<l.length-1;d++){for(var f=0;f<l.length-1-d;f++){if(l[f][2]<l[f+1][2]||(l[f][2]==l[f+1][2]&&l[f][1]>l[f+1][1])){var o=l[f+1];l[f+1]=l[f];l[f]=o}}}for(var d=1;d<l.length;d++){if(l[d][2]==l[d-1][2]&&l[d][1]>=l[d-1][1]){l.splice(d,1);d--}else{l[d][3]=(l[d][1]-l[d-1][1])/(l[d][2]-l[d-1][2]);if(l[d][3]<=0){l.splice(d,1);d--}else{if(!c){while(d>1){if(l[d][3]<=l[d-1][3]){break}else{l.splice(d-1,1);d--;l[d][3]=(l[d][1]-l[d-1][1])/(l[d][2]-l[d-1][2])}}}}}}for(var d=l.length-1;d>0;d--){l[d][1]=l[d-1][1]-l[d][1];l[d][2]=l[d-1][2]-l[d][2];if(l[d][3]<100){l[d][3]=l[d][3].toFixed(2)}else{l[d][3]=core.formatBigNumber(l[d][3],true)}}if(l.length){l[0][1]=null;l[0][2]=null;l[0][3]=null}return l};this.getRecomSkill=function(b,h,j,c){var g=this.getSkillPerform(b,0,h,j,c),f,d=0;if(!g||g.length==0){return null}try{f=core.calValue(flags.hpManaRatio)}catch(a){}if(typeof f!="number"){f=0}g.forEach(function(e){if(e[3]>=f){d++}});if(d>0){return{skill:((g[d])||[])[0],ratio:((g[d])||[])[3]}}else{return{skill:g[0][0],ratio:"max"}}};this.atkMana=function(a,c,d){var e=Math.round(c/a*10),b=0;if(!d&&a<=c){e=0}if(!d&&e>1){b=Math.floor(c*10/(e-0.5)+1)-a}if(d){b=Math.ceil((e+0.5)*a/10)-c}return{now:e,cri:b}};this.setKiMana=function(a){if(a.ki==null){a.ki=Math.min(5,Math.ceil((a.mana-core.getFlag("overCharge",0))/a.mmm)-1);a.charge=Math.floor(a.mana-a.ki*a.mmm);if(a.ki==5){a.charge=Math.min(a.charge,a.mmm+core.getFlag("overCharge",0))}}else{a.mana=a.ki*a.mmm+a.charge;if(a.charge==0){a.mana+=0.1}}return};this.useKi=function(a,c,b){if(a.ki>=c||b){a.ki-=c;return true}else{return false}};this.chargeKi=function(a,b){a.charge+=b;if(b<0){a.overCharge=Math.max(0,b+a.overCharge)}while(a.charge>a.mmm&&a.ki<5&&b>=0){a.charge-=a.mmm;a.ki++;a.overCharge=0}while(a.charge<0&&a.ki>0){a.charge+=a.mmm;a.ki--}if(a.charge<0){a.charge=0}if(a.ki==5&&a.charge>a.mmm){a.fmana+=a.charge-a.mmm;a.charge=a.mmm}};this.heroAtk=function(i,j){j=j||"";var c=i.h,g=i.p,f=i.m,k=f.sp;var b=c.atk-f.def,l=core.getFlag("tiredMax",20),a=flags.bugFix;var d,e=core.status.hero.lv;if(c.tired>=100){b=0}else{if(b<-core.getFlag("atkm",10)){b=0}else{if(b<1){b=1}}if(c.atk>f.def){if((j=="C"||c.tempZi==6)&&this.useKi(c,1,i.bug)){b*=2;c.tired+=2;if(core.getEquip(0)=="I319"){d=true}}else{if((j=="Z1"||c.tempZi==1)&&c.tired<l&&this.useKi(c,1)){b*=1.5;b=Math.round(b);c.tired+=10;if(b>e&&(c.def>Math.round(e*1.5))||(a&&c.def>=e)){c.def-=e;c.atk+=Math.round(e*1.5)}if(core.hasSpecial(k,2)){i.znsf=true}}else{if((j=="Z2"||c.tempZi==2)&&c.tired<l&&c.ki>0){if(a){this.useKi(c,1)}if(!a||!core.hasSpecial(k,64)){this.chargeKi(c,Math.round(f.mana/2))}f.mana=0;if(!a){this.useKi(c,1)}b*=1.3;c.tired+=4;d=true}else{if((j=="Z3"||c.tempZi==3)&&c.tired<l&&this.useKi(c,1)){b*=0.8;b=Math.round(b);c.tired+=4;if(b>=f.hp){b=f.hp-1}c.hp+=Math.floor((a?0:0.5)+b*0.3)}else{if((j=="Z4"||c.tempZi==4)&&c.tired<l&&this.useKi(c,2)){b*=1.8;c.tired+=8;f.tired+=15}else{if((j=="Z5"||c.tempZi==5)&&c.tired<l&&this.useKi(c,2)){b*=5;c.tired+=30;if(b>=f.hp){b=f.hp-1;i.znsf=true}if(c.atk>f.def){c.atk=f.def}}else{if(!a||!core.hasSpecial(k,64)){this.chargeKi(c,this.atkMana(c.atk,f.def).now)}if(j=="C"||j.substr(0,1)=="Z"){j="A"}}}}}}}b=Math.round(b)}else{if(j=="C"||j.substr(0,1)=="Z"){j="A"}}if(core.hasSpecial(k,92)){if(!f.sp2){b=Math.round(b/2);f.sp2=1}else{if(f.sp2==1){c.freeze=1;f.sp2=2}else{if(f.sp2==2){c.hp-=Math.round(b/4);f.sp2=0}}}}c.res+=(",hero:"+c.ki+"+"+c.charge);f.hp-=b;if(core.hasSpecial(k,86)){c.tired+=10}if(f.hp<0){f.hp=0}if(!d||a){f.mana+=Math.round(b/3)}if(f.mana>f.mmax){f.mana=f.mmax}}i.mdmg=b;i.skillBar+=j;if(!flags.swordUsed&&c.ki>0){i.bug=true}else{i.bug=false}c.tempZi=0;return i};this.monAtk=function(o,u){u=u||"";var d=o.h,l=o.p,j=o.m,v=j.sp,w=core.getFlag("tiredMax",20),k=core.hasSpecial(v,80),b=flags.bugFix,g=core.status.hero.lv,f,q;if(core.hasSpecial(v,93)&&j.sp2&&j.sp2<4){if(j.sp2==1&&!b){o.hdmg=j.atk-d.def;if(o.hdmg<-core.getFlag("defm",40)){o.hdmg=0}else{if(o.hdmg<1){o.hdmg=1}}}if(j.sp2==2){o.hdmg=Math.round(o.pdmg*0.8);o.pdmg=0;d.hp-=o.hdmg}else{o.pdmg=Math.round(o.hdmg*0.8);o.hdmg=0;if(core.hasItem("I325")){j.hp=Math.max(0,j.hp-Math.round(o.pdmg/2))}if(core.hasItem("I326")&&(!b||!core.hasSpecial(v,64))){this.chargeKi(d,Math.round(o.pdmg/3))}if(core.hasItem("I327")){j.tired+=5}l.hp-=o.pdmg;if(j.hp<=0){j.sp2=9}}j.sp2++;return o}if(u=="X4"&&d.tired<w&&(b||d.defBuff.length<1)&&this.useKi(d,b?1:2)){d.tired+=9;var a=Math.round(core.status.hero.def/50)+core.status.hero.hp%g;d.defBuff.push([a,3]);if(!b){a=(core.status.hero.def+core.status.hero.hp)%g}d.def+=a;f=true}var c=j.atk-d.def,n=0;if(j.tired>=100&&!k){c=0;if(j.mana>=j.mmax){j.mana=0}}else{if(c<-core.getFlag("defm",40)){c=0}else{if(c<1){c=1}}if(k){if(d.tired>=100){c=0}else{c=d.atk-d.def;if(c<-core.getFlag("atkm",10)){c=0}else{if(c<1){c=1}}var r,t=[1,1,1,1,2,2][d.Zi||0];if(!j.sp2){if(d.tired<w&&d.ki>=t){r=true}j.sp2=2}else{j.sp2--}if(r&&d.atk>d.def){this.useKi(d,t);switch(d.Zi){case 1:if(b){c*=1.5}else{c*=1.8}c=Math.round(c);d.tired+=10;if(c>g&&(d.def>Math.round(g*1.5))||(b&&d.def>=g)){d.def-=g;d.atk+=Math.round(g*1.5)}break;case 2:if(b){d.charge=Math.round(d.charge/2);c*=1.3}else{d.charge=0}d.tired+=4;break;case 3:if(b){c*=0.8;c=Math.round(c);d.tired+=4;if(c>=j.hp){c=j.hp-1}d.hp+=Math.floor(c*0.3)}else{c=100}break;case 4:if(b){c*=1.8}else{c*=1.5}d.tired+=8;d.tired+=15;break;case 5:c*=5;d.tired+=30;if(c>=d.hp){c=d.hp-1}if(d.atk>d.def){d.atk=d.def}break;default:c*=2;d.tired+=2}c=Math.round(c)}else{q=true;if(r&&!b){d.tempZi=d.Zi||6}}}}if(core.hasSpecial(v,55)){c=0;n=j.atk}if(core.hasSpecial(v,2)){c=j.atk}if(core.hasSpecial(v,63)){n=Math.max(1,j.atk-l.def)}if(core.hasSpecial(v,84)){c+=100}if(c>=1){if(j.mana>=j.mmax&&!k&&j.mmax>0){if(core.hasSpecial(v,51)){c=Math.round(c*2.5)}else{if(core.hasSpecial(v,59)){c*=4}else{c*=2}}}if(core.hasSpecial(v,93)&&(b||j.mana<j.mmax)){j.sp2=1}}if(!core.hasSpecial(v,55)){if(d.tired<w&&(b||d.defBuff.length<1)){if(u=="X1"&&this.useKi(d,1)){c/=2.5;d.tired+=3}else{if(u=="X2"&&this.useKi(d,2)){c/=1.5;d.tired+=12;if(k){if(b){d.freeze=1}}else{j.freeze=1;o.ic=true}}else{if(u=="X3"&&this.useKi(d,b?2:1)){if(k){if(c>0){if(b){d.hp-=(Math.round(c/2.6)+Math.round(d.atk/10))}else{d.hp-=Math.round(c/2.6)}}}else{if(c>0){j.hp-=(Math.round(c/2.6)+Math.round(d.atk/10))}if(j.poi){j.hp-=25}if(j.weakPt){j.atk=Math.max(0,j.atk-j.weakPt);j.def=Math.max(0,j.def-j.weakPt)}if(core.hasSpecial(v,81)){j.def=Math.max(0,j.def-12)}if(core.hasSpecial(v,89)){j.atk=Math.max(0,j.atk-20);if(b){j.def=Math.max(0,j.def-5)}}if(b){if(core.hasSpecial(v,52)){j.tired+=1}if(core.hasSpecial(v,53)){j.tired+=1}if(core.hasSpecial(v,54)){j.tired+=3}if(core.hasSpecial(v,56)){j.tired+=4}if(core.hasSpecial(v,83)){j.tired+=4}}if(j.hp<0){j.hp=0}if(j.rock){o.znsf=true}}c/=1.3;d.tired+=3}else{if(u=="X5"&&this.useKi(d,2)){d.tired+=2;l.hp+=Math.floor((b?0:0.5)+c*1.5);if(core.hasSpecial(v,2)){o.znsf=true}}else{if(u.substr(0,1)=="X"&&!f){u="D"}}}}}c=Math.ceil(c)}for(var e=0;e<d.defBuff.length;e++){d.defBuff[e][1]--;if(d.defBuff[e][1]<=0){if(b||!k){d.def-=d.defBuff[e][0]}else{d.def-=(core.status.hero.def+core.status.hero.exp)%core.status.hero.lv}d.defBuff.splice(e,1);e--}}}if(n>=1){if(j.mana>=j.mmax){if(b&&core.hasSpecial(v,67)){n*=3}else{n*=2}}if(core.hasItem("I325")){j.hp=Math.max(0,j.hp-Math.round(n/2))}if(core.hasItem("I326")&&(!b||!core.hasSpecial(v,64))){this.chargeKi(d,Math.round(n/3))}if(core.hasItem("I327")){j.tired+=5}}if(!core.hasSpecial(v,60)&&(!b||!core.hasSpecial(v,64))&&(!k||b)){this.chargeKi(d,Math.round(c/10))}if(core.hasSpecial(v,58)&&((b&&j.mana>=j.mmax&&c>0)||(!b&&c>j.atk-d.def))&&!this.useKi(d,1)){d.charge=0}if(j.mana>=j.mmax&&c+n>0&&!k&&j.mmax>0){j.mana=0;j.tired+=1}else{if(!k&&j.mmax>0){if(!core.hasSpecial(v,55)){j.mana+=this.atkMana(j.atk,d.def,1).now}if(n>=1){j.mana+=this.atkMana(j.atk,l.def,1).now}if(j.mana>j.mmax){j.mana=j.mmax}}else{if(k&&q){this.chargeKi(d,this.atkMana(d.atk,d.def).now)}}}d.hp-=c;l.hp-=n;if(core.hasSpecial(v,52)){d.tired+=1}if(core.hasSpecial(v,53)){d.tired+=1}if(core.hasSpecial(v,54)){d.tired+=3}if(core.hasSpecial(v,56)&&c>0){d.tired+=4}if(core.hasSpecial(v,83)){d.tired+=4}if(core.hasSpecial(v,57)){j.hp+=Math.round((c+n)/j.vampireRate)}if(core.hasSpecial(v,62)){j.tired=Math.max(0,j.tired-1)}if(core.hasSpecial(v,81)){if(!j.sp2){d.def=Math.max(0,d.def-12);j.sp2=2}else{j.sp2--}}if(core.hasSpecial(v,89)){if(!j.sp2){d.atk=Math.max(0,d.atk-20);d.def=Math.max(0,d.def-5);j.sp2=1}else{j.sp2--}}if(core.hasSpecial(v,82)&&(core.hasFlag("poison")||o.turn>4)){if(!j.sp2){j.atk+=10;j.def+=10;j.sp2=1}else{j.sp2--}}if(core.hasSpecial(v,88)){this.chargeKi(d,-40);j.mana=Math.min(j.mmax,j.mana+40)}if(core.hasSpecial(v,91)&&c>0){if(!j.sp2){d.tired+=8;j.sp2=1}else{if(j.sp2==1){this.chargeKi(d,-30);j.sp2=2}else{if(j.sp2==2){j.hp+=Math.round(c/5);j.sp2=0}}}}d.res+=(",mon:"+d.ki+"+"+d.charge)}o.hdmg=c;o.pdmg=n;o.skillBar+=u;if(!flags.swordUsed&&d.ki>0){o.bug=true}return o};this.deepBreath=function(b,c){var a=b.h;if(c.substr(0,2)=="-V"&&a.tired>=core.getFlag("deepBreath",5)&&a.ki>0){c=c.substr(1);b.skillBar+="-"}if(c.substr(0,1)=="V"){c=c.substr(1);if(a.tired>0&&this.useKi(a,1)){a.tired=Math.max(0,a.tired-core.getFlag("deepBreath",5))}b.skillBar+="V";this.deepBreath(b,c)}return c};this.removeStopper=function(c,e,b){var a=c.indexOf("@");b=b||[];if(a>=0&&/[1-5]/.test(c.substr(a+1))){var d=(c.substr(a+1).match(/\d+/g)||[])[0];if(c.substr(a+1).indexOf(d)!=0){return c}if(e>=d){if(a==0){b.skillBar+=c.substr(0,d.length+1)}c=this.removeStopper(c.substr(0,a)+c.substr(a+d.length+1),e,b)}}return c};core.events._openDoor_check=function(a,i,j,h){var b=function(){core.clearContinueAutomaticRoute();return false};if(a==null||a.event==null){return b()}var d=a.event.id;if(core.material.icons.animates[d]==null&&core.material.icons.npc48[d]==null){return b()}if(d=="steelDoor"){h=false}if(d=="specialDoor"&&!core.getBlock(i-1,j+1)&&!core.getBlock(i+1,j+1)){h=false}var c=core.getBlockById(d).event;if(c==null||c.doorInfo==null){return b()}c=c.doorInfo;var e=c.keys||{};if(h){for(var f in e){var g=e[f];if(f.endsWith(":o")){f=f.substring(0,f.length-2)}if(!core.material.items[f]){core.stopSound();core.playSound("操作失败");if(d=="specialDoor"){core.drawTip("机关门开启条件为：门的左下以及右下必须为空地")}else{core.drawTip("无法开启此门")}return b()}if(core.itemCount(f)<g){core.stopSound();core.playSound("操作失败");core.drawTip("你的"+((core.material.items[f]||{}).name||"钥匙")+"不足！",null,true);return false}}if(!core.status.event.id){core.autosave(true)}for(var f in e){if(!f.endsWith(":o")){core.removeItem(f,e[f])}}}core.playSound(c.openSound);return true};core.enemys.nextCriticals=function(a,e,f,g,b){if(typeof a=="string"){a=core.material.enemys[a]}e=e||1;if(this.hasSpecial(a.special,10)){return[]}var c=this.getDamageInfo(a,null,f,g,b);if(c==null||this.hasSpecial(a.special,3)){c=this.getEnemyInfo(a,null,f,g,b);if(core.status.hero.atk+core.getFlag("atkm",10)<c.def){return[[c.def-core.status.hero.atk-core.getFlag("atkm",10),"?"]]}return[]}if(typeof c=="number"||(c.damage<=0&&(1||!core.flags.enableNegativeDamage))){return[[0,0]]}if(core.flags.useLoop){var d=5000;if(core.status.hero.atk<d){return this._nextCriticals_useLoop(a,c,e,f,g,b)}else{return this._nextCriticals_useBinarySearch(a,c,e,f,g,b)}}else{return this._nextCriticals_useTurn(a,c,e,f,g,b)}};core.enemys._nextCriticals_useLoop=function(b,e,j,l,m,c){var h=e.mon_hp,d=core.status.hero.atk,g=e.mon_def,k=e.damage;var f=[];for(var a=d+1;a<=d+core.getFlag("criMax",99);a++){var i=this.getDamageInfo(b,{atk:a},l,m,c);if(i==null||(typeof i=="number")){break}if(k!=i.damage){k=i.damage;f.push([a-d,e.damage-i.damage]);if(i.damage<=0&&!core.flags.enableNegativeDamage){break}if(f.length>=j){break}}}if(f.length==0){f.push([1+core.getFlag("criMax",99),"?"])}return f};core.ui._drawBook_drawRow3=function(g,e,l,i,m,j){core.setTextAlign("ui","left");var a=this._buildFont(13,true),f=this._buildFont(13,false);var b=i,c=i+m*9/25,d=i+m*17/25;var k=core.getRecomSkill(e.id);core.fillText("ui","气息容量",b,j,"#DDDDDD",f);core.fillText("ui",core.formatBigNumber(e.value||0),b+56,j,null,a);if(k){core.fillText("ui","推荐技能",c,j,"#DDDDDD",f);core.fillText("ui",(!k)?"无法战胜此怪物":(k.skill==""?"无":k.skill)+"/"+k.ratio,c+56,j,null,a)}else{if((core.getDamageInfo(e)||[]).damage<=0){var h=core.atkMana(core.status.hero.atk,core.enemys.getEnemyInfo(e).def);if(h&&h.cri){core.fillText("ui","勇者攻增气临界",c,j,"#DDDDDD",f);core.fillText("ui",h.cri,c+95,j,null,a)}}}};core.ui._drawBook_drawDamage=function(c,b,d,e){core.setTextAlign("ui","center");var a=core.getDamageString(b);if(b.notBomb){damage+="[b]"}if(a.damage=="???"){a.damage="无法战斗"}core.fillText("ui",a.damage,d,e,a.color,this._buildFont(13,true))};core.enemys.canBattle=function(a,g,h,b){if(typeof a=="string"){a=core.material.enemys[a]}if(flags.autoRecomBattle&&!core.isReplaying()){var f=(core.getRecomSkill(a,g,h,b)||[]).skill||"";if(f!=flags.skillName){core.setFlag("skillName",f);core.status.route.splice(core.status.route.length-1,0,"key:57","input2:"+core.encodeBase64(f))}}var d=this.getDamageInfo(a,hero,g,h,b);if(d==null){return false}var e=d.pdmg||0,c=d.damage-e;return c<core.status.hero.hp&&e<core.status.hero.hpmax};core.enemys.getDamageString=function(c,j,k,d){if(typeof c=="string"){c=core.material.enemys[c]}var b;if(flags.autoRecomBattle){var g=flags.skillName;core.setFlag("skillName",(core.getRecomSkill(c,j,k,d)||[]).skill||"");b=this.getDamage(c,j,k,d);core.setFlag("skillName",g)}else{b=this.getDamage(c,j,k,d)}if(c==null){return null}if(typeof c=="string"){c=core.material.enemys[c]}var f=this.getDamageInfo(c,hero,j,k,d);var h=(f||{}).pdmg||0,e=b-h;var a="#000000";if(b==null){b="???";a="#FF2222"}else{var i=Math.max(e/core.status.hero.hp,h/core.status.hero.hpmax);if(i<=0){a="#1F1"}else{if(i<0.05){a="#9F9"}else{if(i<0.1){a="#CFC"}else{if(i<0.15){a="#FFF"}else{if(i<0.2){a="#FFC"}else{if(i<0.3){a="#FF9"}else{if(i<0.4){a="#FF0"}else{if(i<0.5){a="#FC1"}else{if(i<1){a="#F93"}else{a="#F22"}}}}}}}}}b=core.formatBigNumber(b,true);if(core.enemys.hasSpecial(c,19)){b+="+"}if(core.enemys.hasSpecial(c,21)){b+="-"}if(core.enemys.hasSpecial(c,11)){b+="^"}}return{damage:b,color:a}};core.ui._drawSLPanel_drawRecord=function(h,b,k,l,f,a,d){var c=core.status.globalAttribute||core.initStatus.globalAttribute;var g=c.selectColor;if(core.status.event.selection){g="#FF6A6A"}if(!b||!b.floorId){d=false}if(b&&b.__toReplay__){h="[R]"+h}core.fillText("ui",h,k,l,d?c.selectColor:"#FFFFFF",this._buildFont(17,true));core.strokeRect("ui",k-f/2,l+15,f,f,a?g:"#FFFFFF",a?6:2);if(b&&b.floorId){core.setTextAlign("ui","center");var e=core.maps.loadMap(b.maps,b.floorId);core.extractBlocksForUI(e,b.hero.flags);core.drawThumbnail(b.floorId,e.blocks,{heroLoc:b.hero.loc,heroIcon:b.hero.image,flags:b.hero.flags,ctx:"ui",x:k-f/2,y:l+15,size:f,centerX:b.hero.loc.x,centerY:b.hero.loc.y});if(core.isPlaying()&&core.getFlag("hard")!=b.hero.flags.hard){core.fillRect("ui",k-f/2,l+15,f,f,[0,0,0,0.4]);core.fillText("ui",b.hard,k,parseInt(l+22+f/2),b.hero.flags.__hardColor__||"red",this._buildFont(30,true))}if(b.hero.notes&&b.hero.notes.length>0){core.setTextAlign("ui","left");if(b.hero.notes.length>=2){core.fillRect("ui",k-f/2,l+15,f,28,[0,0,0,0.3]);core.fillBoldText("ui",b.hero.notes.length-1+". "+b.hero.notes[b.hero.notes.length-2].substring(0,10),k-f/2+2,l+15+12,"#FFFFFF",null,this._buildFont(10,false));core.fillBoldText("ui",b.hero.notes.length+". "+b.hero.notes[b.hero.notes.length-1].substring(0,10),k-f/2+2,l+15+24)}else{core.fillRect("ui",k-f/2,l+15,f,16,[0,0,0,0.3]);core.fillBoldText("ui",b.hero.notes.length+". "+b.hero.notes[b.hero.notes.length-1].substring(0,10),k-f/2+2,l+15+12,"#FFFFFF",null,this._buildFont(10,false))}}core.setTextAlign("ui","center");var i=core.formatBigNumber(b.hero.hp,true)+"/"+core.formatBigNumber(b.hero.atk,true)+"/"+core.formatBigNumber(b.hero.def,true);var j="/"+(b.hero.mana/b.hero.manamax*6).toFixed(2);if(core.calWidth("ui",i+j,this._buildFont(10,false))<=f){i+=j}core.fillText("ui",i,k,l+30+f,c.selectColor);core.fillText("ui",core.formatDate(new Date(b.time)),k,l+43+f,b.hero.flags.debug?"#FF6A6A":"#FFFFFF")}else{core.fillRect("ui",k-f/2,l+15,f,f,"#333333");core.fillText("ui","空",k,parseInt(l+22+f/2),"#FFFFFF",this._buildFont(30,true))}};core.control._updateDamage_damage=function(a,b){core.status.damage.data=[];if(!core.flags.displayEnemyDamage&&!core.flags.displayExtraDamage){return}core.extractBlocks(a);core.status.maps[a].blocks.forEach(function(d){var m=d.x,n=d.y;if(b&&core.bigmap.v2){if(m<core.bigmap.posX-core.bigmap.extend||m>core.bigmap.posX+core.__SIZE__+core.bigmap.extend||n<core.bigmap.posY-core.bigmap.extend||n>core.bigmap.posY+core.__SIZE__+core.bigmap.extend){return}}if(!d.disable&&d.event.cls.indexOf("enemy")==0&&d.event.displayDamage!==false){var j=core.material.enemys[d.event.id];var g=hero.atk+"@"+hero.def+"@"+hero.mdef+"@"+flags.deepBreath+"@"+flags.tiredMax+"@"+flags.sxzl;var c=j.id+"@"+core.getFlag("skillName","")+"@"+core.getEquip(0)+"@"+core.getEquip(1)+"@"+core.hasItem("I325")+"@"+core.hasItem("I326")+"@"+core.hasItem("I327")+"@"+flags.swordUsed;if(core.flags.displayCritical&&!(core.isReplaying()&&!flags.replayCriRecom)){var e=core.getFlag("@@_critical__@"+c,[null,null]);var h;if(e[1]==g&&typeof h=="object"){h=e[0]}else{h=core.enemys.nextCriticals(d.event.id,1,m,n,a);var f="#FFFFFF";if((h[0]||[])[1]<0){f="#F93"}if((h[0]||[])[0]>core.getFlag("criMax",99)){h=core.getFlag("criMax",99)+"+"}else{h=core.formatBigNumber((h[0]||[])[0],true);if(h=="???"){h="?"}}var k=core.getDamageInfo(d.event.id,null,m,n,a);if(k&&k.damage<=0){k=core.atkMana(core.status.hero.atk,core.enemys.getEnemyInfo(d.event.id,null,m,n,a).def);if(k&&k.cri){h=k.cri;f="#F93"}else{h=""}}h={cri:h,color:f};core.setFlag("@@_critical__@"+c,[h,g])}core.status.damage.data.push({text:h.cri,px:32*m+1,py:32*(n+1)-11,color:h.color})}g+="@"+hero.mana+"@"+hero.manamax;if(!flags.noRecomSkill&&!(core.isReplaying()&&!flags.replayCriRecom)){var e=core.getFlag("@@_recomSkill__@"+c,[null,null]);var l;if(e[1]==g){l=e[0]}else{l=(core.getRecomSkill(d.event.id,m,n,a)||[]).skill||"";core.setFlag("@@_recomSkill__@"+c,[l,g])}core.status.damage.data.push({text:l.length>4?l.substr(0,3)+"..":l,px:32*m+1,py:32*(n+1)-21,color:"#FFFFFF"})}g+="@"+hero.hp+"@"+hero.hpmax;if(core.flags.displayEnemyDamage){var e=core.getFlag("@@_damage__@"+c,[{},null]);var i;if(e[1]==g){i=e[0]}else{i=core.enemys.getDamageString(d.event.id,m,n,a);core.setFlag("@@_damage__@"+c,[i,g])}core.status.damage.data.push({text:i.damage,px:32*m+1,py:32*(n+1)-1,color:i.color})}}})};this.clearMyCache=function(a){Object.keys(core.status.hero.flags).forEach(function(b){if((a=="all"&&b.startsWith("@@_"))||b.startsWith("@@_"+a+"__@")){delete core.status.hero.flags[b]}})};core.ui._drawBookDetail_turnAndCriticals=function(d,f,l){var c=core.getDamageInfo(d.id,null,d.x,d.y,f);var g=(c||{}).hdmg||0,i=(c||{}).pdmg||0;if(g>0&&i>0){l.push("\r[#FF6A6A]\\d伤害分布：\\d\r[]勇者"+g+"，公主"+i)}l.push("\r[#FF6A6A]\\d战斗回合数：\\d\r[]"+((c||{}).turn||0));var b=core.enemys.nextCriticals(d.id,8,d.x,d.y,f).map(function(m){if(m[0]>core.getFlag("criMax",99)){return core.getFlag("criMax",99)+"+:???"}else{return core.formatBigNumber(m[0])+":"+core.formatBigNumber(m[1])}});while(b[0]=="0:0"){b.shift()}l.push("\r[#FF6A6A]\\d临界表：\\d\r[]"+JSON.stringify(b));var j=core.getDamageInfo(d.id,{atk:core.status.hero.atk-1},null,null,f);if(j!=null&&c!=null){if(c.damage!=null){c=c.damage}if(j.damage!=null){j=j.damage}if(j>c){l.push("（当前攻击力正位于临界点上）")}}var k=core.getSkillPerform(d.id,0,d.x,d.y,f),h=[];if(k&&k.length>0){h.push((k[0][0]==""?"无":k[0][0])+":气息max");k.splice(0,1);k.forEach(function(m){h.push(m[0]+":"+m[3]+"("+m[2]+"气换"+m[1]+"血)")});l.push("\r[#FF6A6A]\\d技能价值表：\\d\r[]"+JSON.stringify(h))}var e=core.enemys.getEnemyInfo(d.id,null,d.x,d.y,f),c=core.getDamageInfo(d.id,null,d.x,d.y,f);var a=core.atkMana(hero.atk,e.def);if(c){l.push("\r[#FF6A6A]\\d勇者攻增气：\\d\r[]"+a.now+(a.cri?"  \r[#FF6A6A]\\d临界：\\d\r[]攻击+"+a.cri:""))}a=0;if(!core.hasSpecial(d.id,55)){a+=core.atkMana(e.atk,hero.def,1).now}if(core.hasSpecial(d.id,55)||core.hasSpecial(d.id,61)||core.hasSpecial(d.id,62)||core.hasSpecial(d.id,63)||core.hasSpecial(d.id,64)||core.hasSpecial(d.id,65)){a+=core.atkMana(e.atk,hero.mdef,1).now}if(c&&c.damage>0){l.push("\r[#FF6A6A]\\d怪物攻增气：\\d\r[]"+a+"  \r[#FF6A6A]\\d防增气：\\d\r[]"+Math.max(0,Math.round((hero.atk-e.def)/3)))}};core.enemys.getCurrentEnemys=function(b){b=b||core.status.floorId;var a=[],c={};core.extractBlocks(b);core.status.maps[b].blocks.forEach(function(d){if(!d.disable&&d.event.cls.indexOf("enemy")==0){this._getCurrentEnemys_addEnemy(d.event.id,a,c,d.x,d.y,b);if(d.event.id=="darkKnight"){this._getCurrentEnemys_addEnemy("soldier",a,c,d.x,d.y,b)}if(d.event.id=="soldier"||d.event.id=="darkKnight"){this._getCurrentEnemys_addEnemy("ghostSkeleton",a,c,d.x,d.y,b)}if(d.event.id=="E384"){this._getCurrentEnemys_addEnemy("E385",a,c,d.x,d.y,b)}}},this);return this._getCurrentEnemys_sort(a)};core.maps._canMoveDirectly_checkStartPoint=function(b,c){if(core.status.checkBlock.damage[b+","+c]){return false}var a=core.getBlock(b,c);if(a!=null){return !a.event.trigger||a.event.trigger=="changeFloor"||["A376"].indexOf(a.event.id)>=0}return true};core.ui._drawSwitchs=function(){core.status.event.id="switchs";var a=["音效设置","显示设置","操作设置","高级设置[U]","返回主菜单"];this.drawChoices(null,a)};core.actions._clickSwitchs=function(d,e){var a=core.status.event.ui.choices;var c=this._getChoicesTopIndex(a.length);var b=e-c;if(d<this.CHOICES_LEFT||d>this.CHOICES_RIGHT){return}if(b>=0&&b<a.length){core.status.event.selection=b;switch(b){case 0:core.status.event.selection=0;core.playSound("确定");return core.ui._drawSwitchs_sounds();case 1:core.status.event.selection=0;core.playSound("确定");return core.ui._drawSwitchs_display();case 2:core.status.event.selection=0;core.playSound("确定");return core.ui._drawSwitchs_action();case 3:core.status.event.selection=0;core.playSound("确定");core.status.route.push("key:85");core.insertCommonEvent("高级设置");return;case 4:core.status.event.selection=0;core.playSound("取消");return core.ui._drawSettings()}}};core.actions._keyUpSL=function(c){var e=core.status.event.data.page,d=core.status.event.data.offset;var b=e*10+d;if(c==27||c==88||(core.status.event.id=="save"&&(c==83||c==219))||(core.status.event.id=="load"&&(c==68||c==221))){this._clickSL(this.LAST,this.LAST);return}if(c>=48&&c<=57){if(c==48){c=58}core.ui._drawSLPanel((c-49)*1000+1);return}if(c==13||c==32||c==67){if(d==0){core.doSL("autoSave",core.status.event.id)}else{var a=5*e+d;if(core.status.event.data.mode=="fav"){a=core.saves.favorite[a-1]}core.doSL(a,core.status.event.id)}return}if(c==69&&core.status.event.id!="save"){this._clickSL(0,this.LAST);return}if(c==46){if(d==0){core.playSound("操作失败");core.drawTip("无法删除自动存档！")}else{var a=5*e+d;if(core.status.event.data.mode=="fav"){a=core.saves.favorite[a-1]}core.removeSave(a,function(){core.ui._drawSLPanel(b,true)})}}if(c==70&&core.status.event.data.mode=="all"){this._clickSL_favorite(e,d)}}},drawLight:function(){this.drawLight=function(e,a,d,c){var b=core.getContextByName(e);if(b==null){if(typeof e=="string"){b=core.createCanvas(e,0,0,core.__PIXELS__,core.__PIXELS__,98)}else{return}}b.mozImageSmoothingEnabled=false;b.webkitImageSmoothingEnabled=false;b.msImageSmoothingEnabled=false;b.imageSmoothingEnabled=false;core.clearMap(e);if(a==null){a=0.9}b.fillStyle="rgba(0,0,0,"+a+")";b.fillRect(0,0,b.canvas.width,b.canvas.height);c=core.clamp(c,0,1);b.globalCompositeOperation="destination-out";d.forEach(function(h){var j=h[0],k=h[1],i=h[2];var f=parseInt(i*c);var g=b.createRadialGradient(j,k,f,j,k,i);g.addColorStop(0,"rgba(0,0,0,1)");g.addColorStop(1,"rgba(0,0,0,0)");b.beginPath();b.fillStyle=g;b.arc(j,k,i,0,2*Math.PI);b.fill()});b.globalCompositeOperation="source-over"}},shop:function(){this.openShop=function(c,a){var b=core.status.shops[c];if(!this.canOpenShop(c)){core.drawTip("该商店尚未开启");return false}if(!a){core.status.route.push("shop:"+c)}if(b.item){if(core.openItemShop){core.openItemShop(c)}else{core.playSound("操作失败");core.insertAction("道具商店插件不存在！请检查是否存在该插件！")}return}if(b.commonEvent){core.insertCommonEvent(b.commonEvent,b.args);return}core.insertAction(this._convertShop(b));return true};this._convertShop=function(a){return[{type:"function","function":"function() {core.setFlag('@temp@shop', true);}"},{type:"while",condition:"true",data:[{type:"if",condition:"core.isShopVisited('"+a.id+"')","true":[{type:"function","function":"function() { core.plugin._convertShop_replaceChoices('"+a.id+"', false) }"},],"false":[{type:"if",condition:a.disablePreview,"true":[{type:"playSound",name:"操作失败"},"当前无法访问该商店！",{type:"break"},],"false":[{type:"tip",text:"当前处于预览模式，不可购买"},{type:"function","function":"function() { core.plugin._convertShop_replaceChoices('"+a.id+"', true) }"},]}]}]},{type:"function","function":"function() {core.removeFlag('@temp@shop');}"}]};this._convertShop_replaceChoices=function(d,b){var c=core.status.shops[d];var a=(c.choices||[]).filter(function(f){if(f.condition==null||f.condition==""){return true}try{return core.calValue(f.condition)}catch(g){return true}}).map(function(f){var e=core.calValue(f.need);return{text:f.text,icon:f.icon,color:e&&!b?f.color:[153,153,153,1],action:e&&!b?[{type:"playSound",name:"确定"}].concat(f.action):[{type:"playSound",name:"操作失败"},{type:"tip",text:b?"预览模式下不可购买":"购买条件不足"}]}}).concat({text:"离开",action:[{type:"playSound",name:"取消"},{type:"break"}]});core.insertAction({type:"choices",text:c.text,choices:a})};this.isShopVisited=function(a){if(!core.hasFlag("__shops__")){core.setFlag("__shops__",{})}var b=core.getFlag("__shops__");if(!b[a]){b[a]={}}return b[a].visited};this.listShopIds=function(){return Object.keys(core.status.shops).filter(function(a){return core.isShopVisited(a)||!core.status.shops[a].mustEnable})};this.canOpenShop=function(a){if(this.isShopVisited(a)){return true}var b=core.status.shops[a];if(b.item||b.commonEvent||b.mustEnable){return false}return true};this.setShopVisited=function(a,c){if(!core.hasFlag("__shops__")){core.setFlag("__shops__",{})}var b=core.getFlag("__shops__");if(!b[a]){b[a]={}}if(c){b[a].visited=true}else{delete b[a].visited}};this.canUseQuickShop=function(a){if(core.status.thisMap.canUseQuickShop===false){return"当前楼层不能使用快捷商店。"}return null};core.registerAction("keyUp","shops",function(c){if(!core.status.lockControl||!core.hasFlag("@temp@shop")||core.status.event.id!="action"){return false}if(core.status.event.data.type!="choices"){return false}var b=core.status.event.data.current;var a=b.choices;var d=core.actions._getChoicesTopIndex(a.length);if(c==88||c==27){core.actions._clickAction(core.actions.HSIZE,d+a.length-1);return true}if(c==13||c==32){return true}return false},60);core.registerAction("keyDown","shops",function(c){if(!core.status.lockControl||!core.hasFlag("@temp@shop")||core.status.event.id!="action"){return false}if(core.status.event.data.type!="choices"){return false}var b=core.status.event.data.current;var a=b.choices;var d=core.actions._getChoicesTopIndex(a.length);if(c==13||c==32){core.actions._clickAction(core.actions.HSIZE,d+core.status.event.selection);return true}return false},60);core.registerAction("longClick","shops",function(f,g,c,d){if(!core.status.lockControl||!core.hasFlag("@temp@shop")||core.status.event.id!="action"){return false}if(core.status.event.data.type!="choices"){return false}var b=core.status.event.data.current;var a=b.choices;var e=core.actions._getChoicesTopIndex(a.length);if(f>=core.actions.CHOICES_LEFT&&f<=core.actions.CHOICES_RIGHT&&g>=e&&g<e+a.length){core.actions._clickAction(f,g);return true}return false},60)},removeMap:function(){this.removeMaps=function(c,f){f=f||c;var d=core.floorIds.indexOf(c),g=core.floorIds.indexOf(f);if(g<0){g=core.floorIds.length-1}flags.__visited__=flags.__visited__||{};flags.__removed__=flags.__removed__||[];flags.__disabled__=flags.__disabled__||{};flags.__leaveLoc__=flags.__leaveLoc__||{};for(var e=d;e<=g;++e){var b=core.floorIds[e];if(core.status.maps[b].deleted){continue}delete flags.__visited__[b];flags.__removed__.push(b);delete flags.__disabled__[b];delete flags.__leaveLoc__[b];(core.status.autoEvents||[]).forEach(function(h){if(h.floorId==b&&h.currentFloor){core.autoEventExecuting(h.symbol,false);core.autoEventExecuted(h.symbol,false)}});core.status.maps[b].deleted=true;core.status.maps[b].canFlyTo=false;core.status.maps[b].canFlyFrom=false;core.status.maps[b].cannotViewMap=true}};this.resumeMaps=function(c,f){f=f||c;var d=core.floorIds.indexOf(c),g=core.floorIds.indexOf(f);if(g<0){g=core.floorIds.length-1}flags.__removed__=flags.__removed__||[];for(var e=d;e<=g;++e){var b=core.floorIds[e];if(!core.status.maps[b].deleted){continue}flags.__removed__=flags.__removed__.filter(function(h){return h!=b});core.status.maps[b]=core.loadFloor(b)}};var a=function(b){var c=false;(core.floorPartitions||[]).forEach(function(d){var e=core.floorIds.indexOf(d[0]);var g=core.floorIds.indexOf(d[1]);var f=core.floorIds.indexOf(b);if(e<0||f<0){return}if(g<0){g=core.floorIds.length-1}if(f>=e&&f<=g){c=true}});return c};this.autoRemoveMaps=function(b){if(main.mode!="play"||!a(b)){return}(core.floorPartitions||[]).forEach(function(c){var d=core.floorIds.indexOf(c[0]);var f=core.floorIds.indexOf(c[1]);var e=core.floorIds.indexOf(b);if(d<0||e<0){return}if(f<0){f=core.floorIds.length-1}if(e>=d&&e<=f){core.resumeMaps(core.floorIds[d],core.floorIds[f])}else{core.removeMaps(core.floorIds[d],core.floorIds[f])}})}},fiveLayers:function(){var a=false;if(!a){return}function e(q,r){if(!q){return}var o=document.createElement("canvas");o.id=q;o.className="gameCanvas";if(main.mode!="editor"){o.style.zIndex=r||0}document.getElementById("gameDraw").appendChild(o);var p=o.getContext("2d");core.canvas[q]=p;if(core.domStyle.hdCanvas.indexOf("name")>=0){core.maps._setHDCanvasSize(p,core.__PIXELS__,core.__PIXELS__)}else{o.width=core.__PIXELS__;o.height=core.__PIXELS__}return o}var c=e("bg2",20);var h=e("fg2",63);core.bigmap.canvas=["bg2","fg2","bg","event","event2","fg","damage"];core.initStatus.bg2maps={};core.initStatus.fg2maps={};if(main.mode=="editor"){document.getElementById("mapEdit").insertBefore(c,document.getElementById("event"));document.getElementById("mapEdit").insertBefore(h,document.getElementById("ebm"));var k=4;editor.dom.bg2c=core.canvas.bg2.canvas;editor.dom.bg2Ctx=core.canvas.bg2;editor.dom.fg2c=core.canvas.fg2.canvas;editor.dom.fg2Ctx=core.canvas.fg2;editor.dom.maps.push("bg2map","fg2map");editor.dom.canvas.push("bg2","fg2");var f=function(q){var p=document.createElement("input");var o="layerMod"+k++;var r=q+"map";p.type="radio";p.name="layerMod";p.id=o;p.value=r;editor.dom[o]=p;p.onchange=function(){editor.uifunctions.setLayerMod(r)};return p};var g=function(q){var p=document.createElement("option");var o="layerMod"+k++;var r=q+"map";p.name="layerMod";p.value=r;editor.dom[o]=p;return p};if(!editor.isMobile){var i=f("bg2");var j=f("fg2");var d=document.getElementById("layerMod"),l=d.parentNode;l.insertBefore(i,d);var m=document.createTextNode("背景层2");l.insertBefore(m,d);l.appendChild(j);var n=document.createTextNode("前景层2");l.appendChild(n)}else{var i=g("bg2");var j=g("fg2");i.innerText="背景层2";j.innerText="前景层2";var l=document.getElementById("layerMod");l.insertBefore(i,l.children[1]);l.appendChild(j)}}var b=core.maps._loadFloor_doNotCopy;core.maps._loadFloor_doNotCopy=function(){return["bg2map","fg2map"].concat(b())};core.maps._drawBg_draw=function(q,r,o,p){p.ctx=o;core.maps._drawBg_drawBackground(q,p);core.maps._drawFloorImages(q,p.ctx,"bg",null,null,p.onMap);core.maps._drawBgFgMap(q,"bg",p);if(p.onMap){core.drawImage(r,o.canvas,core.bigmap.v2?-32:0,core.bigmap.v2?-32:0);core.clearMap("bg2");core.clearMap(o)}core.maps._drawBgFgMap(q,"bg2",p);if(p.onMap){core.drawImage("bg2",o.canvas,core.bigmap.v2?-32:0,core.bigmap.v2?-32:0)}p.ctx=r};core.maps._drawFg_draw=function(q,r,o,p){p.ctx=o;core.maps._drawFloorImages(q,p.ctx,"fg",null,null,p.onMap);core.maps._drawBgFgMap(q,"fg",p);if(p.onMap){core.drawImage(r,o.canvas,core.bigmap.v2?-32:0,core.bigmap.v2?-32:0);core.clearMap("fg2");core.clearMap(o)}core.maps._drawBgFgMap(q,"fg2",p);if(p.onMap){core.drawImage("fg2",o.canvas,core.bigmap.v2?-32:0,core.bigmap.v2?-32:0)}p.ctx=r};core.maps._generateMovableArray_arrays=function(o){return{bgArray:this.getBgMapArray(o),fgArray:this.getFgMapArray(o),eventArray:this.getMapArray(o),bg2Array:this._getBgFgMapArray("bg2",o),fg2Array:this._getBgFgMapArray("fg2",o)}}},itemShop:function(){var j=null;var n=0;var i=0;var h=0;var g=0;var m=0;var l=0;var e=[];var k=null;var d=[];var o="money";var p="金币";var c=core.ui._buildFont(20,false),f=core.ui._buildFont(18,false);this._drawItemShop=function(){core.ui._createUIEvent();core.clearMap("uievent");core.ui.clearUIEventSelector();core.setTextAlign("uievent","left");core.setTextBaseline("uievent","top");core.fillRect("uievent",0,0,416,416,"black");core.drawWindowSkin("winskin.png","uievent",0,0,416,56);core.drawWindowSkin("winskin.png","uievent",0,56,312,56);core.drawWindowSkin("winskin.png","uievent",0,112,312,304);core.drawWindowSkin("winskin.png","uievent",312,56,104,56);core.drawWindowSkin("winskin.png","uievent",312,112,104,304);core.setFillStyle("uievent","white");core.setStrokeStyle("uievent","white");core.fillText("uievent","购买",32,74,"white",c);core.fillText("uievent","卖出",132,74);core.fillText("uievent","离开",232,74);core.fillText("uievent","当前"+p,324,66,null,f);core.setTextAlign("uievent","right");core.fillText("uievent",core.formatBigNumber(core.status.hero[o]),405,89);core.setTextAlign("uievent","left");core.ui.drawUIEventSelector(1,"winskin.png",22+100*n,66,60,33);if(i!=null){core.setTextAlign("uievent","center");core.fillText("uievent",n==0?"买入个数":"卖出个数",364,320,null,c);core.fillText("uievent","<   "+h+"   >",364,350);core.fillText("uievent","确定",364,380)}e=d.filter(function(C){if(C.condition!=null&&C.condition!=""){try{if(!core.calValue(C.condition)){return false}}catch(B){}}return(n==0&&C.money!=null)||(n==1&&C.sell!=null)});var y=6;m=Math.ceil(e.length/y);g=Math.floor((i||0)/y)+1;if(m>1){var u=156;core.setTextAlign("uievent","center");core.fillText("uievent",g+" / "+m,u,388,null,f);if(g>1){core.fillText("uievent","上一页",u-80,388)}if(g<m){core.fillText("uievent","下一页",u+80,388)}}core.setTextAlign("uievent","left");var z=(g-1)*y;for(var w=0;w<y;++w){var r=z+w;if(r>=e.length){break}var x=e[r];core.drawIcon("uievent",x.id,10,125+w*40);core.setTextAlign("uievent","left");core.fillText("uievent",core.material.items[x.id].name,50,132+w*40,null,c);core.setTextAlign("uievent","right");core.fillText("uievent",(n==0?core.calValue(x.money):core.calValue(x.sell))+p+"/个",300,133+w*40,null,f);core.setTextAlign("uievent","left");if(r==i){var A=core.material.items[x.id].text||"该道具暂无描述";try{A=core.replaceText(A)}catch(s){}for(var t=20;t>=8;t-=2){var q={left:10,fontSize:t,maxWidth:403};var v=core.getTextContentHeight(A,q);if(v<=50){q.top=(56-v)/2;core.drawTextContent("uievent",A,q);break}}core.ui.drawUIEventSelector(2,"winskin.png",8,120+w*40,295,40);if(n==0&&x.number!=null){core.fillText("uievent","存货",324,132,null,c);core.setTextAlign("uievent","right");core.fillText("uievent",x.number,406,132,null,null,40)}else{if(n==1){core.fillText("uievent","数量",324,132,null,c);core.setTextAlign("uievent","right");core.fillText("uievent",core.itemCount(x.id),406,132,null,null,40)}}core.setTextAlign("uievent","left");core.fillText("uievent","预计"+p,324,250);core.setTextAlign("uievent","right");l=h*(n==0?core.calValue(x.money):core.calValue(x.sell));core.fillText("uievent",core.formatBigNumber(l),405,280);core.setTextAlign("uievent","left");core.fillText("uievent",n==0?"已购次数":"已卖次数",324,170);core.setTextAlign("uievent","right");core.fillText("uievent",(n==0?x.money_count:x.sell_count)||0,405,200)}}core.setTextAlign("uievent","left");core.setTextBaseline("uievent","alphabetic")};var a=function(r,q){if(r==null){return}h=core.clamp(h+q,0,Math.min(n==0?Math.floor(core.status.hero[o]/core.calValue(r.money)):core.itemCount(r.id),n==0&&r.number!=null?r.number:Number.MAX_SAFE_INTEGER))};var b=function(q){if(q==null||h==0){return}if(n==0){core.status.hero[o]-=l;core.getItem(q.id,h);core.stopSound();core.playSound("确定");if(q.number!=null){q.number-=h}q.money_count=(q.money_count||0)+h}else{core.status.hero[o]+=l;core.removeItem(q.id,h);core.playSound("确定");core.drawTip("成功卖出"+h+"个"+core.material.items[q.id].name,q.id);if(q.number!=null){q.number+=h}q.sell_count=(q.sell_count||0)+h}h=0};this._performItemShopKeyBoard=function(r){var q=e[i]||null;switch(r){case 38:if(i==null){break}if(i==0){i=null}else{i--}h=0;break;case 37:if(i==null){if(n>0){n--}break}a(q,-1);break;case 39:if(i==null){if(n<2){n++}break}a(q,1);break;case 40:if(i==null){if(e.length>0){i=0}break}if(e.length==0){break}i=Math.min(i+1,e.length-1);h=0;break;case 13:case 32:if(i==null){if(n==2){core.insertAction({type:"break"})}else{if(e.length>0){i=0}}break}b(q);break;case 27:if(i==null){core.insertAction({type:"break"});break}i=null;break}};this._performItemShopClick=function(t,u){var r=e[i]||null;if(t>=22&&t<=82&&u>=71&&u<=102){if(n!=0){n=0;i=null;h=0}return}if(t>=122&&t<=182&&u>=71&&u<=102){if(n!=1){n=1;i=null;h=0}return}if(t>=222&&t<=282&&u>=71&&u<=102){return core.insertAction({type:"break"})}if(t>=318&&t<=341&&u>=348&&u<=376){return a(r,-1)}if(t>=388&&t<=416&&u>=348&&u<=376){return a(r,1)}if(t>=341&&t<=387&&u>=380&&u<=407){return b(r)}if(t>=45&&t<=105&&u>=388){if(g>1){i-=6;h=0}return}if(t>=208&&t<=268&&u>=388){if(g<m){i=Math.min(i+6,e.length-1);h=0}return}if(t>=9&&t<=300&&u>=120&&u<360){if(e.length==0){return}var q=parseInt((u-120)/40);var s=6*(g-1)+q;if(s>=e.length){s=e.length-1}if(s!=i){i=s;h=0}return}};this._performItemShopAction=function(){if(flags.type==0){return this._performItemShopKeyBoard(flags.keycode)}else{return this._performItemShopClick(flags.px,flags.py)}};this.openItemShop=function(q){j=q;n=0;g=0;i=null;h=0;core.isShopVisited(q);k=flags.__shops__[j];if(k.choices==null){k.choices=core.clone(core.status.shops[j].choices)}d=k.choices;o=core.status.shops[j].use;if(o!="exp"){o="money"}p=o=="money"?"金币":"经验";core.insertAction([{type:"while",condition:"true",data:[{type:"function","function":"function () { core.plugin._drawItemShop(); }"},{type:"wait"},{type:"function","function":"function() { core.plugin._performItemShopAction(); }"}]},{type:"function","function":"function () { core.deleteCanvas('uievent'); core.ui.clearUIEventSelector(); }"}])}},enemyLevel:function(){var a=false;if(!a){return}var b={"萌新一阶":"red","萌新二阶":"#FF0000","萌新三阶":[255,0,0,1],};var c=core.ui._drawBook_drawName;core.ui._drawBook_drawName=function(e,d,j,f,l){if(!d.level){return c.call(core.ui,e,d,j,f,l)}core.setTextAlign("ui","center");if(d.specialText.length==0){core.fillText("ui",d.name,f+l/2,j+27,"#DDDDDD",this._buildFont(17,true));core.fillText("ui",d.level,f+l/2,j+51,core.arrayToRGBA(b[d.level]||"#DDDDDD"),this._buildFont(14,true))}else{core.fillText("ui",d.name,f+l/2,j+20,"#DDDDDD",this._buildFont(17,true),l);switch(d.specialText.length){case 1:core.fillText("ui",d.specialText[0],f+l/2,j+38,core.arrayToRGBA((d.specialColor||[])[0]||"#FF6A6A"),this._buildFont(14,true),l);break;case 2:var i=d.specialText[0]+"  "+d.specialText[1];core.setFontForMaxWidth("ui",i,l,this._buildFont(14,true));var k=core.calWidth("ui",i);var g=core.calWidth("ui",d.specialText[0]);var h=core.calWidth("ui",d.specialText[1]);core.fillText("ui",d.specialText[0],f+(l+g-k)/2,j+38,core.arrayToRGBA((d.specialColor||[])[0]||"#FF6A6A"));core.fillText("ui",d.specialText[1],f+(l+k-h)/2,j+38,core.arrayToRGBA((d.specialColor||[])[1]||"#FF6A6A"));break;default:core.fillText("ui","多属性...",f+l/2,j+38,"#FF6A6A",this._buildFont(14,true),l)}core.fillText("ui",d.level,f+l/2,j+56,core.arrayToRGBA(b[d.level]||"#DDDDDD"),this._buildFont(14,true))}};core.ui._drawBook_drawRow1=function(j,h,m,k,n,l){core.setTextAlign("ui","left");var d=this._buildFont(13,true),i=this._buildFont(13,false);var e=k,f=k+n*9/25,g=k+n*17/25;core.fillText("ui","生命",e,l,"#DDDDDD",i);core.fillText("ui",core.formatBigNumber(h.hp||0),e+30,l,null,d);core.fillText("ui","攻击",f,l,null,i);core.fillText("ui",core.formatBigNumber(h.atk||0),f+30,l,null,d);core.fillText("ui","防御",g,l,null,i);core.fillText("ui",core.formatBigNumber(h.def||0),g+30,l,null,d)}},dynamicHp:function(){var a=false;if(!a){return}var e=0.05;var c=null;var d=null;var b=function(){if(d!=core.status.hero){d=core.status.hero;c=core.status.hero.hp}};core.registerAnimationFrame("dynamicHp",true,function(){b();if(core.status.hero.hp!=c){var f=(c-core.status.hero.hp)*e;if(Math.abs(f)<2){c=core.status.hero.hp}else{c-=f}core.setStatusBarInnerHTML("hp",c)}})},multiHeros:function(){var a=false;if(!a){return}var c={floorId:"MT0",image:"brave.png",name:"1号角色",lv:1,hp:10000,atk:1000,def:1000,mdef:0,loc:{x:0,y:0,direction:"up"},items:{tools:{},equips:{},},equipment:[],};var d=2;this.initHeros=function(){core.setFlag("hero1",core.clone(c));if(c.equipment){if(!c.items||!c.items.equips){alert("多角色插件的equipment和道具中的equips必须拥有相同状态！")}var e=core.getFlag("saveEquips",[]);e[99]=[];core.setFlag("saveEquips",e)}else{if(c.items&&c.items.equips){alert("多角色插件的equipment和道具中的equips必须拥有相同状态！")}}};var b=core.events._startGame_setHard;core.events._startGame_setHard=function(){b.call(core.events);core.initHeros()};this.changeHero=function(l){var g=core.getFlag("heroId",0);if(l==null){l=(g+1)%d}if(g==l){return}var j=Object.keys(c);var n={};var e=core.ui.drawTip;core.ui.drawTip=function(){};var f=core.control.playSound;core.control.playSound=function(){};core.clearRouteFolding();var i=core.status.route.length;if(c.equipment){core.items.quickSaveEquip(100+g);core.items.quickLoadEquip(99)}j.forEach(function(o){if(o=="floorId"){n[o]=core.status.floorId}else{if(o=="items"){n.items=core.clone(core.status.hero.items);Object.keys(n.items).forEach(function(p){if(!c.items[p]){delete n.items[p]}})}else{n[o]=core.clone(core.status.hero[o])}}});core.setFlag("hero"+g,n);var h=core.getFlag("hero"+l);j.forEach(function(o){if(o=="floorId"){}else{if(o=="items"){Object.keys(core.status.hero.items).forEach(function(p){if(h.items[p]){core.status.hero.items[p]=core.clone(h.items[p])}})}else{core.status.hero[o]=core.clone(h[o])}}});if(c.equipment){core.items.quickLoadEquip(100+l)}core.ui.drawTip=e;core.control.playSound=f;core.status.route=core.status.route.slice(0,i);var k=h.floorId||core.status.floorId;var m=h.loc||core.status.hero.loc;core.insertAction([{type:"setHeroIcon",name:h.image||"hero.png"},k!=core.status.floorId?{type:"changeFloor",floorId:k,loc:[m.x,m.y],direction:m.direction,time:0}:{type:"changePos",loc:[m.x,m.y],direction:m.direction}]);core.setFlag("heroId",l)}},itemCategory:function(){var a=false;if(!a){return}var h=["宝物类","辅助类","技能类","剧情道具","增益道具",];var i=null;var e=core.ui._drawToolbox;core.ui._drawToolbox=function(k){e.call(this,k);core.setTextAlign("ui","left");core.fillText("ui","类别[E]："+(i||"全部"),15,this.PIXEL-13)};core.ui.getToolboxItems=function(k){return Object.keys(core.status.hero.items[k]).filter(function(l){return !core.material.items[l].hideInToolbox&&(i==null||core.material.items[l].category==i)}).sort()};var b=core.actions._clickToolbox;core.actions._clickToolbox=function(k,l){if(k>=0&&k<=this.HSIZE-4&&l==this.LAST){j();return}return b.call(core.actions,k,l)};var f=core.actions._keyUpToolbox;core.actions._keyUpToolbox=function(k){if(k==69){j();return}return f.call(core.actions,k)};var d=core.ui.closePanel;core.ui.closePanel=function(){i=null;d.call(core.ui)};var j=function(){if(core.status.event.id!="toolbox"){return}var k=h.indexOf(i)+1;core.ui.closePanel();core.status.event.id="toolbox-category";core.status.event.selection=k;core.lockControl();core.drawChoices("请选择道具类别",["全部"].concat(h))};var g=function(k){core.ui.closePanel();if(k<=0||k>h.length){i=null}else{i=h[k-1]}core.openToolbox()};var c=function(m,n){if(!core.status.lockControl||core.status.event.id!="toolbox-category"){return false}if(m<core.actions.CHOICES_LEFT||m>core.actions.CHOICES_RIGHT){return false}var k=core.status.event.ui.choices;var l=core.actions._getChoicesTopIndex(k.length);if(n>=l&&n<l+k.length){g(n-l)}return true};core.registerAction("onclick","toolbox-category",c,100);core.registerAction("onmove","toolbox-category",function(k,l){if(!core.status.lockControl||core.status.event.id!="toolbox-category"){return false}core.actions._onMoveChoices(k,l);return true},100);core.registerAction("keyDown","toolbox-category",function(k){if(!core.status.lockControl||core.status.event.id!="toolbox-category"){return false}core.actions._keyDownChoices(k);return true},100);core.registerAction("keyUp","toolbox-category",function(k){if(!core.status.lockControl||core.status.event.id!="toolbox-category"){return false}core.actions._selectChoices(core.status.event.ui.choices.length,k,c);return true},100)},heroFourFrames:function(){var a=true;if(!a){return}["up","down","left","right"].forEach(function(c){core.material.icons.hero[c].midFoot=2});var b=function(c){if(core.status.heroMoving<=0){return}if(c-core.animateFrame.moveTime>core.values.moveSpeed){core.animateFrame.leftLeg++;core.animateFrame.moveTime=c}core.drawHero(["stop","leftFoot","midFoot","rightFoot"][core.animateFrame.leftLeg%4],4*core.status.heroMoving)};core.registerAnimationFrame("heroMoving",true,b);core.events._eventMoveHero_moving=function(h,f){var c=f[0];var d=c[0],i=core.getHeroLoc("x"),j=core.getHeroLoc("y");var g=d=="backward"?-1:1;if(d=="forward"||d=="backward"){d=core.getHeroLoc("direction")}var e=d;if(d=="leftup"||d=="leftdown"){e="left"}if(d=="rightup"||d=="rightdown"){e="right"}core.setHeroLoc("direction",d);if(c[1]<=0){core.setHeroLoc("direction",e);f.shift();return true}if(h<=4){core.drawHero("stop",4*g*h)}else{if(h<=8){core.drawHero("leftFoot",4*g*h)}else{if(h<=12){core.drawHero("midFoot",4*g*(h-8))}else{if(h<=16){core.drawHero("rightFoot",4*g*(h-8))}}}}if(h==8||h==16){core.setHeroLoc("x",i+g*core.utils.scan2[d].x,true);core.setHeroLoc("y",j+g*core.utils.scan2[d].y,true);core.updateFollowers();c[1]--;if(c[1]<=0){f.shift()}core.setHeroLoc("direction",e);return h==16}return false}},startCanvas:function(){var a=false;if(!a){return}if(!core.flags.startUsingCanvas||main.mode!="play"){return}var c=false;var b=core.actions._getClickLoc;this._setTitleCanvas=function(){if(c){return}c=true;window.onresize=function(){};core.resize=function(){};core.dom.statusBar.style.display="none";core.dom.statusCanvas.style.display="none";core.dom.toolBar.style.display="none";if(core.domStyle.isVertical){core.dom.gameDraw.style.top=(parseInt(core.dom.gameGroup.style.height)-parseInt(core.dom.gameDraw.style.height))/2+"px"}else{core.dom.gameDraw.style.right=(parseInt(core.dom.gameGroup.style.width)-parseInt(core.dom.gameDraw.style.width))/2+"px"}core.dom.gameDraw.style.border="3px transparent solid";core.actions._getClickLoc=function(h,i){var e=core.dom.gameGroup.offsetLeft+core.dom.gameDraw.offsetLeft+3;var g=core.dom.gameGroup.offsetTop+core.dom.gameDraw.offsetTop+3;var f={x:Math.max(h-e,0),y:Math.max(i-g,0),size:32*core.domStyle.scale};return f}};this._resetTitleCanvas=function(){if(!c){return}c=false;window.onresize=function(){try{main.core.resize()}catch(f){main.log(f)}};core.resize=function(){return core.control.resize()};core.resize();core.actions._getClickLoc=b};core.events._startGame_start=function(f,h,g,e){console.log("开始游戏");core.resetGame(core.firstData.hero,f,null,core.cloneArray(core.initStatus.maps));core.setHeroLoc("x",-1);core.setHeroLoc("y",-1);if(h!=null){core.setFlag("__seed__",h);core.setFlag("__rand__",h)}else{core.utils.__init_seed()}core.clearStatusBar();core.plugin._setTitleCanvas();var i=[];core.hideStatusBar();core.push(i,core.firstData.startCanvas);core.push(i,{type:"function","function":"function() { core.plugin._resetTitleCanvas(); core.events._startGame_setHard(); }"});core.push(i,core.firstData.startText);this.insertAction(i,null,null,function(){core.events._startGame_afterStart(e)});if(g!=null){core.startReplay(g)}};var d=core.control.loadData;core.control.loadData=function(f,e){core.plugin._resetTitleCanvas();d.call(core.control,f,e)}},"战斗UI":function(){if(true){return}console.log("插件编写测试");this._afterLoadResources=function(){};core.plugin.battleInfo={width:core.__PIXELS__-16,height:128,left:8,top:96,color:"#CD009A"};core.control.unLockControl=function(){if(!((core.status.hero||{}).isBattling||(core.status.hero||{}).battleStatus=="afterBattle")){core.status.lockControl=false}};core.registerAction("onkeyUp","_battle_onkeyUp_lockControl",function(a){var c=a.keyCode;if(c==13&&(core.status.hero||{}).battleStatus=="afterBattle"){core.status.hero.battleStatus="end";return true}else{if((core.status.hero||{}).isBattling&&!(core.status.hero||{}).battleStatus){if(c==81){var b=core.status.hero.battle_enemy;core.insertAction({type:"break"});core.battle_exit();return true}if(c==80){if(flags.battleSpeed!=9){flags.battleSpeed=9}else{flags.battleSpeed=30}return true}}}},51);core.registerAction("onclick","_battle_onclick_lockControl",function(b,c){if((core.status.hero||{}).battleStatus=="afterBattle"){core.status.hero.battleStatus="end"}else{if((core.status.hero||{}).isBattling){if(b>=10&&b<=12&&c==6){var a=core.status.hero.battle_enemy;core.insertAction({type:"break"});core.battle_exit()}if(b>=5&&b<=7&&c==6){if(flags.battleSpeed!=9){flags.battleSpeed=9}else{flags.battleSpeed=30}}}}},51);this.updateFg=function(){};this.battle_drawUI=function(){var z=core.plugin.battleInfo;var J=z.width,w=z.height,C=z.left,I=z.top;var n=core.getContextByName("__battle__")||core.createCanvas("__battle__",C,I,J,w,66);core.setAlpha(n,1);n.canvas.style.backgroundColor="gray";n.canvas.style.backgroundImage="url(project/images/ground.png)";n.canvas.style.fontFamily="myFont1";var D=3,H=z.color;core.plugin.battleInfo.lineWidth=D;core.strokeRect(n,D/2,D/2,J-D,w-D,H,D);var t=18;var A=false;var B=false;var E="white";var k=42,m=20+t*3/4,F=28;core.plugin.battleInfo.bx=k;core.plugin.battleInfo.by=m;core.plugin.battleInfo.size=F;var l=J-k-F;var x=core.material.images.hero;var v=core.material.icons.hero.width||32,u=core.material.icons.hero.height;var G=core.values.animateSpeed;var y=false;core.drawImage(n,x,0,0,v,u,l,m,F,F);core.strokeRect(n,l,m,F,F,H,2);var o=core.status.hero.battle_enemy||{};var q="敌人";q=core.material.enemys[o.id].name;var s=(B?"italic ":"")+(A?"bold ":"")+t+"px myFont1";core.setTextAlign(n,"center");core.fillText(n,q,k+F/2,m-t*1/2,E,s);core.fillText(n,"勇者",l+F/2,m-t*1/2,E,s);core.fillText(n,"VS",n.canvas.width/2-210,m-t*1/4,"white","italic bold 32px myFont1");core.setTextAlign(n,"left");if(y){var d=4,b=4;if(!(core.isReplaying()||main.replayChecking)){var j=window.setInterval(function(){core.clearMap(n,l-2,m-2,F+4,F+4);if(!core.status.hero.isBattling){clearInterval(j)}core.drawImage(n,x,(b-1)*v,0,v,u,l,m,32,u);core.strokeRect(n,l,m,F,F,H,2);b+=2;if(b>d){b=2}},G)}}var h=core.getBlockInfo(o.id||"greenSlime");var g=32,e=h.height;var d=h.animate,c=1;var r="enemys";if(e==48){r="enemy48"}var f=h.posY;var p=core.material.images[r];core.drawImage(n,p,(c-1)*g,f*e,g,e,k,m,F,F);core.strokeRect(n,k,m,F,F,H,2);c++;if(!(core.isReplaying()||main.replayChecking)){var i=window.setInterval(function(){core.clearMap(n,k-2,m-2,F+4,F+4);if(!core.status.hero.isBattling){clearInterval(i)}core.drawImage(n,p,(c-1)*g,f*e,g,e,k,m,F,F);core.strokeRect(n,k,m,F,F,H,2);c++;if(c>d){c=1}},G)}core.battle_battling_draw(null,o)};this.battle_battling_draw=function(l,j){if(typeof j=="string"){j=core.material.enemys[j]}if(!l){l=core.status.hero}var h=core.getContextByName("__battle__");if(main.replayChecking){if(core.status.hero.hp>0&&core.status.hero.battle_enemy.hp<=0){core.insertAction({type:"break"});var b=function(){var w=core.status.hero.hp-core.status.battle_heroHp;core.status.hero.statistics.battleDamage+=w;core.material.enemys.__testMonster__=core.clone(j);var K=core.material.enemys.__testMonster__;if(core.hasSpecial(K,13)){if(!core.status.hero.battle_triggerWeak||flags.poison){if(K.special instanceof Array){K.special.splice(K.special.indexOf(13),1)}else{K.special=null}}}if(core.hasSpecial(K,12)){if(!core.status.hero.battle_triggerPoison||flags.weak){if(K.special instanceof Array){K.special.splice(K.special.indexOf(12),1)}else{K.special=null}}}var J="__testMonster__";var L=flags.__loc__[0];var M=flags.__loc__[1];core.afterBattle(J,L,M,flags.__callback__)};if(core.isReplaying()){var j=core.status.hero.battle_enemy;if(j==null){return}b();return core.battle_exit()}}}if(!h){return}core.setAlpha(h,1);var n=core.plugin.battleInfo;var H=n.width,k=n.height,q=n.left,D=n.top,c=n.bx,e=n.by,u=n.size,s=n.lineWidth;core.setTextAlign(h,"left");var d=H-c-u;h.clearRect(c+u+2,e-4,d-(c+u+2)-1,k-e);var B=14;var o=true;var p=false;var A=(p?"italic ":"")+(o?"bold ":"")+B+"px myFont1";var C={hp:"体力",atk:"攻击力",def:"防御力",tired:"疲劳"};var r=10;var y="";var t=0;var E=c+u+8,F=e+B*3/4;for(var x in C){core.fillText(h,C[x]+": "+(j[x]||0),E,F+t,"white",A);t+=B+r}t=0;core.setTextAlign(h,"right");for(var x in C){core.fillText(h,(core.getRealStatusOrDefault(l,x)||0)+" :"+C[x],H-E,F+t,"white",A);t+=B+r}t-=B+r;core.setTextAlign(h,"center");var z=flags.battleSpeed==9?"[减 速(p)]":"[加 速(p)]";core.fillText(h,z,H/2,F+t,"white","16px myFont1");core.setTextAlign(h,"left");var d=H-c-u;var m=(core.status.hero.battle_enemy||{}).hp==null?1:(core.status.hero.battle_enemy||{}).hp;if(core.status.hero.hp<=0){core.playSound("gameover.mp3");return core.lose("战斗失败")}if(!core.status.hero.isBattling&&m>0){core.fillText(h,"撤 退(Q)",d,F+t,"yellow","italic bold 16px myFont1")}else{if(core.status.hero.hp>0&&core.status.hero.battle_enemy.hp<=0){var G=core.calWidth(h,"撤 退(Q)","italic bold 16px myFont1");core.clearMap(h,d-1,F+t-16,G+3,20);core.fillText(h,"-Enter-",d,F+t,"white","16px verdana");core.insertAction({type:"break"});var b=function(){var w=core.status.hero.hp-core.status.battle_heroHp;core.status.hero.statistics.battleDamage+=w;core.material.enemys.__testMonster__=core.clone(j);var K=core.material.enemys.__testMonster__;if(core.hasSpecial(K,13)){if(!core.status.hero.battle_triggerWeak||flags.poison){if(K.special instanceof Array){K.special.splice(K.special.indexOf(13),1)}else{K.special=null}}}if(core.hasSpecial(K,12)){if(!core.status.hero.battle_triggerPoison||flags.weak){if(K.special instanceof Array){K.special.splice(K.special.indexOf(12),1)}else{K.special=null}}}var J="__testMonster__";var L=flags.__loc__[0];var M=flags.__loc__[1];core.afterBattle(J,L,M,flags.__callback__)};if(core.isReplaying()){var j=core.status.hero.battle_enemy;if(j==null){return}b();return core.battle_exit()}core.status.hero.battleStatus="afterBattle";var g=0;var f=h.canvas;var i=h.getImageData(0,0,f.width,f.height);core.lockControl();core.playSound("slide.mp3");if(!(core.isReplaying()||main.replayChecking)){var I=setInterval(function(){g+=4;core.resizeCanvas("__battle__",H,k+g);h.putImageData(i,0,0);if(g>32){clearInterval(I)}core.fillText(h,"胜利!!",10,k+23+s/2,"white","bold 28px myFont1");core.fillText(h,"经 验 值："+j.exp,105,k+20+s/2,"white","bold 17px myFont1");core.fillText(h,"金 币："+j.money,255,k+20+s/2,"white","bold 17px myFont1");core.drawLine(h,s/2,k+g,H-s/2,k+g,n.color,s);core.drawLine(h,s/2,k,s/2,k+g,n.color,s);core.drawLine(h,H-s/2,k,H-s/2,k+g,n.color,s)},50)}var a=1;if(!(core.isReplaying()||main.replayChecking)){var v=setInterval(function(){core.setAlpha(h,a);a-=0.5;if(a<=0){a=1}var J=core.calWidth(h,"-Enter-","16px verdana");core.clearMap(h,d-1,F+t-14,J+3,16);if(core.status.hero.battleStatus=="end"){clearInterval(v);clearInterval(I);core.battle_exit()}core.fillText(h,"-Enter-",d,F+t,"white","16px verdana");core.setAlpha(h,1)},400)}}}};this.battle_enemyInfo=function(f,e){if(!f){f=core.status.hero}var a=e.animate||"hand";var o=a;var d=false;var q=1;var h=core.getRealStatusOrDefault(f,"def");var g=core.getRealStatusOrDefault(f,"agi");var k=e.atk,m=e.def,l=e.cri,j=e.agi,n=e.special;var b=core.getFlag("atkm",0),c=core.getFlag("defm",0);var p=Math.max(0,k-h);if(p<=0&&(k+c>=h)){p=1}if(core.hasSpecial(n,2)){if(core.hasItem("magic_amulet")){m-=h/3}p=k}if(core.hasSpecial(n,4)){q=2}if(core.hasSpecial(n,5)){q=3}if(core.hasSpecial(n,6)){q=e.n||4}var i=false;if(l!=null&&l>0){if(core.rand(100)<l){p*=2;i=true}}if(g!=null&&g>0){if(core.rand(100)<g){d=true;p=0}}if(d){a="miss"}else{if(p==0){a=="block"}else{a=a+(i?"C":"N")}}return{per_damage:p,animate:a,times:q}};this.battle_heroInfo=function(i,f){if(!i){i=core.status.hero}var e=false;var u=1;var a=core.status.hero.battleAnimate;var t=a;var j=core.getRealStatusOrDefault(i,"agi"),l=core.getRealStatusOrDefault(i,"cri"),k=core.getRealStatusOrDefault(i,"atk"),m=core.getRealStatusOrDefault(i,"def");var p=f.atk,r=f.def,q=f.cri,o=f.agi,s=f.special;var b=core.getFlag("atkm",0),d=core.getFlag("defm",0);var n=Math.max(0,k-r);if(n<=0&&(k+b>=r)){n=1}if(core.getFlag("proof")=="proof_brave"&&core.getFlag("proof_lv")>1){u=2}var c=false,g=false;if(l!=null&&l>0){if(core.rand(100)<l){n*=2;c=true}if(core.getFlag("proof")=="proof_brave"&&core.getFlag("proof_lv")==3&&n>0){if(core.rand(100)<16&&!core.hasSpecial(f,2)){var h=Math.round(r/4);if(c){h*=2}n+=h;g=true}}}if(o!=null&&o>0){if(core.rand(100)<o){n=0;e=true}}if(e){a="miss"}else{if(n==0){a=="block"}else{a=a+(c?"C":"N")}}return{hero_per_damage:n,animate:a,times:u,extra:g}};this.battle_exit=function(){core.status.hero.isBattling=false;core.status.hero.battle_enemy=null;core.status.hero.battleStatus=null;core.status.hero.battle_triggerWeak=null;core.status.hero.battle_triggerPoison=null;core.clearMap("__battle__");core.deleteCanvas("__battle__");core.control.unLockControl();delete flags.__callback__;delete flags.__loc__};this.battle_missAnimate=function(j){core.playSound("miss.mp3");if(flags.inMiss){return}if(core.isReplaying()||main.replayChecking){return}var g=core.plugin.battleInfo;var n=g.width,f=g.height,h=g.left,m=g.top,b=g.bx,d=g.by,i=g.lineWidth,l=g.size;var c=n-b-l;var e=core.createCanvas("__battleAnimate__",h,m,n,f,67);var k=0;e.textBaseline="bottom";var o=i+3;if(j=="hero"){o=n-3;e.textAlign="right"}core.fillText(e,"MISS!!",o,d+l+i,"rgb(220,0,0)","italic 27px myFont");var a=setInterval(function(){flags.inMiss=true;k+=2;core.relocateCanvas("__battleAnimate__",h,m-k);if(k>8){clearInterval(a);delete core.animateFrame.asyncId[a];flags.inMiss=false;core.clearMap("__battleAnimate__");core.deleteCanvas("__battleAnimate__")}},40);core.animateFrame.asyncId[a]=true};this.battle_heroAttack=function(){if(core.status.hero.battleAnimate==null){core.status.hero.battleAnimate="hand"}var f=core.status.hero.battle_enemy;var m=core.plugin.battleInfo;var s=m.width,i=m.height,n=m.left,r=m.top,c=m.bx,e=m.by,o=m.size;var d=s-c-o;core.status.hero.battle_heroTurn++;var m=core.battle_heroInfo(null,f);var p=m.times;var b=0;var k=(d+n+o/2)/32-0.5,l=(e+r+o/2-4)/32-0.5;var g=(c+n+o/2)/32-0.5,h=(e+r+o/2-4)/32-0.5;while(p>0){var q=[];b++;var m=core.battle_heroInfo(null,f);var j=m.hero_per_damage,a=m.animate;if(a=="miss"){q.push({type:"function","function":"function(){\ncore.battle_missAnimate();\n}"})}else{q.push({type:"animate",name:a,async:true,loc:[g,h]})}if(m.extra){q.push({type:"animate",name:"mega",async:true,loc:[k,l]})}p--;if(q.length>0){q.push({type:"while",condition:"!core.same({},core.animateFrame.asyncId)",data:[{type:"sleep",special:[]},],},{type:"waitAsync"},{type:"function","function":"function(){core.status.hero.battle_enemy.hp = Math.max(0, core.status.hero.battle_enemy.hp - "+j+");core.battle_battling_draw(null, core.status.hero.battle_enemy);}"});core.insertAction(q)}}};this.battle_enemyAttack=function(){if(core.status.hero.battleAnimate_enemy==null){core.status.hero.battleAnimate_enemy="hand"}var m=core.plugin.battleInfo;var t=m.width,j=m.height,n=m.left,s=m.top,d=m.bx,f=m.by,p=m.size;var e=t-d-p;var g=core.status.hero.battle_enemy;core.status.hero.battle_enemyTurn++;var m=core.battle_enemyInfo(null,g);var q=m.times;var c=0;var k=(e+n+p/2)/32-0.5,l=(f+s+p/2-4)/32-0.5;var h=(d+n+p/2)/32-0.5,i=(f+s+p/2-4)/32-0.5;while(q>0){var r=[];c++;var m=core.battle_enemyInfo(null,g);function b(){if(r.length>0){r.push({type:"while",condition:"!core.same({},core.animateFrame.asyncId)",data:[{type:"sleep",time:500},],},{type:"waitAsync"},{type:"function","function":"function(){core.status.hero.hp -= "+o+';core.battle_battling_draw(null,core.status.hero.battle_enemy);\nif (core.status.hero.hp < 0) {\n\tif (core.hasItem("cross")) {\n\t\tcore.removeItem("cross", 1);\n\t\tcore.status.hero.hp += 2000;\n\t}\n\tif (core.status.hero.hp <= 0) {\n\t\tcore.status.hero.hp = 0;\n\t\tcore.updateStatusBar();\n\t\tcore.status.hero.isBattling = false;\n\t\tcore.insertAction([{\n\t\t\t"type": "animate",\n\t\t\t"name": '+core.status.hero.battleAnimate+',\n\t\t\t"loc": ['+k+", "+l+']\n\t\t}, {\n\t\t\t"type": "exit"\n\t\t}], null, null, function () {\n\t\t\tcore.battle_battling_draw(null, core.status.hero.battle_enemy);\n\t\t});\n\t}\n}\n}'})}core.insertAction(r)}var o=m.per_damage,a=m.animate;if(a=="miss"){r.push({type:"function","function":'function(){\ncore.battle_missAnimate("hero");\n}'})}else{r.push({type:"animate",name:a,async:true,loc:[k,l]})}q--;if(g.poisonPercent&&!core.status.hero.battle_triggerPoison){if(core.rand(100)<g.poisonPercent){core.status.hero.battle_triggerPoison=true}}if(g.weakPercent&&!core.status.hero.battle_triggerWeak){if(core.rand(100)<g.weakPercent){core.status.hero.battle_triggerWeak=true}}b()}};core.control.replay=function(b){if(!core.isPlaying()||!core.isReplaying()||core.status.replay.animate||core.status.event.id){return}if(core.status.replay.pausing&&!b){return}if(flags.waitNext){core.status.route.push(flags.waitNext);delete flags.waitNext}if(core.status.replay.toReplay.length==0){return this._replay_finished()}this._replay_save();var a=core.status.replay.toReplay.shift();var e=(core.status.replay.toReplay||[])[0]||"",d=(core.status.replay.toReplay||[])[1]||"";if(d=="key:81"){var f=parseInt(e.split("random:")[1]);var g=100;var h=f*g;for(var c=0;c<h;c++){core.rand()}core.status.route.push(a);core.status.route.push(e);core.status.route.push(d);core.status.replay.toReplay.splice(0,2);return core.replay()}else{if(e.indexOf("random:")==0){var f=parseInt(e.split("random:")[1]);var g=100;var h=f*g;for(var c=0;c<h;c++){core.rand()}core.status.replay.toReplay.shift();flags.waitNext=e}}if(this._doReplayAction(a)){return}this._replay_error(a)};core.events.battle=function(i,j,k,f,b){core.saveAndStopAutomaticRoute();i=i||core.getBlockId(j,k);if(!i){return core.clearContinueAutomaticRoute(b)}if(!core.status.event.id){core.autosave(true)}if(!core.beforeBattle(i,j,k)){return core.clearContinueAutomaticRoute(flags.__callback__)}if(!core.status.event.id){core.autosave(true)}if(true){var c=core.clone(core.material.enemys[i]);core.status.hero.battle_enemy=c;core.battle_drawUI();core.status.hero.isBattling=true;core.status.hero.battle_heroTurn=0;core.status.hero.battle_enemyTurn=0;var e=0;if(core.hasSpecial(c,1)){e=1}flags.__callback__=b;flags.__loc__=[j,k];core.status.battle_heroHp=core.status.hero.hp;var h=core.status.hero.hp;var d=[{type:"function","function":"function(){core.battle_enemyAttack();}"}];var g=[{type:"function","function":"function(){core.battle_heroAttack()}"}];var a=g.concat(d);if(e){a=d.concat(d)}core.insertAction([{type:"while",condition:"core.status.hero.isBattling",data:a,}])}else{if(!core.enemys.canBattle(i,j,k)&&!f&&!core.status.event.id){core.drawTip("你打不过此怪物！",null,true);return core.clearContinueAutomaticRoute(b)}if(!core.status.event.id){core.autosave(true)}if(!core.beforeBattle(i,j,k)){return core.clearContinueAutomaticRoute(b)}core.afterBattle(i,j,k,b)}}},"自动拾取":function(){var d=true;if(!d){return}function c(o,p,f){var h=core.generateMovableArray();var g=core.getMapBlocksObj();var e=core.getBgMapArray();var q=[],n=[];q[o+","+p]=0;n.push(o+","+p);while(n.length>0){var k=n.shift().split(","),r=~~k[0],s=~~k[1];for(var i in core.utils.scan){if(!core.inArray(h[r][s],i)){continue}var l=r+core.utils.scan[i].x,m=s+core.utils.scan[i].y,j=l+","+m;if(q[j]){continue}if(core.onSki(e[m][l])){continue}if(f&&!f(g,l,m)){continue}q[j]=q[k]+1;n.push(j)}}}function b(){var g="attractAnimate";var e=false;this.nodes=[];this.add=function(j,k,l,i){this.nodes.push({id:j,x:k,y:l,callback:i})};this.start=function(){if(e){return}e=true;core.registerAnimationFrame(g,true,this.update);this.ctx=core.createCanvas(g,0,0,core.__PIXELS__,core.__PIXELS__,120)};this.remove=function(){core.unregisterAnimationFrame(g);core.deleteCanvas(g);e=false};this.clear=function(){this.nodes=[];this.remove()};var f=-1;var h=this;this.update=function(l){if(f<0){f=l}if(l-f<20){return}f=l;core.clearMap(g);var i=core.status.heroCenter.px-16,j=core.status.heroCenter.py-16;var k=5;h.nodes.forEach(function(p){var m=i-p.x,o=j-p.y;if(Math.abs(m)<=k&&Math.abs(o)<=k){p.dead=true}else{p.x+=~~(m/k);p.y+=~~(o/k)}core.drawIcon(g,p.id,p.x,p.y,32,32)});h.nodes=h.nodes.filter(function(m){if(m.dead&&m.callback){m.callback()}return !m.dead});if(h.nodes.length==0){h.remove()}}}var a=new b();this.stopAttractAnimate=function(){a.clear()};this.autoGetItem=function(){if(core.getFlag("autoGetItem",0)==0){return}if(core.hasFlag("poison")){return}var f=core.getBlock(hero.loc.x,hero.loc.y);if(f&&f.id==11){return}var e=["yellowKey","blueKey","redKey","bigKey","coin","greenGem","yellowGem","greenPotion","yellowPotion","I398","I400","I403","I407"];if(1){e.push("iceCube","snow","knife","icePickaxe","pickaxe","shield3","shield4","shield5","skill1","I307","I309")}if(core.hasItem("moneyPocket")){e.push("I323","I324")}if(flags.autoGetHp){e.push("redPotion","bluePotion")}if(flags.autoGetAd){e.push("redGem","blueGem","cross","I315","I316","I317","I318","I319","I320","I321","I322","I339","I375")}if(flags.autoGetHp&&flags.autoGetAd){e.push("centerFly")}var g=function(n,p,q){var o=p+","+q;if(o in h){return false}var k=n[o];if(k&&!k.disable&&k.event.cls=="items"&&e.indexOf(k.event.id)>=0&&!core.isMapBlockDisabled(core.status.floorId,k.x,k.y)&&k.event.trigger=="getItem"){h[o]={x:p,y:q,id:k.event.id};return !core.status.checkBlock.damage[o]&&!core.status.checkBlock.ambush[o]}return core.maps._canMoveDirectly_checkNextPoint(n,p,q)};core.setFlag("loopAutoGetItem",1);var h={};if(!core.status.floorId||!core.status.checkBlock.damage){return}c(core.getHeroLoc("x"),core.getHeroLoc("y"),g);for(var j in h){var l=h[j].x,m=h[j].y,i=h[j].id;core.trigger(l,m);if(!core.isReplaying()){a.add(i,l*32,m*32)}}if(!core.isReplaying()){a.start()}}},"修复装备Bug":function(){return;core.actions._clickEquipboxIndex=function(c){if(c<this.LAST){if(c>=core.status.globalAttribute.equipName.length){return}if(c==core.status.event.selection&&core.status.hero.equipment[c]){if(core.isReplaying()){return}core.unloadEquip(c)}else{core.playSound("光标移动")}}else{var b=core.getToolboxItems("equips");if(c==core.status.event.selection){if(core.isReplaying()){return}var a=b[c-this.LAST+(core.status.event.data.page-1)*this.LAST];core.loadEquip(a)}else{core.playSound("光标移动")}}core.ui._drawEquipbox(c)};this._afterLoadResources=function(){for(var f=0;f<core.initStatus.autoEvents.length;f++){if(core.initStatus.autoEvents[f].symbol.indexOf("equipEvent_")>=0){core.initStatus.autoEvents.splice(f,1);f--}}for(var e in core.material.items){var c=core.material.items[e];if(c.cls!="equips"||!c.equip){continue}if(!c.equip.equipEvent&&!c.equip.unequipEvent){continue}var d="_equipEvent_"+e;var a={symbol:"_equipEvent_"+e,currentFloor:false,multiExecute:true,condition:"core.hasEquip('"+e+"') && !core.hasFlag('"+d+"')",data:core.precompile([{type:"setValue",name:"flag:"+d,value:"true"},{type:"function","function":"function(){core.status.route.push('equip:"+e+"');}"}].concat(c.equip.equipEvent||[])),};var b={symbol:"_unequipEvent_"+e,currentFloor:false,multiExecute:true,condition:"!core.hasEquip('"+e+"') && core.hasFlag('"+d+"')",data:core.precompile([{type:"setValue",name:"flag:"+d,value:"null"},{type:"function","function":"function(){if (!core.getEquip("+(c.equip.type||0)+")) core.status.route.push('unEquip:"+(c.equip.type||0)+"');}"}].concat(c.equip.unequipEvent||[])),};core.initStatus.autoEvents.push(a);core.initStatus.autoEvents.push(b)}};core.control._replayAction_equip=function(a){if(a.indexOf("equip:")!=0){return false}var b=a.substring(6);var d=core.getToolboxItems("equips");var c=d.indexOf(b),e=core.__SIZE__-1;if(c<0){return false}if(core.material.items[b].hideInReplay||core.status.replay.speed==24){core.loadEquip(b,core.replay);return true}core.status.event.data={page:Math.floor(c/e)+1,selectId:null};c=c%e+e;core.ui._drawEquipbox(c);setTimeout(function(){core.ui.closePanel();core.loadEquip(b,core.replay)},core.control.__replay_getTimeout());return true};core.control._replayAction_unEquip=function(a){if(a.indexOf("unEquip:")!=0){return false}var b=parseInt(a.substring(8));if(!core.isset(b)){return false}core.ui._drawEquipbox(b);if(core.status.replay.speed==24){core.unloadEquip(b,core.replay);return true}setTimeout(function(){core.ui.closePanel();core.unloadEquip(b,core.replay)},core.control.__replay_getTimeout());return true};core.items._realLoadEquip=function(d,c,f,a){var b=core.material.items[c]||{},e=core.material.items[f]||{};this._realLoadEquip_playSound();this._loadEquipEffect(c,f);if(c){core.removeItem(c)}if(f){core.addItem(f)}core.status.hero.equipment[d]=c||null;if(c){core.drawTip("已装备上"+b.name,c)}else{if(f){core.drawTip("已卸下"+e.name,f)}}if(core.isReplaying()){core.updateStatusBar()}if(a){a()}};core.control.registerReplayAction("equip",core.control._replayAction_equip);core.control.registerReplayAction("unEquip",core.control._replayAction_unEquip)}};